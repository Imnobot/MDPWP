!function (e, t) {
  if ("object" == typeof exports && "undefined" != typeof module) {
    module.exports = t();
  } else if ("function" == typeof define && define.amd) {
    define(t);
  } else {
    e.CodeMirror = t();
  }
}(this, function () {
  "use strict";

  var e = navigator.userAgent;
  var t = navigator.platform;
  var g = /gecko\/\d/i.test(e);
  var r = /MSIE \d/.test(e);
  var n = /Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(e);
  var i = /Edge\/(\d+)/.exec(e);
  var x = r || n || i;
  var C = x && (r ? document.documentMode || 6 : +(i || n)[1]);
  var b = !i && /WebKit\//.test(e);
  var o = b && /Qt\/\d+\.\d+/.test(e);
  var l = !i && /Chrome\//.test(e);
  var v = /Opera\//.test(e);
  var a = /Apple Computer/.test(navigator.vendor);
  var s = /Mac OS X 1\d\D([8-9]|\d\d)\D/.test(e);
  var u = /PhantomJS/.test(e);
  var c = !i && /AppleWebKit/.test(e) && /Mobile\/\w+/.test(e);
  var h = /Android/.test(e);
  var f = c || h || /webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(e);
  var w = c || /Mac/.test(t);
  var d = /\bCrOS\b/.test(e);
  var p = /win/i.test(t);
  var m = v && e.match(/Version\/(\d*\.\d*)/);
  if (m) {
    m = Number(m[1]);
  }
  if (m && 15 <= m) {
    b = !(v = false);
  }
  var y = w && (o || v && (null == m || m < 12.11));
  var S = g || x && 9 <= C;
  var k;
  var T = function (e, t) {
    var r = e.className;
    var n = new RegExp("(^|\\s)" + t + "(?:$|\\s)\\s*").exec(r);
    if (n) {
      var i = r.slice(n.index + n[0].length);
      e.className = r.slice(0, n.index) + (i ? n[1] + i : "");
    }
  };
  function M(e) {
    for (var t = e.childNodes.length; 0 < t; --t) {
      e.removeChild(e.firstChild);
    }
    return e;
  }
  function A(e, t, r, n) {
    var i = document.createElement(e);
    if (r) {
      i.className = r;
    }
    if (n) {
      i.style.cssText = n;
    }
    if ("string" == typeof t) {
      i.appendChild(document.createTextNode(t));
    } else if (t) {
      for (var o = 0; o < t.length; ++o) {
        i.appendChild(t[o]);
      }
    }
    return i;
  }
  function O(e, t, r, n) {
    var i = A(e, t, r, n);
    i.setAttribute("role", "presentation");
    return i;
  }
  function D(e, t) {
    if (3 == t.nodeType) {
      t = t.parentNode;
    }
    if (e.contains) {
      return e.contains(t);
    }
    do {
      if (11 == t.nodeType) {
        t = t.host;
      }
      if (t == e) {
        return true;
      }
    } while (t = t.parentNode);
  }
  function W() {
    var t;
    try {
      t = document.activeElement;
    } catch (e) {
      t = document.body || null;
    }
    for (; t && t.shadowRoot && t.shadowRoot.activeElement;) {
      t = t.shadowRoot.activeElement;
    }
    return t;
  }
  function H(e, t) {
    var r = e.className;
    if (!new RegExp("(^|\\s)" + t + "(?:$|\\s)\\s*").test(r)) {
      e.className += (r ? " " : "") + t;
    }
  }
  function F(e, t) {
    var r = e.split(" ");
    for (var n = 0; n < r.length; n++) {
      if (r[n] && !new RegExp("(^|\\s)" + r[n] + "(?:$|\\s)\\s*").test(t)) {
        t += " " + r[n];
      }
    }
    return t;
  }
  k = document.createRange ? function (e, t, r, n) {
    var i = document.createRange();
    i.setEnd(n || e, r);
    i.setStart(e, t);
    return i;
  } : function (e, t, r) {
    var n = document.body.createTextRange();
    try {
      n.moveToElementText(e.parentNode);
    } catch (e) {
      return n;
    }
    n.collapse(true);
    n.moveEnd("character", r);
    n.moveStart("character", t);
    return n;
  };
  var P = function (e) {
    e.select();
  };
  function E(e) {
    var t = Array.prototype.slice.call(arguments, 1);
    return function () {
      return e.apply(null, t);
    };
  }
  function I(e, t, r) {
    if (!t) {
      t = {};
    }
    for (var n in e) if (!(!e.hasOwnProperty(n) || false === r && t.hasOwnProperty(n))) {
      t[n] = e[n];
    }
    return t;
  }
  function z(e, t, r, n, i) {
    if (null == t && -1 == (t = e.search(/[^\s\u00a0]/))) {
      t = e.length;
    }
    var o = n || 0;
    for (var l = i || 0;;) {
      var s = e.indexOf("\t", o);
      if (s < 0 || t <= s) {
        return l + (t - o);
      }
      l += s - o;
      l += r - l % r;
      o = s + 1;
    }
  }
  if (c) {
    P = function (e) {
      e.selectionStart = 0;
      e.selectionEnd = e.value.length;
    };
  } else if (x) {
    P = function (e) {
      try {
        e.select();
      } catch (e) {}
    };
  }
  var R = function () {
    this.id = null;
  };
  function B(e, t) {
    for (var r = 0; r < e.length; ++r) {
      if (e[r] == t) {
        return r;
      }
    }
    return -1;
  }
  R.prototype.set = function (e, t) {
    clearTimeout(this.id);
    this.id = setTimeout(t, e);
  };
  var U = {
    toString: function () {
      return "CodeMirror.Pass";
    }
  };
  var V = {
    scroll: false
  };
  var K = {
    origin: "*mouse"
  };
  var j = {
    origin: "+move"
  };
  function X(e, t, r) {
    var n = 0;
    for (var i = 0;;) {
      var o = e.indexOf("\t", n);
      if (-1 == o) {
        o = e.length;
      }
      var l = o - n;
      if (o == e.length || t <= i + l) {
        return n + Math.min(l, t - i);
      }
      i += o - n;
      n = o + 1;
      if (t <= (i += r - i % r)) {
        return n;
      }
    }
  }
  var Y = [""];
  function _(e) {
    for (; Y.length <= e;) {
      Y.push(Y[Y.length - 1] + " ");
    }
    return Y[e];
  }
  function q(e, t) {
    var r = [];
    for (var n = 0; n < e.length; n++) {
      r[n] = t(e[n], n);
    }
    return r;
  }
  function Z() {}
  function Q(e, t) {
    var r;
    r = Object.create ? Object.create(e) : (Z.prototype = e, new Z());
    if (t) {
      I(t, r);
    }
    return r;
  }
  var J = /[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;
  function ee(e) {
    return /\w/.test(e) || "" < e && (e.toUpperCase() != e.toLowerCase() || J.test(e));
  }
  function re(e) {
    for (var t in e) if (e.hasOwnProperty(t) && e[t]) {
      return false;
    }
    return true;
  }
  var ne = /[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/;
  function oe(e, t, r) {
    for (; (r < 0 ? 0 < t : t < e.length) && 768 <= e.charAt(t).charCodeAt(0) && ne.test(e.charAt(t));) {
      t += r;
    }
    return t;
  }
  function le(e, t, r) {
    for (var n = r < t ? -1 : 1;;) {
      if (t == r) {
        return t;
      }
      var i = (t + r) / 2;
      var o = n < 0 ? Math.ceil(i) : Math.floor(i);
      if (o == t) {
        return e(o) ? t : r;
      }
      if (e(o)) {
        r = o;
      } else {
        t = o + n;
      }
    }
  }
  function se(e, t, r) {
    var n = this;
    this.input = r;
    n.scrollbarFiller = A("div", null, "CodeMirror-scrollbar-filler");
    n.scrollbarFiller.setAttribute("cm-not-content", "true");
    n.gutterFiller = A("div", null, "CodeMirror-gutter-filler");
    n.gutterFiller.setAttribute("cm-not-content", "true");
    n.lineDiv = O("div", null, "CodeMirror-code");
    n.selectionDiv = A("div", null, null, "position: relative; z-index: 1");
    n.cursorDiv = A("div", null, "CodeMirror-cursors");
    n.measure = A("div", null, "CodeMirror-measure");
    n.lineMeasure = A("div", null, "CodeMirror-measure");
    n.lineSpace = O("div", [n.measure, n.lineMeasure, n.selectionDiv, n.cursorDiv, n.lineDiv], null, "position: relative; outline: none");
    var i = O("div", [n.lineSpace], "CodeMirror-lines");
    n.mover = A("div", [i], null, "position: relative");
    n.sizer = A("div", [n.mover], "CodeMirror-sizer");
    n.sizerWidth = null;
    n.heightForcer = A("div", null, null, "position: absolute; height: 30px; width: 1px;");
    n.gutters = A("div", null, "CodeMirror-gutters");
    n.lineGutter = null;
    n.scroller = A("div", [n.sizer, n.heightForcer, n.gutters], "CodeMirror-scroll");
    n.scroller.setAttribute("tabIndex", "-1");
    n.wrapper = A("div", [n.scrollbarFiller, n.gutterFiller, n.scroller], "CodeMirror");
    if (x && C < 8) {
      n.gutters.style.zIndex = -1;
      n.scroller.style.paddingRight = 0;
    }
    if (!(b || g && f)) {
      n.scroller.draggable = true;
    }
    if (e) {
      if (e.appendChild) {
        e.appendChild(n.wrapper);
      } else {
        e(n.wrapper);
      }
    }
    n.viewFrom = n.viewTo = t.first;
    n.reportedViewFrom = n.reportedViewTo = t.first;
    n.view = [];
    n.renderedView = null;
    n.externalMeasured = null;
    n.viewOffset = 0;
    n.lastWrapHeight = n.lastWrapWidth = 0;
    n.updateLineNumbers = null;
    n.nativeBarWidth = n.barHeight = n.barWidth = 0;
    n.scrollbarsClipped = false;
    n.lineNumWidth = n.lineNumInnerWidth = n.lineNumChars = null;
    n.alignWidgets = false;
    n.cachedCharWidth = n.cachedTextHeight = n.cachedPaddingH = null;
    n.maxLine = null;
    n.maxLineLength = 0;
    n.maxLineChanged = false;
    n.wheelDX = n.wheelDY = n.wheelStartX = n.wheelStartY = null;
    n.shift = false;
    n.selForContextMenu = null;
    n.activeTouch = null;
    r.init(n);
  }
  function ae(e, t) {
    if ((t -= e.first) < 0 || t >= e.size) {
      throw new Error("There is no line " + (t + e.first) + " in the document.");
    }
    for (var r = e; !r.lines;) {
      for (var n = 0;; ++n) {
        var i = r.children[n];
        var o = i.chunkSize();
        if (t < o) {
          r = i;
          break;
        }
        t -= o;
      }
    }
    return r.lines[t];
  }
  function ue(e, r, n) {
    var i = [];
    var o = r.line;
    e.iter(r.line, n.line + 1, function (e) {
      var t = e.text;
      if (o == n.line) {
        t = t.slice(0, n.ch);
      }
      if (o == r.line) {
        t = t.slice(r.ch);
      }
      i.push(t);
      ++o;
    });
    return i;
  }
  function ce(e, t, r) {
    var n = [];
    e.iter(t, r, function (e) {
      n.push(e.text);
    });
    return n;
  }
  function he(e, t) {
    var r = t - e.height;
    if (r) {
      for (var n = e; n; n = n.parent) {
        n.height += r;
      }
    }
  }
  function fe(e) {
    if (null == e.parent) {
      return null;
    }
    var t = e.parent;
    var r = B(t.lines, e);
    for (var n = t.parent; n; n = (t = n).parent) {
      for (var i = 0; n.children[i] != t; ++i) {
        r += n.children[i].chunkSize();
      }
    }
    return r + t.first;
  }
  function de(e, t) {
    var r = e.first;
    e: do {
      for (var n = 0; n < e.children.length; ++n) {
        var i = e.children[n];
        var o = i.height;
        if (t < o) {
          e = i;
          continue e;
        }
        t -= o;
        r += i.chunkSize();
      }
      return r;
    } while (!e.lines);
    for (var l = 0; l < e.lines.length; ++l) {
      var s = e.lines[l].height;
      if (t < s) {
        break;
      }
      t -= s;
    }
    return r + l;
  }
  function ve(e, t, r) {
    if (undefined === r) {
      r = null;
    }
    if (!(this instanceof ve)) {
      return new ve(e, t, r);
    }
    this.line = e;
    this.ch = t;
    this.sticky = r;
  }
  function me(e, t) {
    return e.line - t.line || e.ch - t.ch;
  }
  function Se(e, t) {
    if (t.line < e.first) {
      return ve(e.first, 0);
    }
    var r;
    var n;
    var i;
    var o = e.first + e.size - 1;
    return t.line > o ? ve(o, ae(e, o).text.length) : (n = ae(e, (r = t).line).text.length, null == (i = r.ch) || n < i ? ve(r.line, n) : i < 0 ? ve(r.line, 0) : r);
  }
  function Le(e, t) {
    var r = [];
    for (var n = 0; n < t.length; n++) {
      r[n] = Se(e, t[n]);
    }
    return r;
  }
  var ke = false;
  var Te = false;
  function Me(e, t, r) {
    this.marker = e;
    this.from = t;
    this.to = r;
  }
  function Ne(e, t) {
    if (e) {
      for (var r = 0; r < e.length; ++r) {
        var n = e[r];
        if (n.marker == t) {
          return n;
        }
      }
    }
  }
  function Oe(e, t) {
    var r;
    for (var n = 0; n < e.length; ++n) {
      if (e[n] != t) {
        (r || (r = [])).push(e[n]);
      }
    }
    return r;
  }
  function Ae(e, t) {
    if (t.full) {
      return null;
    }
    var r = t.from.line >= e.first && t.from.line < e.first + e.size && ae(e, t.from.line).markedSpans;
    var n = t.to.line >= e.first && t.to.line < e.first + e.size && ae(e, t.to.line).markedSpans;
    if (!r && !n) {
      return null;
    }
    var i = t.from.ch;
    var o = t.to.ch;
    var l = 0 == (t.from.line - t.to.line || t.from.ch - t.to.ch);
    var s = function (e, t, r) {
      var n;
      if (e) {
        for (var i = 0; i < e.length; ++i) {
          var o = e[i];
          var l = o.marker;
          if (null == o.from || (l.inclusiveLeft ? o.from <= t : o.from < t) || o.from == t && "bookmark" == l.type && (!r || !o.marker.insertLeft)) {
            var s = null == o.to || (l.inclusiveRight ? o.to >= t : o.to > t);
            (n || (n = [])).push(new Me(l, o.from, s ? null : o.to));
          }
        }
      }
      return n;
    }(r, i, l);
    var a = function (e, t, r) {
      var n;
      if (e) {
        for (var i = 0; i < e.length; ++i) {
          var o = e[i];
          var l = o.marker;
          if (null == o.to || (l.inclusiveRight ? o.to >= t : o.to > t) || o.from == t && "bookmark" == l.type && (!r || o.marker.insertLeft)) {
            var s = null == o.from || (l.inclusiveLeft ? o.from <= t : o.from < t);
            (n || (n = [])).push(new Me(l, s ? null : o.from - t, null == o.to ? null : o.to - t));
          }
        }
      }
      return n;
    }(n, o, l);
    var u = 1 == t.text.length;
    var c = t.text[t.text.length - 1].length + (u ? i : 0);
    if (s) {
      for (var h = 0; h < s.length; ++h) {
        var f = s[h];
        if (null == f.to) {
          var d = Ne(a, f.marker);
          if (d) {
            if (u) {
              f.to = null == d.to ? null : d.to + c;
            }
          } else {
            f.to = i;
          }
        }
      }
    }
    if (a) {
      for (var p = 0; p < a.length; ++p) {
        var g = a[p];
        if (null != g.to) {
          g.to += c;
        }
        if (null == g.from) {
          if (!Ne(s, g.marker)) {
            g.from = c;
            if (u) {
              (s || (s = [])).push(g);
            }
          }
        } else {
          g.from += c;
          if (u) {
            (s || (s = [])).push(g);
          }
        }
      }
    }
    if (s) {
      s = De(s);
    }
    if (a && a != s) {
      a = De(a);
    }
    var v = [s];
    if (!u) {
      var m;
      var y = t.text.length - 2;
      if (0 < y && s) {
        for (var b = 0; b < s.length; ++b) {
          if (null == s[b].to) {
            (m || (m = [])).push(new Me(s[b].marker, null, null));
          }
        }
      }
      for (var w = 0; w < y; ++w) {
        v.push(m);
      }
      v.push(a);
    }
    return v;
  }
  function De(e) {
    for (var t = 0; t < e.length; ++t) {
      var r = e[t];
      if (null != r.from && r.from == r.to && false !== r.marker.clearWhenEmpty) {
        e.splice(t--, 1);
      }
    }
    return e.length ? e : null;
  }
  function We(e) {
    var t = e.markedSpans;
    if (t) {
      for (var r = 0; r < t.length; ++r) {
        t[r].marker.detachLine(e);
      }
      e.markedSpans = null;
    }
  }
  function He(e, t) {
    if (t) {
      for (var r = 0; r < t.length; ++r) {
        t[r].marker.attachLine(e);
      }
      e.markedSpans = t;
    }
  }
  function Ee(e, t) {
    var r = e.lines.length - t.lines.length;
    if (0 != r) {
      return r;
    }
    var n = e.find();
    var i = t.find();
    var o = n.from.line - i.from.line || n.from.ch - i.from.ch || (e.inclusiveLeft ? -1 : 0) - (t.inclusiveLeft ? -1 : 0);
    if (o) {
      return -o;
    }
    var l = n.to.line - i.to.line || n.to.ch - i.to.ch || (e.inclusiveRight ? 1 : 0) - (t.inclusiveRight ? 1 : 0);
    return l || t.id - e.id;
  }
  function Ie(e, t) {
    var r;
    var n = Te && e.markedSpans;
    if (n) {
      var i = undefined;
      for (var o = 0; o < n.length; ++o) {
        if ((i = n[o]).marker.collapsed && null == (t ? i.from : i.to) && (!r || Ee(r, i.marker) < 0)) {
          r = i.marker;
        }
      }
    }
    return r;
  }
  function Be(e, t) {
    var r;
    var n = Te && e.markedSpans;
    if (n) {
      for (var i = 0; i < n.length; ++i) {
        var o = n[i];
        if (o.marker.collapsed && (null == o.from || o.from < t) && (null == o.to || o.to > t) && (!r || Ee(r, o.marker) < 0)) {
          r = o.marker;
        }
      }
    }
    return r;
  }
  function Ge(e, t, r, n, i) {
    var o = ae(e, t);
    var l = Te && o.markedSpans;
    if (l) {
      for (var s = 0; s < l.length; ++s) {
        var a = l[s];
        if (a.marker.collapsed) {
          var u = a.marker.find(0);
          var c = u.from.line - r.line || u.from.ch - r.ch || (a.marker.inclusiveLeft ? -1 : 0) - (i.inclusiveLeft ? -1 : 0);
          var h = u.to.line - n.line || u.to.ch - n.ch || (a.marker.inclusiveRight ? 1 : 0) - (i.inclusiveRight ? 1 : 0);
          if (!(0 <= c && h <= 0 || c <= 0 && 0 <= h) && (c <= 0 && (a.marker.inclusiveRight && i.inclusiveLeft ? 0 <= (u.to.line - r.line || u.to.ch - r.ch) : 0 < (u.to.line - r.line || u.to.ch - r.ch)) || 0 <= c && (a.marker.inclusiveRight && i.inclusiveLeft ? (u.from.line - n.line || u.from.ch - n.ch) <= 0 : (u.from.line - n.line || u.from.ch - n.ch) < 0))) {
            return true;
          }
        }
      }
    }
  }
  function Ue(e) {
    for (var t; t = Ie(e, true);) {
      e = t.find(-1, true).line;
    }
    return e;
  }
  function Ve(e, t) {
    var r = ae(e, t);
    var n = Ue(r);
    return r == n ? t : fe(n);
  }
  function Ke(e, t) {
    if (t > e.lastLine()) {
      return t;
    }
    var r;
    var n = ae(e, t);
    if (!je(e, n)) {
      return t;
    }
    for (; r = Ie(n, false);) {
      n = r.find(1, true).line;
    }
    return fe(n) + 1;
  }
  function je(e, t) {
    var r = Te && t.markedSpans;
    if (r) {
      var n = undefined;
      for (var i = 0; i < r.length; ++i) {
        if ((n = r[i]).marker.collapsed) {
          if (null == n.from) {
            return true;
          }
          if (!n.marker.widgetNode && 0 == n.from && n.marker.inclusiveLeft && Xe(e, t, n)) {
            return true;
          }
        }
      }
    }
  }
  function Xe(e, t, r) {
    if (null == r.to) {
      var n = r.marker.find(1, true);
      return Xe(e, n.line, Ne(n.line.markedSpans, r.marker));
    }
    if (r.marker.inclusiveRight && r.to == t.text.length) {
      return true;
    }
    var i = undefined;
    for (var o = 0; o < t.markedSpans.length; ++o) {
      if ((i = t.markedSpans[o]).marker.collapsed && !i.marker.widgetNode && i.from == r.to && (null == i.to || i.to != r.from) && (i.marker.inclusiveLeft || r.marker.inclusiveRight) && Xe(e, t, i)) {
        return true;
      }
    }
  }
  function Ye(e) {
    var t = 0;
    var r = (e = Ue(e)).parent;
    for (var n = 0; n < r.lines.length; ++n) {
      var i = r.lines[n];
      if (i == e) {
        break;
      }
      t += i.height;
    }
    for (var o = r.parent; o; o = (r = o).parent) {
      for (var l = 0; l < o.children.length; ++l) {
        var s = o.children[l];
        if (s == r) {
          break;
        }
        t += s.height;
      }
    }
    return t;
  }
  function _e(e) {
    if (0 == e.height) {
      return 0;
    }
    var t;
    var r = e.text.length;
    for (var n = e; t = Ie(n, true);) {
      var i = t.find(0, true);
      n = i.from.line;
      r += i.from.ch - i.to.ch;
    }
    for (n = e; t = Ie(n, false);) {
      var o = t.find(0, true);
      r -= n.text.length - o.from.ch;
      r += (n = o.to.line).text.length - o.to.ch;
    }
    return r;
  }
  function $e(e) {
    var r = e.display;
    var t = e.doc;
    r.maxLine = ae(t, t.first);
    r.maxLineLength = _e(r.maxLine);
    r.maxLineChanged = true;
    t.iter(function (e) {
      var t = _e(e);
      if (t > r.maxLineLength) {
        r.maxLineLength = t;
        r.maxLine = e;
      }
    });
  }
  var qe = null;
  function Ze(e, t, r) {
    var n;
    qe = null;
    for (var i = 0; i < e.length; ++i) {
      var o = e[i];
      if (o.from < t && o.to > t) {
        return i;
      }
      if (o.to == t) {
        if (o.from != o.to && "before" == r) {
          n = i;
        } else {
          qe = i;
        }
      }
      if (o.from == t) {
        if (o.from != o.to && "before" != r) {
          n = i;
        } else {
          qe = i;
        }
      }
    }
    return null != n ? n : qe;
  }
  var Qe = function () {
    var R = /[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;
    var B = /[stwN]/;
    var G = /[LRr]/;
    var U = /[Lb1n]/;
    var V = /[1n]/;
    function K(e, t, r) {
      this.level = e;
      this.from = t;
      this.to = r;
    }
    return function (e, t) {
      var r = "ltr" == t ? "L" : "R";
      if (0 == e.length || "ltr" == t && !R.test(e)) {
        return false;
      }
      var n;
      var i = e.length;
      var o = [];
      for (var l = 0; l < i; ++l) {
        o.push((n = e.charCodeAt(l)) <= 247 ? "bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN".charAt(n) : 1424 <= n && n <= 1524 ? "R" : 1536 <= n && n <= 1785 ? "nnnnnnNNr%%r,rNNmmmmmmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmmmnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmnNmmmmmmrrmmNmmmmrr1111111111".charAt(n - 1536) : 1774 <= n && n <= 2220 ? "r" : 8192 <= n && n <= 8203 ? "w" : 8204 == n ? "b" : "L");
      }
      var s = 0;
      for (var a = r; s < i; ++s) {
        var u = o[s];
        if ("m" == u) {
          o[s] = a;
        } else {
          a = u;
        }
      }
      var c = 0;
      for (var h = r; c < i; ++c) {
        var f = o[c];
        if ("1" == f && "r" == h) {
          o[c] = "n";
        } else if (G.test(f) && "r" == (h = f)) {
          o[c] = "R";
        }
      }
      var d = 1;
      for (var p = o[0]; d < i - 1; ++d) {
        var g = o[d];
        if ("+" == g && "1" == p && "1" == o[d + 1]) {
          o[d] = "1";
        } else if (!("," != g || p != o[d + 1] || "1" != p && "n" != p)) {
          o[d] = p;
        }
        p = g;
      }
      for (var v = 0; v < i; ++v) {
        var m = o[v];
        if ("," == m) {
          o[v] = "N";
        } else if ("%" == m) {
          var y = undefined;
          for (y = v + 1; y < i && "%" == o[y]; ++y) {
            ;
          }
          var b = v && "!" == o[v - 1] || y < i && "1" == o[y] ? "1" : "N";
          for (var w = v; w < y; ++w) {
            o[w] = b;
          }
          v = y - 1;
        }
      }
      var x = 0;
      for (var C = r; x < i; ++x) {
        var S = o[x];
        if ("L" == C && "1" == S) {
          o[x] = "L";
        } else if (G.test(S)) {
          C = S;
        }
      }
      for (var L = 0; L < i; ++L) {
        if (B.test(o[L])) {
          var k = undefined;
          for (k = L + 1; k < i && B.test(o[k]); ++k) {
            ;
          }
          var T = "L" == (L ? o[L - 1] : r);
          var M = T == ("L" == (k < i ? o[k] : r)) ? T ? "L" : "R" : r;
          for (var N = L; N < k; ++N) {
            o[N] = M;
          }
          L = k - 1;
        }
      }
      var O;
      var A = [];
      for (var D = 0; D < i;) {
        if (U.test(o[D])) {
          var W = D;
          for (++D; D < i && U.test(o[D]); ++D) {
            ;
          }
          A.push(new K(0, W, D));
        } else {
          var H = D;
          var F = A.length;
          for (++D; D < i && "L" != o[D]; ++D) {
            ;
          }
          for (var P = H; P < D;) {
            if (V.test(o[P])) {
              if (H < P) {
                A.splice(F, 0, new K(1, H, P));
              }
              var E = P;
              for (++P; P < D && V.test(o[P]); ++P) {
                ;
              }
              A.splice(F, 0, new K(2, E, P));
              H = P;
            } else {
              ++P;
            }
          }
          if (H < D) {
            A.splice(F, 0, new K(1, H, D));
          }
        }
      }
      if ("ltr" == t) {
        if (1 == A[0].level && (O = e.match(/^\s+/))) {
          A[0].from = O[0].length;
          A.unshift(new K(0, 0, O[0].length));
        }
        if (1 == A[A.length - 1].level && (O = e.match(/\s+$/))) {
          A[A.length - 1].to -= O[0].length;
          A.push(new K(0, i - O[0].length, i));
        }
      }
      return "rtl" == t ? A.reverse() : A;
    };
  }();
  function Je(e, t) {
    var r = e.order;
    if (null == r) {
      r = e.order = Qe(e.text, t);
    }
    return r;
  }
  var et = [];
  var tt = function (e, t, r) {
    if (e.addEventListener) {
      e.addEventListener(t, r, false);
    } else if (e.attachEvent) {
      e.attachEvent("on" + t, r);
    } else {
      var n = e._handlers || (e._handlers = {});
      n[t] = (n[t] || et).concat(r);
    }
  };
  function nt(e, t, r) {
    if (e.removeEventListener) {
      e.removeEventListener(t, r, false);
    } else if (e.detachEvent) {
      e.detachEvent("on" + t, r);
    } else {
      var n = e._handlers;
      var i = n && n[t];
      if (i) {
        var o = B(i, r);
        if (-1 < o) {
          n[t] = i.slice(0, o).concat(i.slice(o + 1));
        }
      }
    }
  }
  function it(e, t) {
    var r = e._handlers && e._handlers[t] || et;
    if (r.length) {
      var n = Array.prototype.slice.call(arguments, 2);
      for (var i = 0; i < r.length; ++i) {
        r[i].apply(null, n);
      }
    }
  }
  function ot(e, t, r) {
    if ("string" == typeof t) {
      t = {
        type: t,
        preventDefault: function () {
          this.defaultPrevented = true;
        }
      };
    }
    it(e, r || t.type, e, t);
    return (null != t.defaultPrevented ? t.defaultPrevented : 0 == t.returnValue) || t.codemirrorIgnore;
  }
  function lt(e) {
    var t = e._handlers && e._handlers.cursorActivity;
    if (t) {
      var r = e.curOp.cursorActivityHandlers || (e.curOp.cursorActivityHandlers = []);
      for (var n = 0; n < t.length; ++n) {
        if (-1 == B(r, t[n])) {
          r.push(t[n]);
        }
      }
    }
  }
  function at(e) {
    e.prototype.on = function (e, t) {
      tt(this, e, t);
    };
    e.prototype.off = function (e, t) {
      nt(this, e, t);
    };
  }
  function ut(e) {
    if (e.preventDefault) {
      e.preventDefault();
    } else {
      e.returnValue = false;
    }
  }
  function ct(e) {
    if (e.stopPropagation) {
      e.stopPropagation();
    } else {
      e.cancelBubble = true;
    }
  }
  function ft(e) {
    ut(e);
    ct(e);
  }
  function pt(e) {
    var t = e.which;
    if (null == t) {
      if (1 & e.button) {
        t = 1;
      } else if (2 & e.button) {
        t = 3;
      } else if (4 & e.button) {
        t = 2;
      }
    }
    if (w && e.ctrlKey && 1 == t) {
      t = 3;
    }
    return t;
  }
  var gt;
  var vt;
  var mt = function () {
    if (x && C < 9) {
      return false;
    }
    var e = A("div");
    return "draggable" in e || "dragDrop" in e;
  }();
  function yt(e) {
    if (null == gt) {
      var t = A("span", "​");
      M(e).appendChild(A("span", [t, document.createTextNode("x")]));
      if (0 != e.firstChild.offsetHeight) {
        gt = t.offsetWidth <= 1 && 2 < t.offsetHeight && !(x && C < 8);
      }
    }
    var r = gt ? A("span", "​") : A("span", " ", null, "display: inline-block; width: 1px; margin-right: -1px");
    r.setAttribute("cm-text", "");
    return r;
  }
  function bt(e) {
    if (null != vt) {
      return vt;
    }
    var t = M(e).appendChild(document.createTextNode("AخA"));
    var r = k(t, 0, 1).getBoundingClientRect();
    var n = k(t, 1, 2).getBoundingClientRect();
    M(e);
    return !(!r || r.left == r.right) && (vt = n.right - r.right < 3);
  }
  var wt;
  var xt = 3 != "\n\nb".split(/\n/).length ? function (e) {
    var t = 0;
    var r = [];
    for (var n = e.length; t <= n;) {
      var i = e.indexOf("\n", t);
      if (-1 == i) {
        i = e.length;
      }
      var o = e.slice(t, "\r" == e.charAt(i - 1) ? i - 1 : i);
      var l = o.indexOf("\r");
      if (-1 != l) {
        r.push(o.slice(0, l));
        t += l + 1;
      } else {
        r.push(o);
        t = i + 1;
      }
    }
    return r;
  } : function (e) {
    return e.split(/\r\n?|\n/);
  };
  var Ct = window.getSelection ? function (e) {
    try {
      return e.selectionStart != e.selectionEnd;
    } catch (e) {
      return false;
    }
  } : function (e) {
    var t;
    try {
      t = e.ownerDocument.selection.createRange();
    } catch (e) {}
    return !(!t || t.parentElement() != e) && 0 != t.compareEndPoints("StartToEnd", t);
  };
  var St = "oncopy" in (wt = A("div")) || (wt.setAttribute("oncopy", "return;"), "function" == typeof wt.oncopy);
  var Lt = null;
  var kt = {};
  var Tt = {};
  function Mt(e) {
    if ("string" == typeof e && Tt.hasOwnProperty(e)) {
      e = Tt[e];
    } else if (e && "string" == typeof e.name && Tt.hasOwnProperty(e.name)) {
      var t = Tt[e.name];
      if ("string" == typeof t) {
        t = {
          name: t
        };
      }
      (e = Q(t, e)).name = t.name;
    } else {
      if ("string" == typeof e && /^[\w\-]+\/[\w\-]+\+xml$/.test(e)) {
        return Mt("application/xml");
      }
      if ("string" == typeof e && /^[\w\-]+\/[\w\-]+\+json$/.test(e)) {
        return Mt("application/json");
      }
    }
    return "string" == typeof e ? {
      name: e
    } : e || {
      name: "null"
    };
  }
  function Nt(e, t) {
    t = Mt(t);
    var r = kt[t.name];
    if (!r) {
      return Nt(e, "text/plain");
    }
    var n = r(e, t);
    if (Ot.hasOwnProperty(t.name)) {
      var i = Ot[t.name];
      for (var o in i) if (i.hasOwnProperty(o)) {
        if (n.hasOwnProperty(o)) {
          n["_" + o] = n[o];
        }
        n[o] = i[o];
      }
    }
    n.name = t.name;
    if (t.helperType) {
      n.helperType = t.helperType;
    }
    if (t.modeProps) {
      for (var l in t.modeProps) n[l] = t.modeProps[l];
    }
    return n;
  }
  var Ot = {};
  function At(e, t) {
    I(t, Ot.hasOwnProperty(e) ? Ot[e] : Ot[e] = {});
  }
  function Dt(e, t) {
    if (true === t) {
      return t;
    }
    if (e.copyState) {
      return e.copyState(t);
    }
    var r = {};
    for (var n in t) {
      var i = t[n];
      if (i instanceof Array) {
        i = i.concat([]);
      }
      r[n] = i;
    }
    return r;
  }
  function Wt(e, t) {
    for (var r; e.innerMode && (r = e.innerMode(t)) && r.mode != e;) {
      t = r.state;
      e = r.mode;
    }
    return r || {
      mode: e,
      state: t
    };
  }
  function Ht(e, t, r) {
    return !e.startState || e.startState(t, r);
  }
  var Ft = function (e, t, r) {
    this.pos = this.start = 0;
    this.string = e;
    this.tabSize = t || 8;
    this.lastColumnPos = this.lastColumnValue = 0;
    this.lineStart = 0;
    this.lineOracle = r;
  };
  Ft.prototype.eol = function () {
    return this.pos >= this.string.length;
  };
  Ft.prototype.sol = function () {
    return this.pos == this.lineStart;
  };
  Ft.prototype.peek = function () {
    return this.string.charAt(this.pos) || undefined;
  };
  Ft.prototype.next = function () {
    if (this.pos < this.string.length) {
      return this.string.charAt(this.pos++);
    }
  };
  Ft.prototype.eat = function (e) {
    var t = this.string.charAt(this.pos);
    if ("string" == typeof e ? t == e : t && (e.test ? e.test(t) : e(t))) {
      ++this.pos;
      return t;
    }
  };
  Ft.prototype.eatWhile = function (e) {
    for (var t = this.pos; this.eat(e);) {
      ;
    }
    return this.pos > t;
  };
  Ft.prototype.eatSpace = function () {
    for (var e = this.pos; /[\s\u00a0]/.test(this.string.charAt(this.pos));) {
      ++this.pos;
    }
    return this.pos > e;
  };
  Ft.prototype.skipToEnd = function () {
    this.pos = this.string.length;
  };
  Ft.prototype.skipTo = function (e) {
    var t = this.string.indexOf(e, this.pos);
    if (-1 < t) {
      this.pos = t;
      return true;
    }
  };
  Ft.prototype.backUp = function (e) {
    this.pos -= e;
  };
  Ft.prototype.column = function () {
    if (this.lastColumnPos < this.start) {
      this.lastColumnValue = z(this.string, this.start, this.tabSize, this.lastColumnPos, this.lastColumnValue);
      this.lastColumnPos = this.start;
    }
    return this.lastColumnValue - (this.lineStart ? z(this.string, this.lineStart, this.tabSize) : 0);
  };
  Ft.prototype.indentation = function () {
    return z(this.string, null, this.tabSize) - (this.lineStart ? z(this.string, this.lineStart, this.tabSize) : 0);
  };
  Ft.prototype.match = function (e, t, r) {
    if ("string" != typeof e) {
      var n = this.string.slice(this.pos).match(e);
      return n && 0 < n.index ? null : (n && false !== t && (this.pos += n[0].length), n);
    }
    if ((r ? this.string.substr(this.pos, e.length).toLowerCase() : this.string.substr(this.pos, e.length)) == (r ? e.toLowerCase() : e)) {
      if (false !== t) {
        this.pos += e.length;
      }
      return true;
    }
  };
  Ft.prototype.current = function () {
    return this.string.slice(this.start, this.pos);
  };
  Ft.prototype.hideFirstChars = function (e, t) {
    this.lineStart += e;
    try {
      return t();
    } finally {
      this.lineStart -= e;
    }
  };
  Ft.prototype.lookAhead = function (e) {
    var t = this.lineOracle;
    return t && t.lookAhead(e);
  };
  Ft.prototype.baseToken = function () {
    var e = this.lineOracle;
    return e && e.baseToken(this.pos);
  };
  var Pt = function (e, t) {
    this.state = e;
    this.lookAhead = t;
  };
  var Et = function (e, t, r, n) {
    this.state = t;
    this.doc = e;
    this.line = r;
    this.maxLookAhead = n || 0;
    this.baseTokens = null;
    this.baseTokenPos = 1;
  };
  function It(t, r, n, e) {
    var a = [t.state.modeGen];
    var i = {};
    Xt(t, r.text, t.doc.mode, n, function (e, t) {
      return a.push(e, t);
    }, i, e);
    var u = n.state;
    var o = function (e) {
      n.baseTokens = a;
      var o = t.state.overlays[e];
      var l = 1;
      var s = 0;
      n.state = true;
      Xt(t, r.text, o.mode, n, function (e, t) {
        for (var r = l; s < e;) {
          var n = a[l];
          if (e < n) {
            a.splice(l, 1, e, a[l + 1], n);
          }
          l += 2;
          s = Math.min(e, n);
        }
        if (t) {
          if (o.opaque) {
            a.splice(r, l - r, e, "overlay " + t);
            l = r + 2;
          } else {
            for (; r < l; r += 2) {
              var i = a[r + 1];
              a[r + 1] = (i ? i + " " : "") + "overlay " + t;
            }
          }
        }
      }, i);
      n.state = u;
      n.baseTokens = null;
      n.baseTokenPos = 1;
    };
    for (var l = 0; l < t.state.overlays.length; ++l) {
      o(l);
    }
    return {
      styles: a,
      classes: i.bgClass || i.textClass ? i : null
    };
  }
  function zt(e, t, r) {
    if (!t.styles || t.styles[0] != e.state.modeGen) {
      var n = Rt(e, fe(t));
      var i = t.text.length > e.options.maxHighlightLength && Dt(e.doc.mode, n.state);
      var o = It(e, t, n);
      if (i) {
        n.state = i;
      }
      t.stateAfter = n.save(!i);
      t.styles = o.styles;
      if (o.classes) {
        t.styleClasses = o.classes;
      } else if (t.styleClasses) {
        t.styleClasses = null;
      }
      if (r === e.doc.highlightFrontier) {
        e.doc.modeFrontier = Math.max(e.doc.modeFrontier, ++e.doc.highlightFrontier);
      }
    }
    return t.styles;
  }
  function Rt(r, n, e) {
    var t = r.doc;
    var i = r.display;
    if (!t.mode.startState) {
      return new Et(t, true, n);
    }
    var o = function (e, t, r) {
      var n;
      var i;
      var o = e.doc;
      var l = r ? -1 : t - (e.doc.mode.innerMode ? 1e3 : 100);
      for (var s = t; l < s; --s) {
        if (s <= o.first) {
          return o.first;
        }
        var a = ae(o, s - 1);
        var u = a.stateAfter;
        if (u && (!r || s + (u instanceof Pt ? u.lookAhead : 0) <= o.modeFrontier)) {
          return s;
        }
        var c = z(a.text, null, e.options.tabSize);
        if (null == i || c < n) {
          i = s - 1;
          n = c;
        }
      }
      return i;
    }(r, n, e);
    var l = o > t.first && ae(t, o - 1).stateAfter;
    var s = l ? Et.fromSaved(t, l, o) : new Et(t, !t.mode.startState || t.mode.startState(undefined, undefined), o);
    t.iter(o, n, function (e) {
      Bt(r, e.text, s);
      var t = s.line;
      e.stateAfter = t == n - 1 || t % 5 == 0 || t >= i.viewFrom && t < i.viewTo ? s.save() : null;
      s.nextLine();
    });
    if (e) {
      t.modeFrontier = s.line;
    }
    return s;
  }
  function Bt(e, t, r, n) {
    var i = e.doc.mode;
    var o = new Ft(t, e.options.tabSize, r);
    o.start = o.pos = n || 0;
    for ("" == t && Gt(i, r.state); !o.eol();) {
      Ut(i, o, r.state);
      o.start = o.pos;
    }
  }
  function Gt(e, t) {
    if (e.blankLine) {
      return e.blankLine(t);
    }
    if (e.innerMode) {
      var r = Wt(e, t);
      return r.mode.blankLine ? r.mode.blankLine(r.state) : undefined;
    }
  }
  function Ut(e, t, r, n) {
    for (var i = 0; i < 10; i++) {
      if (n) {
        n[0] = Wt(e, r).mode;
      }
      var o = e.token(t, r);
      if (t.pos > t.start) {
        return o;
      }
    }
    throw new Error("Mode " + e.name + " failed to advance stream.");
  }
  Et.prototype.lookAhead = function (e) {
    var t = this.doc.getLine(this.line + e);
    if (null != t && e > this.maxLookAhead) {
      this.maxLookAhead = e;
    }
    return t;
  };
  Et.prototype.baseToken = function (e) {
    if (!this.baseTokens) {
      return null;
    }
    for (; this.baseTokens[this.baseTokenPos] <= e;) {
      this.baseTokenPos += 2;
    }
    var t = this.baseTokens[this.baseTokenPos + 1];
    return {
      type: t && t.replace(/( |^)overlay .*/, ""),
      size: this.baseTokens[this.baseTokenPos] - e
    };
  };
  Et.prototype.nextLine = function () {
    this.line++;
    if (0 < this.maxLookAhead) {
      this.maxLookAhead--;
    }
  };
  Et.fromSaved = function (e, t, r) {
    return t instanceof Pt ? new Et(e, Dt(e.mode, t.state), r, t.lookAhead) : new Et(e, Dt(e.mode, t), r);
  };
  Et.prototype.save = function (e) {
    var t = false !== e ? Dt(this.doc.mode, this.state) : this.state;
    return 0 < this.maxLookAhead ? new Pt(t, this.maxLookAhead) : t;
  };
  var Vt = function (e, t, r) {
    this.start = e.start;
    this.end = e.pos;
    this.string = e.current();
    this.type = t || null;
    this.state = r;
  };
  function Kt(e, t, r, n) {
    var i;
    var o;
    var l = e.doc;
    var s = l.mode;
    var a = ae(l, (t = Se(l, t)).line);
    var u = Rt(e, t.line, r);
    var c = new Ft(a.text, e.options.tabSize, u);
    for (n && (o = []); (n || c.pos < t.ch) && !c.eol();) {
      c.start = c.pos;
      i = Ut(s, c, u.state);
      if (n) {
        o.push(new Vt(c, i, Dt(l.mode, u.state)));
      }
    }
    return n ? o : new Vt(c, i, u.state);
  }
  function jt(e, t) {
    if (e) {
      for (;;) {
        var r = e.match(/(?:^|\s+)line-(background-)?(\S+)/);
        if (!r) {
          break;
        }
        e = e.slice(0, r.index) + e.slice(r.index + r[0].length);
        var n = r[1] ? "bgClass" : "textClass";
        if (null == t[n]) {
          t[n] = r[2];
        } else if (!new RegExp("(?:^|s)" + r[2] + "(?:$|s)").test(t[n])) {
          t[n] += " " + r[2];
        }
      }
    }
    return e;
  }
  function Xt(e, t, r, n, i, o, l) {
    var s = r.flattenSpans;
    if (null == s) {
      s = e.options.flattenSpans;
    }
    var a;
    var u = 0;
    var c = null;
    var h = new Ft(t, e.options.tabSize, n);
    var f = e.options.addModeClass && [null];
    for ("" == t && jt(Gt(r, n.state), o); !h.eol();) {
      a = h.pos > e.options.maxHighlightLength ? (s = false, l && Bt(e, t, n, h.pos), h.pos = t.length, null) : jt(Ut(r, h, n.state, f), o);
      if (f) {
        var d = f[0].name;
        if (d) {
          a = "m-" + (a ? d + " " + a : d);
        }
      }
      if (!s || c != a) {
        for (; u < h.start;) {
          i(u = Math.min(h.start, u + 5e3), c);
        }
        c = a;
      }
      h.start = h.pos;
    }
    for (; u < h.pos;) {
      var p = Math.min(h.pos, u + 5e3);
      i(p, c);
      u = p;
    }
  }
  var Yt = function (e, t, r) {
    this.text = e;
    He(this, t);
    this.height = r ? r(this) : 1;
  };
  Yt.prototype.lineNo = function () {
    return fe(this);
  };
  at(Yt);
  var _t = {};
  var $t = {};
  function qt(e, t) {
    if (!e || /^\s*$/.test(e)) {
      return null;
    }
    var r = t.addModeClass ? $t : _t;
    return r[e] || (r[e] = e.replace(/\S+/g, "cm-$&"));
  }
  function Zt(e, t) {
    var r = O("span", null, null, b ? "padding-right: .1px" : null);
    var n = {
      pre: O("pre", [r], "CodeMirror-line"),
      content: r,
      col: 0,
      pos: 0,
      cm: e,
      trailingSpace: false,
      splitSpaces: e.getOption("lineWrapping")
    };
    t.measure = {};
    for (var i = 0; i <= (t.rest ? t.rest.length : 0); i++) {
      var o = i ? t.rest[i - 1] : t.line;
      var l = undefined;
      n.pos = 0;
      n.addToken = Jt;
      if (bt(e.display.measure) && (l = Je(o, e.doc.direction))) {
        n.addToken = er(n.addToken, l);
      }
      n.map = [];
      rr(o, n, zt(e, o, t != e.display.externalMeasured && fe(o)));
      if (o.styleClasses) {
        if (o.styleClasses.bgClass) {
          n.bgClass = F(o.styleClasses.bgClass, n.bgClass || "");
        }
        if (o.styleClasses.textClass) {
          n.textClass = F(o.styleClasses.textClass, n.textClass || "");
        }
      }
      if (0 == n.map.length) {
        n.map.push(0, 0, n.content.appendChild(yt(e.display.measure)));
      }
      if (0 == i) {
        t.measure.map = n.map;
        t.measure.cache = {};
      } else {
        (t.measure.maps || (t.measure.maps = [])).push(n.map);
        (t.measure.caches || (t.measure.caches = [])).push({});
      }
    }
    if (b) {
      var s = n.content.lastChild;
      if (/\bcm-tab\b/.test(s.className) || s.querySelector && s.querySelector(".cm-tab")) {
        n.content.className = "cm-tab-wrap-hack";
      }
    }
    it(e, "renderLine", e, t.line, n.pre);
    if (n.pre.className) {
      n.textClass = F(n.pre.className, n.textClass || "");
    }
    return n;
  }
  function Qt(e) {
    var t = A("span", "•", "cm-invalidchar");
    t.title = "\\u" + e.charCodeAt(0).toString(16);
    t.setAttribute("aria-label", t.title);
    return t;
  }
  function Jt(e, t, r, n, i, o, l) {
    if (t) {
      var s;
      var a = e.splitSpaces ? function (e, t) {
        if (1 < e.length && !/  /.test(e)) {
          return e;
        }
        var r = t;
        var n = "";
        for (var i = 0; i < e.length; i++) {
          var o = e.charAt(i);
          if (!(" " != o || !r || i != e.length - 1 && 32 != e.charCodeAt(i + 1))) {
            o = " ";
          }
          n += o;
          r = " " == o;
        }
        return n;
      }(t, e.trailingSpace) : t;
      var u = e.cm.state.specialChars;
      var c = false;
      if (u.test(t)) {
        s = document.createDocumentFragment();
        for (var h = 0;;) {
          u.lastIndex = h;
          var f = u.exec(t);
          var d = f ? f.index - h : t.length - h;
          if (d) {
            var p = document.createTextNode(a.slice(h, h + d));
            if (x && C < 9) {
              s.appendChild(A("span", [p]));
            } else {
              s.appendChild(p);
            }
            e.map.push(e.pos, e.pos + d, p);
            e.col += d;
            e.pos += d;
          }
          if (!f) {
            break;
          }
          h += d + 1;
          var g = undefined;
          if ("\t" == f[0]) {
            var v = e.cm.options.tabSize;
            var m = v - e.col % v;
            (g = s.appendChild(A("span", _(m), "cm-tab"))).setAttribute("role", "presentation");
            g.setAttribute("cm-text", "\t");
            e.col += m;
          } else {
            if ("\r" == f[0] || "\n" == f[0]) {
              (g = s.appendChild(A("span", "\r" == f[0] ? "␍" : "␤", "cm-invalidchar"))).setAttribute("cm-text", f[0]);
            } else {
              (g = e.cm.options.specialCharPlaceholder(f[0])).setAttribute("cm-text", f[0]);
              if (x && C < 9) {
                s.appendChild(A("span", [g]));
              } else {
                s.appendChild(g);
              }
            }
            e.col += 1;
          }
          e.map.push(e.pos, e.pos + 1, g);
          e.pos++;
        }
      } else {
        e.col += t.length;
        s = document.createTextNode(a);
        e.map.push(e.pos, e.pos + t.length, s);
        if (x && C < 9) {
          c = true;
        }
        e.pos += t.length;
      }
      e.trailingSpace = 32 == a.charCodeAt(t.length - 1);
      if (r || n || i || c || o) {
        var y = r || "";
        if (n) {
          y += n;
        }
        if (i) {
          y += i;
        }
        var b = A("span", [s], y, o);
        if (l) {
          for (var w in l) if (l.hasOwnProperty(w) && "style" != w && "class" != w) {
            b.setAttribute(w, l[w]);
          }
        }
        return e.content.appendChild(b);
      }
      e.content.appendChild(s);
    }
  }
  function er(h, f) {
    return function (e, t, r, n, i, o, l) {
      r = r ? r + " cm-force-border" : "cm-force-border";
      var s = e.pos;
      for (var a = s + t.length;;) {
        var u = undefined;
        for (var c = 0; c < f.length && !((u = f[c]).to > s && u.from <= s); c++) {
          ;
        }
        if (u.to >= a) {
          return h(e, t, r, n, i, o, l);
        }
        h(e, t.slice(0, u.to - s), r, n, null, o, l);
        n = null;
        t = t.slice(u.to - s);
        s = u.to;
      }
    };
  }
  function tr(e, t, r, n) {
    var i = !n && r.widgetNode;
    if (i) {
      e.map.push(e.pos, e.pos + t, i);
    }
    if (!n && e.cm.display.input.needsContentAttribute) {
      if (!i) {
        i = e.content.appendChild(document.createElement("span"));
      }
      i.setAttribute("cm-marker", r.id);
    }
    if (i) {
      e.cm.display.input.setUneditable(i);
      e.content.appendChild(i);
    }
    e.pos += t;
    e.trailingSpace = false;
  }
  function rr(e, t, r) {
    var n = e.markedSpans;
    var i = e.text;
    var o = 0;
    if (n) {
      var l;
      var s;
      var a;
      var u;
      var c;
      var h;
      var f;
      var d = i.length;
      var p = 0;
      var g = 1;
      var v = "";
      for (var m = 0;;) {
        if (m == p) {
          a = u = c = s = "";
          h = f = null;
          m = Infinity;
          var y = [];
          var b = undefined;
          for (var w = 0; w < n.length; ++w) {
            var x = n[w];
            var C = x.marker;
            if ("bookmark" == C.type && x.from == p && C.widgetNode) {
              y.push(C);
            } else if (x.from <= p && (null == x.to || x.to > p || C.collapsed && x.to == p && x.from == p)) {
              if (null != x.to && x.to != p && m > x.to) {
                m = x.to;
                u = "";
              }
              if (C.className) {
                a += " " + C.className;
              }
              if (C.css) {
                s = (s ? s + ";" : "") + C.css;
              }
              if (C.startStyle && x.from == p) {
                c += " " + C.startStyle;
              }
              if (C.endStyle && x.to == m) {
                (b || (b = [])).push(C.endStyle, x.to);
              }
              if (C.title) {
                (f || (f = {})).title = C.title;
              }
              if (C.attributes) {
                for (var S in C.attributes) (f || (f = {}))[S] = C.attributes[S];
              }
              if (C.collapsed && (!h || Ee(h.marker, C) < 0)) {
                h = x;
              }
            } else if (x.from > p && m > x.from) {
              m = x.from;
            }
          }
          if (b) {
            for (var L = 0; L < b.length; L += 2) {
              if (b[L + 1] == m) {
                u += " " + b[L];
              }
            }
          }
          if (!h || h.from == p) {
            for (var k = 0; k < y.length; ++k) {
              tr(t, 0, y[k]);
            }
          }
          if (h && (h.from || 0) == p) {
            tr(t, (null == h.to ? d + 1 : h.to) - p, h.marker, null == h.from);
            if (null == h.to) {
              return;
            }
            if (h.to == p) {
              h = false;
            }
          }
        }
        if (d <= p) {
          break;
        }
        for (var T = Math.min(d, m);;) {
          if (v) {
            var M = p + v.length;
            if (!h) {
              var N = T < M ? v.slice(0, T - p) : v;
              t.addToken(t, N, l ? l + a : a, c, p + N.length == m ? u : "", s, f);
            }
            if (T <= M) {
              v = v.slice(T - p);
              p = T;
              break;
            }
            p = M;
            c = "";
          }
          v = i.slice(o, o = r[g++]);
          l = qt(r[g++], t.cm.options);
        }
      }
    } else {
      for (var O = 1; O < r.length; O += 2) {
        t.addToken(t, i.slice(o, o = r[O]), qt(r[O + 1], t.cm.options));
      }
    }
  }
  function nr(e, t, r) {
    this.line = t;
    this.rest = function (e) {
      var t;
      for (var r; t = Ie(e, false);) {
        e = t.find(1, true).line;
        (r || (r = [])).push(e);
      }
      return r;
    }(t);
    this.size = this.rest ? fe(this.rest[this.rest.length - 1]) - r + 1 : 1;
    this.node = this.text = null;
    this.hidden = je(e, t);
  }
  function ir(e, t, r) {
    var n;
    var i = [];
    for (var o = t; o < r; o = n) {
      var l = new nr(e.doc, ae(e.doc, o), o);
      n = o + l.size;
      i.push(l);
    }
    return i;
  }
  var or = null;
  var lr = null;
  function sr(e, t) {
    var r = e._handlers && e._handlers[t] || et;
    if (r.length) {
      var n;
      var i = Array.prototype.slice.call(arguments, 2);
      if (or) {
        n = or.delayedCallbacks;
      } else if (lr) {
        n = lr;
      } else {
        n = lr = [];
        setTimeout(ar, 0);
      }
      var o = function (e) {
        n.push(function () {
          return r[e].apply(null, i);
        });
      };
      for (var l = 0; l < r.length; ++l) {
        o(l);
      }
    }
  }
  function ar() {
    var e = lr;
    lr = null;
    for (var t = 0; t < e.length; ++t) {
      e[t]();
    }
  }
  function ur(e, t, r, n) {
    for (var i = 0; i < t.changes.length; i++) {
      var o = t.changes[i];
      if ("text" == o) {
        fr(e, t);
      } else if ("gutter" == o) {
        pr(e, t, r, n);
      } else if ("class" == o) {
        dr(e, t);
      } else if ("widget" == o) {
        gr(e, t, n);
      }
    }
    t.changes = null;
  }
  function cr(e) {
    if (e.node == e.text) {
      e.node = A("div", null, null, "position: relative");
      if (e.text.parentNode) {
        e.text.parentNode.replaceChild(e.node, e.text);
      }
      e.node.appendChild(e.text);
      if (x && C < 8) {
        e.node.style.zIndex = 2;
      }
    }
    return e.node;
  }
  function hr(e, t) {
    var r = e.display.externalMeasured;
    return r && r.line == t.line ? (e.display.externalMeasured = null, t.measure = r.measure, r.built) : Zt(e, t);
  }
  function fr(e, t) {
    var r = t.text.className;
    var n = hr(e, t);
    if (t.text == t.node) {
      t.node = n.pre;
    }
    t.text.parentNode.replaceChild(n.pre, t.text);
    t.text = n.pre;
    if (n.bgClass != t.bgClass || n.textClass != t.textClass) {
      t.bgClass = n.bgClass;
      t.textClass = n.textClass;
      dr(e, t);
    } else if (r) {
      t.text.className = r;
    }
  }
  function dr(e, t) {
    !function (e, t) {
      var r = t.bgClass ? t.bgClass + " " + (t.line.bgClass || "") : t.line.bgClass;
      if (r) {
        r += " CodeMirror-linebackground";
      }
      if (t.background) {
        if (r) {
          t.background.className = r;
        } else {
          t.background.parentNode.removeChild(t.background);
          t.background = null;
        }
      } else if (r) {
        var n = cr(t);
        t.background = n.insertBefore(A("div", null, r), n.firstChild);
        e.display.input.setUneditable(t.background);
      }
    }(e, t);
    if (t.line.wrapClass) {
      cr(t).className = t.line.wrapClass;
    } else if (t.node != t.text) {
      t.node.className = "";
    }
    var r = t.textClass ? t.textClass + " " + (t.line.textClass || "") : t.line.textClass;
    t.text.className = r || "";
  }
  function pr(e, t, r, n) {
    if (t.gutter) {
      t.node.removeChild(t.gutter);
      t.gutter = null;
    }
    if (t.gutterBackground) {
      t.node.removeChild(t.gutterBackground);
      t.gutterBackground = null;
    }
    if (t.line.gutterClass) {
      var i = cr(t);
      t.gutterBackground = A("div", null, "CodeMirror-gutter-background " + t.line.gutterClass, "left: " + (e.options.fixedGutter ? n.fixedPos : -n.gutterTotalWidth) + "px; width: " + n.gutterTotalWidth + "px");
      e.display.input.setUneditable(t.gutterBackground);
      i.insertBefore(t.gutterBackground, t.text);
    }
    var o = t.line.gutterMarkers;
    if (e.options.lineNumbers || o) {
      var l = cr(t);
      var s = t.gutter = A("div", null, "CodeMirror-gutter-wrapper", "left: " + (e.options.fixedGutter ? n.fixedPos : -n.gutterTotalWidth) + "px");
      e.display.input.setUneditable(s);
      l.insertBefore(s, t.text);
      if (t.line.gutterClass) {
        s.className += " " + t.line.gutterClass;
      }
      if (!(!e.options.lineNumbers || o && o["CodeMirror-linenumbers"])) {
        t.lineNumber = s.appendChild(A("div", String(e.options.lineNumberFormatter(r + e.options.firstLineNumber)), "CodeMirror-linenumber CodeMirror-gutter-elt", "left: " + n.gutterLeft["CodeMirror-linenumbers"] + "px; width: " + e.display.lineNumInnerWidth + "px"));
      }
      if (o) {
        for (var a = 0; a < e.options.gutters.length; ++a) {
          var u = e.options.gutters[a];
          var c = o.hasOwnProperty(u) && o[u];
          if (c) {
            s.appendChild(A("div", [c], "CodeMirror-gutter-elt", "left: " + n.gutterLeft[u] + "px; width: " + n.gutterWidth[u] + "px"));
          }
        }
      }
    }
  }
  function gr(e, t, r) {
    if (t.alignable) {
      t.alignable = null;
    }
    var n = t.node.firstChild;
    for (var i = undefined; n; n = i) {
      i = n.nextSibling;
      if ("CodeMirror-linewidget" == n.className) {
        t.node.removeChild(n);
      }
    }
    vr(e, t, r);
  }
  function vr(e, t, r) {
    mr(e, t.line, t, r, true);
    if (t.rest) {
      for (var n = 0; n < t.rest.length; n++) {
        mr(e, t.rest[n], t, r, false);
      }
    }
  }
  function mr(e, t, r, n, i) {
    if (t.widgets) {
      var o = cr(r);
      var l = 0;
      for (var s = t.widgets; l < s.length; ++l) {
        var a = s[l];
        var u = A("div", [a.node], "CodeMirror-linewidget");
        if (!a.handleMouseEvents) {
          u.setAttribute("cm-ignore-events", "true");
        }
        yr(a, u, r, n);
        e.display.input.setUneditable(u);
        if (i && a.above) {
          o.insertBefore(u, r.gutter || r.text);
        } else {
          o.appendChild(u);
        }
        sr(a, "redraw");
      }
    }
  }
  function yr(e, t, r, n) {
    if (e.noHScroll) {
      (r.alignable || (r.alignable = [])).push(t);
      var i = n.wrapperWidth;
      t.style.left = n.fixedPos + "px";
      if (!e.coverGutter) {
        i -= n.gutterTotalWidth;
        t.style.paddingLeft = n.gutterTotalWidth + "px";
      }
      t.style.width = i + "px";
    }
    if (e.coverGutter) {
      t.style.zIndex = 5;
      t.style.position = "relative";
      if (!e.noHScroll) {
        t.style.marginLeft = -n.gutterTotalWidth + "px";
      }
    }
  }
  function br(e) {
    if (null != e.height) {
      return e.height;
    }
    var t = e.doc.cm;
    if (!t) {
      return 0;
    }
    if (!D(document.body, e.node)) {
      var r = "position: relative;";
      if (e.coverGutter) {
        r += "margin-left: -" + t.display.gutters.offsetWidth + "px;";
      }
      if (e.noHScroll) {
        r += "width: " + t.display.wrapper.clientWidth + "px;";
      }
      M(t.display.measure).appendChild(A("div", [e.node], null, r));
    }
    return e.height = e.node.parentNode.offsetHeight;
  }
  function wr(e, t) {
    for (var r = t.target || t.srcElement; r != e.wrapper; r = r.parentNode) {
      if (!r || 1 == r.nodeType && "true" == r.getAttribute("cm-ignore-events") || r.parentNode == e.sizer && r != e.mover) {
        return true;
      }
    }
  }
  function Sr(e) {
    if (e.cachedPaddingH) {
      return e.cachedPaddingH;
    }
    var t = M(e.measure).appendChild(A("pre", "x"));
    var r = window.getComputedStyle ? window.getComputedStyle(t) : t.currentStyle;
    var n = {
      left: parseInt(r.paddingLeft),
      right: parseInt(r.paddingRight)
    };
    if (!(isNaN(n.left) || isNaN(n.right))) {
      e.cachedPaddingH = n;
    }
    return n;
  }
  function Mr(e, t, r) {
    if (e.line == t) {
      return {
        map: e.measure.map,
        cache: e.measure.cache
      };
    }
    for (var n = 0; n < e.rest.length; n++) {
      if (e.rest[n] == t) {
        return {
          map: e.measure.maps[n],
          cache: e.measure.caches[n]
        };
      }
    }
    for (var i = 0; i < e.rest.length; i++) {
      if (fe(e.rest[i]) > r) {
        return {
          map: e.measure.maps[i],
          cache: e.measure.caches[i],
          before: true
        };
      }
    }
  }
  function Or(e, t) {
    if (t >= e.display.viewFrom && t < e.display.viewTo) {
      return e.display.view[sn(e, t)];
    }
    var r = e.display.externalMeasured;
    return r && t >= r.lineN && t < r.lineN + r.size ? r : undefined;
  }
  function Ar(e, t) {
    var r = fe(t);
    var n = Or(e, r);
    if (n && !n.text) {
      n = null;
    } else if (n && n.changes) {
      ur(e, n, r, tn(e));
      e.curOp.forceUpdate = true;
    }
    if (!n) {
      n = function (e, t) {
        var r = fe(t = Ue(t));
        var n = e.display.externalMeasured = new nr(e.doc, t, r);
        n.lineN = r;
        var i = n.built = Zt(e, n);
        n.text = i.pre;
        M(e.display.lineMeasure).appendChild(i.pre);
        return n;
      }(e, t);
    }
    var i = Mr(n, t, r);
    return {
      line: t,
      view: n,
      rect: null,
      map: i.map,
      cache: i.cache,
      before: i.before,
      hasHeights: false
    };
  }
  function Dr(e, t, r, n, i) {
    if (t.before) {
      r = -1;
    }
    var o;
    var l = r + (n || "");
    if (t.cache.hasOwnProperty(l)) {
      o = t.cache[l];
    } else {
      if (!t.rect) {
        t.rect = t.view.text.getBoundingClientRect();
      }
      if (!t.hasHeights) {
        !function (e, t, r) {
          var n = e.options.lineWrapping;
          var i = n && e.display.scroller.clientWidth - (30 - e.display.nativeBarWidth) - e.display.barWidth;
          if (!t.measure.heights || n && t.measure.width != i) {
            var o = t.measure.heights = [];
            if (n) {
              t.measure.width = i;
              var l = t.text.firstChild.getClientRects();
              for (var s = 0; s < l.length - 1; s++) {
                var a = l[s];
                var u = l[s + 1];
                if (2 < Math.abs(a.bottom - u.bottom)) {
                  o.push((a.bottom + u.top) / 2 - r.top);
                }
              }
            }
            o.push(r.bottom - r.top);
          }
        }(e, t.view, t.rect);
        t.hasHeights = true;
      }
      if (!(o = function (e, t, r, n) {
        var i;
        var o = Fr(t.map, r, n);
        var l = o.node;
        var s = o.start;
        var a = o.end;
        var u = o.collapse;
        if (3 == l.nodeType) {
          for (var c = 0; c < 4; c++) {
            for (; s && 768 <= t.line.text.charAt(o.coverStart + s).charCodeAt(0) && ne.test(t.line.text.charAt(o.coverStart + s));) {
              --s;
            }
            for (; o.coverStart + a < o.coverEnd && 768 <= t.line.text.charAt(o.coverStart + a).charCodeAt(0) && ne.test(t.line.text.charAt(o.coverStart + a));) {
              ++a;
            }
            if ((i = x && C < 9 && 0 == s && a == o.coverEnd - o.coverStart ? l.parentNode.getBoundingClientRect() : Pr(k(l, s, a).getClientRects(), n)).left || i.right || 0 == s) {
              break;
            }
            a = s;
            s -= 1;
            u = "right";
          }
          if (x && C < 11) {
            i = function (e, t) {
              if (!window.screen || null == screen.logicalXDPI || screen.logicalXDPI == screen.deviceXDPI || !function (e) {
                if (null != Lt) {
                  return Lt;
                }
                var t = M(e).appendChild(A("span", "x"));
                var r = t.getBoundingClientRect();
                var n = k(t, 0, 1).getBoundingClientRect();
                return Lt = 1 < Math.abs(r.left - n.left);
              }(e)) {
                return t;
              }
              var r = screen.logicalXDPI / screen.deviceXDPI;
              var n = screen.logicalYDPI / screen.deviceYDPI;
              return {
                left: t.left * r,
                right: t.right * r,
                top: t.top * n,
                bottom: t.bottom * n
              };
            }(e.display.measure, i);
          }
        } else {
          var h;
          if (0 < s) {
            u = n = "right";
          }
          i = e.options.lineWrapping && 1 < (h = l.getClientRects()).length ? h["right" == n ? h.length - 1 : 0] : l.getBoundingClientRect();
        }
        if (x && C < 9 && !s && (!i || !i.left && !i.right)) {
          var f = l.parentNode.getClientRects()[0];
          i = f ? {
            left: f.left,
            right: f.left + en(e.display),
            top: f.top,
            bottom: f.bottom
          } : Hr;
        }
        var d = i.top - t.rect.top;
        var p = i.bottom - t.rect.top;
        var g = (d + p) / 2;
        var v = t.view.measure.heights;
        for (var m = 0; m < v.length - 1 && !(g < v[m]); m++) {
          ;
        }
        var y = m ? v[m - 1] : 0;
        var b = v[m];
        var w = {
          left: ("right" == u ? i.right : i.left) - t.rect.left,
          right: ("left" == u ? i.left : i.right) - t.rect.left,
          top: y,
          bottom: b
        };
        if (!(i.left || i.right)) {
          w.bogus = true;
        }
        if (!e.options.singleCursorHeightPerLine) {
          w.rtop = d;
          w.rbottom = p;
        }
        return w;
      }(e, t, r, n)).bogus) {
        t.cache[l] = o;
      }
    }
    return {
      left: o.left,
      right: o.right,
      top: i ? o.rtop : o.top,
      bottom: i ? o.rbottom : o.bottom
    };
  }
  var Wr;
  var Hr = {
    left: 0,
    right: 0,
    top: 0,
    bottom: 0
  };
  function Fr(e, t, r) {
    var n;
    var i;
    var o;
    var l;
    var s;
    var a;
    for (var u = 0; u < e.length; u += 3) {
      s = e[u];
      a = e[u + 1];
      if (t < s) {
        i = 0;
        o = 1;
        l = "left";
      } else if (t < a) {
        o = (i = t - s) + 1;
      } else if (u == e.length - 3 || t == a && e[u + 3] > t) {
        i = (o = a - s) - 1;
        if (a <= t) {
          l = "right";
        }
      }
      if (null != i) {
        n = e[u + 2];
        if (s == a && r == (n.insertLeft ? "left" : "right")) {
          l = r;
        }
        if ("left" == r && 0 == i) {
          for (; u && e[u - 2] == e[u - 3] && e[u - 1].insertLeft;) {
            n = e[2 + (u -= 3)];
            l = "left";
          }
        }
        if ("right" == r && i == a - s) {
          for (; u < e.length - 3 && e[u + 3] == e[u + 4] && !e[u + 5].insertLeft;) {
            n = e[(u += 3) + 2];
            l = "right";
          }
        }
        break;
      }
    }
    return {
      node: n,
      start: i,
      end: o,
      collapse: l,
      coverStart: s,
      coverEnd: a
    };
  }
  function Pr(e, t) {
    var r = Hr;
    if ("left" == t) {
      for (var n = 0; n < e.length && (r = e[n]).left == r.right; n++) {
        ;
      }
    } else {
      for (var i = e.length - 1; 0 <= i && (r = e[i]).left == r.right; i--) {
        ;
      }
    }
    return r;
  }
  function Er(e) {
    if (e.measure && (e.measure.cache = {}, e.measure.heights = null, e.rest)) {
      for (var t = 0; t < e.rest.length; t++) {
        e.measure.caches[t] = {};
      }
    }
  }
  function Ir(e) {
    e.display.externalMeasure = null;
    M(e.display.lineMeasure);
    for (var t = 0; t < e.display.view.length; t++) {
      Er(e.display.view[t]);
    }
  }
  function zr(e) {
    Ir(e);
    e.display.cachedCharWidth = e.display.cachedTextHeight = e.display.cachedPaddingH = null;
    if (!e.options.lineWrapping) {
      e.display.maxLineChanged = true;
    }
    e.display.lineNumChars = null;
  }
  function Gr(e) {
    var t = 0;
    if (e.widgets) {
      for (var r = 0; r < e.widgets.length; ++r) {
        if (e.widgets[r].above) {
          t += br(e.widgets[r]);
        }
      }
    }
    return t;
  }
  function Ur(e, t, r, n, i) {
    if (!i) {
      var o = Gr(t);
      r.top += o;
      r.bottom += o;
    }
    if ("line" == n) {
      return r;
    }
    if (!n) {
      n = "local";
    }
    var l = Ye(t);
    if ("local" == n) {
      l += e.display.lineSpace.offsetTop;
    } else {
      l -= e.display.viewOffset;
    }
    if ("page" == n || "window" == n) {
      var s = e.display.lineSpace.getBoundingClientRect();
      l += s.top + ("window" == n ? 0 : l && h ? -(document.body.getBoundingClientRect().top - parseInt(getComputedStyle(document.body).marginTop)) : window.pageYOffset || (document.documentElement || document.body).scrollTop);
      var a = s.left + ("window" == n ? 0 : l && h ? -(document.body.getBoundingClientRect().left - parseInt(getComputedStyle(document.body).marginLeft)) : window.pageXOffset || (document.documentElement || document.body).scrollLeft);
      r.left += a;
      r.right += a;
    }
    r.top += l;
    r.bottom += l;
    return r;
  }
  function Vr(e, t, r) {
    if ("div" == r) {
      return t;
    }
    var n = t.left;
    var i = t.top;
    if ("page" == r) {
      n -= l && h ? -(document.body.getBoundingClientRect().left - parseInt(getComputedStyle(document.body).marginLeft)) : window.pageXOffset || (document.documentElement || document.body).scrollLeft;
      i -= l && h ? -(document.body.getBoundingClientRect().top - parseInt(getComputedStyle(document.body).marginTop)) : window.pageYOffset || (document.documentElement || document.body).scrollTop;
    } else if ("local" == r || !r) {
      var o = e.display.sizer.getBoundingClientRect();
      n += o.left;
      i += o.top;
    }
    var l = e.display.lineSpace.getBoundingClientRect();
    return {
      left: n - l.left,
      top: i - l.top
    };
  }
  function Kr(e, t, r, n, i) {
    if (!n) {
      n = ae(e.doc, t.line);
    }
    return Ur(e, n, Dr(e, Ar(e, n), t.ch, i), r);
  }
  function jr(n, e, i, o, l, s) {
    function a(e, t) {
      var r = Dr(n, l, e, t ? "right" : "left", s);
      if (t) {
        r.left = r.right;
      } else {
        r.right = r.left;
      }
      return Ur(n, o, r, i);
    }
    o = o || ae(n.doc, e.line);
    if (!l) {
      l = Ar(n, o);
    }
    var u = Je(o, n.doc.direction);
    var t = e.ch;
    var r = e.sticky;
    if (t >= o.text.length) {
      t = o.text.length;
      r = "before";
    } else if (t <= 0) {
      t = 0;
      r = "after";
    }
    if (!u) {
      return a("before" == r ? t - 1 : t, "before" == r);
    }
    var f = qe;
    var d = a("before" == r ? t - 1 : t, 1 == u[t].level != ("before" == r));
    if (null != f) {
      d.other = a("before" != r ? t - 1 : t, 1 == u[t].level != ("before" != r));
    }
    return d;
  }
  function Xr(e, t) {
    var r = 0;
    t = Se(e.doc, t);
    if (!e.options.lineWrapping) {
      r = en(e.display) * t.ch;
    }
    var n = ae(e.doc, t.line);
    var i = Ye(n) + e.display.lineSpace.offsetTop;
    return {
      left: r,
      right: r,
      top: i,
      bottom: i + n.height
    };
  }
  function Yr(e, t, r, n, i) {
    var o = ve(e, t, r);
    o.xRel = i;
    if (n) {
      o.outside = true;
    }
    return o;
  }
  function _r(e, t, r) {
    var n = e.doc;
    if ((r += e.display.viewOffset) < 0) {
      return Yr(n.first, 0, null, true, -1);
    }
    var i = de(n, r);
    var o = n.first + n.size - 1;
    if (o < i) {
      return Yr(n.first + n.size - 1, ae(n, o).text.length, null, true, 1);
    }
    if (t < 0) {
      t = 0;
    }
    for (var l = ae(n, i);;) {
      var s = Qr(e, l, i, t, r);
      var a = Be(l, s.ch + (0 < s.xRel ? 1 : 0));
      if (!a) {
        return s;
      }
      var u = a.find(1);
      if (u.line == i) {
        return u;
      }
      l = ae(n, i = u.line);
    }
  }
  function $r(t, e, r, n) {
    n -= Gr(e);
    var i = e.text.length;
    var o = le(function (e) {
      return Dr(t, r, e - 1).bottom <= n;
    }, i, 0);
    return {
      begin: o,
      end: i = le(function (e) {
        return Dr(t, r, e).top > n;
      }, o, i)
    };
  }
  function qr(e, t, r, n) {
    if (!r) {
      r = Ar(e, t);
    }
    return $r(e, t, r, Ur(e, t, Dr(e, r, n), "line").top);
  }
  function Qr(r, e, t, n, i) {
    i -= Ye(e);
    var o = Ar(r, e);
    var l = Gr(e);
    var s = 0;
    var a = e.text.length;
    var u = true;
    var c = Je(e, r.doc.direction);
    if (c) {
      var h = (r.options.lineWrapping ? function (e, t, r, n, i, o, l) {
        var s = $r(e, t, n, l);
        var a = s.begin;
        var u = s.end;
        if (/\s/.test(t.text.charAt(u - 1))) {
          u--;
        }
        var c = null;
        var h = null;
        for (var f = 0; f < i.length; f++) {
          var d = i[f];
          if (!(d.from >= u || d.to <= a)) {
            var p = 1 != d.level;
            var g = Dr(e, n, p ? Math.min(u, d.to) - 1 : Math.max(a, d.from)).right;
            var v = g < o ? o - g + 1e9 : g - o;
            if (!c || v < h) {
              c = d;
              h = v;
            }
          }
        }
        if (!c) {
          c = i[i.length - 1];
        }
        if (c.from < a) {
          c = {
            from: a,
            to: c.to,
            level: c.level
          };
        }
        if (c.to > u) {
          c = {
            from: c.from,
            to: u,
            level: c.level
          };
        }
        return c;
      } : function (n, i, o, l, s, a, u) {
        var e = le(function (e) {
          var t = s[e];
          var r = 1 != t.level;
          return !(jr(n, ve(o, r ? t.to : t.from, r ? "before" : "after"), "line", i, l).bottom <= u) && (jr(n, ve(o, r ? t.to : t.from, r ? "before" : "after"), "line", i, l).top > u || jr(n, ve(o, r ? t.to : t.from, r ? "before" : "after"), "line", i, l).left > a);
        }, 0, s.length - 1);
        var t = s[e];
        if (0 < e) {
          var r = 1 != t.level;
          var c = jr(n, ve(o, r ? t.from : t.to, r ? "after" : "before"), "line", i, l);
          if (!(c.bottom <= u) && (c.top > u || c.left > a) && c.top > u) {
            t = s[e - 1];
          }
        }
        return t;
      })(r, e, t, o, c, n, i);
      s = (u = 1 != h.level) ? h.from : h.to - 1;
      a = u ? h.to : h.from - 1;
    }
    var f;
    var d;
    var p = null;
    var g = null;
    var v = le(function (e) {
      var t = Dr(r, o, e);
      t.top += l;
      t.bottom += l;
      return !!(!(t.bottom <= i) && (t.top > i || t.right > n)) && (t.top <= i && t.left <= n && (p = e, g = t), true);
    }, s, a);
    var m = false;
    if (g) {
      var y = n - g.left < g.right - n;
      var b = y == u;
      v = p + (b ? 0 : 1);
      d = b ? "after" : "before";
      f = y ? g.left : g.right;
    } else {
      if (!(u || v != a && v != s)) {
        v++;
      }
      d = 0 == v ? "after" : v == e.text.length ? "before" : Dr(r, o, v - (u ? 1 : 0)).bottom + l <= i == u ? "after" : "before";
      var w = jr(r, ve(t, v, d), "line", e, o);
      f = w.left;
      m = i < w.top || i >= w.bottom;
    }
    return Yr(t, v = oe(e.text, v, 1), d, m, n - f);
  }
  function Jr(e) {
    if (null != e.cachedTextHeight) {
      return e.cachedTextHeight;
    }
    if (null == Wr) {
      Wr = A("pre");
      for (var t = 0; t < 49; ++t) {
        Wr.appendChild(document.createTextNode("x"));
        Wr.appendChild(A("br"));
      }
      Wr.appendChild(document.createTextNode("x"));
    }
    M(e.measure).appendChild(Wr);
    var r = Wr.offsetHeight / 50;
    if (3 < r) {
      e.cachedTextHeight = r;
    }
    M(e.measure);
    return r || 1;
  }
  function en(e) {
    if (null != e.cachedCharWidth) {
      return e.cachedCharWidth;
    }
    var t = A("span", "xxxxxxxxxx");
    var r = A("pre", [t]);
    M(e.measure).appendChild(r);
    var n = t.getBoundingClientRect();
    var i = (n.right - n.left) / 10;
    if (2 < i) {
      e.cachedCharWidth = i;
    }
    return i || 10;
  }
  function tn(e) {
    var t = e.display;
    var r = {};
    var n = {};
    var i = t.gutters.clientLeft;
    var o = t.gutters.firstChild;
    for (var l = 0; o; o = o.nextSibling, ++l) {
      r[e.options.gutters[l]] = o.offsetLeft + o.clientLeft + i;
      n[e.options.gutters[l]] = o.clientWidth;
    }
    return {
      fixedPos: t.scroller.getBoundingClientRect().left - t.sizer.getBoundingClientRect().left,
      gutterTotalWidth: t.gutters.offsetWidth,
      gutterLeft: r,
      gutterWidth: n,
      wrapperWidth: t.wrapper.clientWidth
    };
  }
  function nn(n) {
    var i = Jr(n.display);
    var o = n.options.lineWrapping;
    var l = o && Math.max(5, n.display.scroller.clientWidth / en(n.display) - 3);
    return function (e) {
      if (je(n.doc, e)) {
        return 0;
      }
      var t = 0;
      if (e.widgets) {
        for (var r = 0; r < e.widgets.length; r++) {
          if (e.widgets[r].height) {
            t += e.widgets[r].height;
          }
        }
      }
      return o ? t + (Math.ceil(e.text.length / l) || 1) * i : t + i;
    };
  }
  function on(e) {
    var t = e.doc;
    var r = nn(e);
    t.iter(function (e) {
      var t = r(e);
      if (t != e.height) {
        he(e, t);
      }
    });
  }
  function ln(e, t, r, n) {
    var i = e.display;
    if (!r && "true" == (t.target || t.srcElement).getAttribute("cm-not-content")) {
      return null;
    }
    var o;
    var l;
    var s = i.lineSpace.getBoundingClientRect();
    try {
      o = t.clientX - s.left;
      l = t.clientY - s.top;
    } catch (t) {
      return null;
    }
    var a;
    var u = _r(e, o, l);
    if (n && 1 == u.xRel && (a = ae(e.doc, u.line).text).length == u.ch) {
      var c = z(a, a.length, e.options.tabSize) - a.length;
      u = ve(u.line, Math.max(0, Math.round((o - Sr(e.display).left) / en(e.display)) - c));
    }
    return u;
  }
  function sn(e, t) {
    if (t >= e.display.viewTo) {
      return null;
    }
    if ((t -= e.display.viewFrom) < 0) {
      return null;
    }
    var r = e.display.view;
    for (var n = 0; n < r.length; n++) {
      if ((t -= r[n].size) < 0) {
        return n;
      }
    }
  }
  function an(e) {
    e.display.input.showSelection(e.display.input.prepareSelection());
  }
  function un(e, t) {
    if (undefined === t) {
      t = true;
    }
    var r = e.doc;
    var n = {};
    var i = n.cursors = document.createDocumentFragment();
    var o = n.selection = document.createDocumentFragment();
    for (var l = 0; l < r.sel.ranges.length; l++) {
      if (t || l != r.sel.primIndex) {
        var s = r.sel.ranges[l];
        if (!(s.from().line >= e.display.viewTo || s.to().line < e.display.viewFrom)) {
          var a = s.empty();
          if (a || e.options.showCursorWhenSelecting) {
            cn(e, s.head, i);
          }
          if (!a) {
            fn(e, s, o);
          }
        }
      }
    }
    return n;
  }
  function cn(e, t, r) {
    var n = jr(e, t, "div", null, null, !e.options.singleCursorHeightPerLine);
    var i = r.appendChild(A("div", " ", "CodeMirror-cursor"));
    i.style.left = n.left + "px";
    i.style.top = n.top + "px";
    i.style.height = Math.max(0, n.bottom - n.top) * e.options.cursorHeight + "px";
    if (n.other) {
      var o = r.appendChild(A("div", " ", "CodeMirror-cursor CodeMirror-secondarycursor"));
      o.style.display = "";
      o.style.left = n.other.left + "px";
      o.style.top = n.other.top + "px";
      o.style.height = .85 * (n.other.bottom - n.other.top) + "px";
    }
  }
  function fn(l, e, t) {
    var r = l.display;
    var n = l.doc;
    var i = document.createDocumentFragment();
    var o = Sr(l.display);
    var T = o.left;
    var M = Math.max(r.sizerWidth, l.display.scroller.clientWidth - (30 - l.display.nativeBarWidth) - l.display.barWidth - r.sizer.offsetLeft) - o.right;
    var N = "ltr" == n.direction;
    function O(e, t, r, n) {
      if (t < 0) {
        t = 0;
      }
      t = Math.round(t);
      n = Math.round(n);
      i.appendChild(A("div", null, "CodeMirror-selected", "position: absolute; left: " + e + "px;\n                             top: " + t + "px; width: " + (null == r ? M - e : r) + "px;\n                             height: " + (n - t) + "px"));
    }
    function s(r, y, b) {
      var w;
      var x;
      var o = ae(n, r);
      var C = o.text.length;
      function L(e, t, r) {
        var n = qr(l, o, null, e);
        var i = "ltr" == t == ("after" == r) ? "left" : "right";
        return Kr(l, ve(r, "after" == r ? n.begin : n.end - (/\s/.test(o.text.charAt(n.end - 1)) ? 2 : 1)), "div", o, i)[i];
      }
      var k = Je(o, n.direction);
      (function (e, t, r, n) {
        if (!e) {
          return n(t, r, "ltr", 0);
        }
        var i = false;
        for (var o = 0; o < e.length; ++o) {
          var l = e[o];
          if (l.from < r && l.to > t || t == r && l.to == t) {
            n(Math.max(l.from, t), Math.min(l.to, r), 1 == l.level ? "rtl" : "ltr", o);
            i = true;
          }
        }
        if (!i) {
          n(t, r, "ltr");
        }
      })(k, y || 0, null == b ? C : b, function (e, t, r, n) {
        var i = "ltr" == r;
        var o = Kr(l, ve(r, e), "div", o, i ? "left" : "right");
        var l = Kr(l, ve(r, t - 1), "div", o, i ? "right" : "left");
        var s = null == y && 0 == e;
        var a = null == b && t == C;
        var u = 0 == n;
        var c = !k || n == k.length - 1;
        if (l.top - o.top <= 3) {
          var h = (N ? a : s) && c;
          var f = (N ? s : a) && u ? T : (i ? o : l).left;
          var d = h ? M : (i ? l : o).right;
          O(f, o.top, d - f, o.bottom);
        } else {
          var p;
          var g;
          var v;
          var m;
          m = i ? (p = N && s && u ? T : o.left, g = N ? M : L(e, r, "before"), v = N ? T : L(t, r, "after"), N && a && c ? M : l.right) : (p = N ? L(e, r, "before") : T, g = !N && s && u ? M : o.right, v = !N && a && c ? T : l.left, N ? L(t, r, "after") : M);
          O(p, o.top, g - p, o.bottom);
          if (o.bottom < l.top) {
            O(T, o.bottom, null, l.top);
          }
          O(v, l.top, m - v, l.bottom);
        }
        if (!w || (o.top - w.top || o.left - w.left) < 0) {
          w = o;
        }
        if ((l.top - w.top || l.left - w.left) < 0) {
          w = l;
        }
        if (!x || (o.top - x.top || o.left - x.left) < 0) {
          x = o;
        }
        if ((l.top - x.top || l.left - x.left) < 0) {
          x = l;
        }
      });
      return {
        start: w,
        end: x
      };
    }
    var a = e.from();
    var u = e.to();
    if (a.line == u.line) {
      s(a.line, a.ch, u.ch);
    } else {
      var c = ae(n, a.line);
      var h = ae(n, u.line);
      var f = Ue(c) == Ue(h);
      var d = s(a.line, a.ch, f ? c.text.length + 1 : null).end;
      var p = s(u.line, f ? 0 : null, u.ch).start;
      if (f) {
        if (d.top < p.top - 2) {
          O(d.right, d.top, null, d.bottom);
          O(T, p.top, p.left, p.bottom);
        } else {
          O(d.right, d.top, p.left - d.right, d.bottom);
        }
      }
      if (d.bottom < p.top) {
        O(T, d.bottom, null, p.top);
      }
    }
    t.appendChild(i);
  }
  function dn(e) {
    if (e.state.focused) {
      var t = e.display;
      clearInterval(t.blinker);
      var r = true;
      t.cursorDiv.style.visibility = "";
      if (0 < e.options.cursorBlinkRate) {
        t.blinker = setInterval(function () {
          return t.cursorDiv.style.visibility = (r = !r) ? "" : "hidden";
        }, e.options.cursorBlinkRate);
      } else if (e.options.cursorBlinkRate < 0) {
        t.cursorDiv.style.visibility = "hidden";
      }
    }
  }
  function pn(e) {
    if (!e.state.focused) {
      e.display.input.focus();
      vn(e);
    }
  }
  function gn(e) {
    e.state.delayingBlurEvent = true;
    setTimeout(function () {
      if (e.state.delayingBlurEvent) {
        e.state.delayingBlurEvent = false;
        mn(e);
      }
    }, 100);
  }
  function vn(e, t) {
    if (e.state.delayingBlurEvent) {
      e.state.delayingBlurEvent = false;
    }
    if ("nocursor" != e.options.readOnly) {
      if (!e.state.focused) {
        it(e, "focus", e, t);
        e.state.focused = true;
        H(e.display.wrapper, "CodeMirror-focused");
        if (!(e.curOp || e.display.selForContextMenu == e.doc.sel)) {
          e.display.input.reset();
          if (b) {
            setTimeout(function () {
              return e.display.input.reset(true);
            }, 20);
          }
        }
        e.display.input.receivedFocus();
      }
      dn(e);
    }
  }
  function mn(e, t) {
    if (!e.state.delayingBlurEvent) {
      if (e.state.focused) {
        it(e, "blur", e, t);
        e.state.focused = false;
        T(e.display.wrapper, "CodeMirror-focused");
      }
      clearInterval(e.display.blinker);
      setTimeout(function () {
        if (!e.state.focused) {
          e.display.shift = false;
        }
      }, 150);
    }
  }
  function yn(e) {
    var t = e.display;
    var r = t.lineDiv.offsetTop;
    for (var n = 0; n < t.view.length; n++) {
      var i = t.view[n];
      var o = e.options.lineWrapping;
      var l = undefined;
      var s = 0;
      if (!i.hidden) {
        if (x && C < 8) {
          var a = i.node.offsetTop + i.node.offsetHeight;
          l = a - r;
          r = a;
        } else {
          var u = i.node.getBoundingClientRect();
          l = u.bottom - u.top;
          if (!o && i.text.firstChild) {
            s = i.text.firstChild.getBoundingClientRect().right - u.left - 1;
          }
        }
        var c = i.line.height - l;
        if ((.005 < c || c < -.005) && (he(i.line, l), bn(i.line), i.rest)) {
          for (var h = 0; h < i.rest.length; h++) {
            bn(i.rest[h]);
          }
        }
        if (s > e.display.sizerWidth) {
          var f = Math.ceil(s / en(e.display));
          if (f > e.display.maxLineLength) {
            e.display.maxLineLength = f;
            e.display.maxLine = i.line;
            e.display.maxLineChanged = true;
          }
        }
      }
    }
  }
  function bn(e) {
    if (e.widgets) {
      for (var t = 0; t < e.widgets.length; ++t) {
        var r = e.widgets[t];
        var n = r.node.parentNode;
        if (n) {
          r.height = n.offsetHeight;
        }
      }
    }
  }
  function wn(e, t, r) {
    var n = r && null != r.top ? Math.max(0, r.top) : e.scroller.scrollTop;
    n = Math.floor(n - e.lineSpace.offsetTop);
    var i = r && null != r.bottom ? r.bottom : n + e.wrapper.clientHeight;
    var o = de(t, n);
    var l = de(t, i);
    if (r && r.ensure) {
      var s = r.ensure.from.line;
      var a = r.ensure.to.line;
      if (s < o) {
        l = de(t, Ye(ae(t, o = s)) + e.wrapper.clientHeight);
      } else if (Math.min(a, t.lastLine()) >= l) {
        o = de(t, Ye(ae(t, a)) - e.wrapper.clientHeight);
        l = a;
      }
    }
    return {
      from: o,
      to: Math.max(l, o + 1)
    };
  }
  function xn(e) {
    var t = e.display;
    var r = t.view;
    if (t.alignWidgets || t.gutters.firstChild && e.options.fixedGutter) {
      var n = t.scroller.getBoundingClientRect().left - t.sizer.getBoundingClientRect().left - t.scroller.scrollLeft + e.doc.scrollLeft;
      var i = t.gutters.offsetWidth;
      var o = n + "px";
      for (var l = 0; l < r.length; l++) {
        if (!r[l].hidden) {
          if (e.options.fixedGutter) {
            if (r[l].gutter) {
              r[l].gutter.style.left = o;
            }
            if (r[l].gutterBackground) {
              r[l].gutterBackground.style.left = o;
            }
          }
          var s = r[l].alignable;
          if (s) {
            for (var a = 0; a < s.length; a++) {
              s[a].style.left = o;
            }
          }
        }
      }
      if (e.options.fixedGutter) {
        t.gutters.style.left = n + i + "px";
      }
    }
  }
  function Cn(e) {
    if (!e.options.lineNumbers) {
      return false;
    }
    var t = e.doc;
    var r = String(e.options.lineNumberFormatter(t.first + t.size - 1 + e.options.firstLineNumber));
    var n = e.display;
    if (r.length == n.lineNumChars) {
      return false;
    }
    var i = n.measure.appendChild(A("div", [A("div", r)], "CodeMirror-linenumber CodeMirror-gutter-elt"));
    var o = i.firstChild.offsetWidth;
    var l = i.offsetWidth - o;
    n.lineGutter.style.width = "";
    n.lineNumInnerWidth = Math.max(o, n.lineGutter.offsetWidth - l) + 1;
    n.lineNumWidth = n.lineNumInnerWidth + l;
    n.lineNumChars = n.lineNumInnerWidth ? r.length : -1;
    n.lineGutter.style.width = n.lineNumWidth + "px";
    si(e);
    return true;
  }
  function Sn(e, t) {
    var r = e.display;
    var n = Jr(e.display);
    if (t.top < 0) {
      t.top = 0;
    }
    var i = e.curOp && null != e.curOp.scrollTop ? e.curOp.scrollTop : r.scroller.scrollTop;
    var o = e.display.scroller.clientHeight - (30 - e.display.nativeBarWidth) - e.display.barHeight;
    var l = {};
    if (t.bottom - t.top > o) {
      t.bottom = t.top + o;
    }
    var s = e.doc.height + (r.mover.offsetHeight - r.lineSpace.offsetHeight);
    var a = t.top < n;
    var u = t.bottom > s - n;
    if (t.top < i) {
      l.scrollTop = a ? 0 : t.top;
    } else if (t.bottom > i + o) {
      var c = Math.min(t.top, (u ? s : t.bottom) - o);
      if (c != i) {
        l.scrollTop = c;
      }
    }
    var h = e.curOp && null != e.curOp.scrollLeft ? e.curOp.scrollLeft : r.scroller.scrollLeft;
    var f = e.display.scroller.clientWidth - (30 - e.display.nativeBarWidth) - e.display.barWidth - (e.options.fixedGutter ? r.gutters.offsetWidth : 0);
    var d = t.right - t.left > f;
    if (d) {
      t.right = t.left + f;
    }
    if (t.left < 10) {
      l.scrollLeft = 0;
    } else if (t.left < h) {
      l.scrollLeft = Math.max(0, t.left - (d ? 0 : 10));
    } else if (t.right > f + h - 3) {
      l.scrollLeft = t.right + (d ? 0 : 10) - f;
    }
    return l;
  }
  function Ln(e, t) {
    if (null != t) {
      Mn(e);
      e.curOp.scrollTop = (null == e.curOp.scrollTop ? e.doc.scrollTop : e.curOp.scrollTop) + t;
    }
  }
  function kn(e) {
    Mn(e);
    var t = e.getCursor();
    e.curOp.scrollToPos = {
      from: t,
      to: t,
      margin: e.options.cursorScrollMargin
    };
  }
  function Tn(e, t, r) {
    if (!(null == t && null == r)) {
      Mn(e);
    }
    if (null != t) {
      e.curOp.scrollLeft = t;
    }
    if (null != r) {
      e.curOp.scrollTop = r;
    }
  }
  function Mn(e) {
    var t = e.curOp.scrollToPos;
    if (t) {
      e.curOp.scrollToPos = null;
      Nn(e, Xr(e, t.from), Xr(e, t.to), t.margin);
    }
  }
  function Nn(e, t, r, n) {
    var i = Sn(e, {
      left: Math.min(t.left, r.left),
      top: Math.min(t.top, r.top) - n,
      right: Math.max(t.right, r.right),
      bottom: Math.max(t.bottom, r.bottom) + n
    });
    Tn(e, i.scrollLeft, i.scrollTop);
  }
  function On(e, t) {
    if (!(Math.abs(e.doc.scrollTop - t) < 2)) {
      if (!g) {
        li(e, {
          top: t
        });
      }
      An(e, t, true);
      if (g) {
        li(e);
      }
      ti(e, 100);
    }
  }
  function An(e, t, r) {
    t = Math.min(e.display.scroller.scrollHeight - e.display.scroller.clientHeight, t);
    if (e.display.scroller.scrollTop != t || r) {
      e.doc.scrollTop = t;
      e.display.scrollbars.setScrollTop(t);
      if (e.display.scroller.scrollTop != t) {
        e.display.scroller.scrollTop = t;
      }
    }
  }
  function Dn(e, t, r, n) {
    t = Math.min(t, e.display.scroller.scrollWidth - e.display.scroller.clientWidth);
    if (!((r ? t == e.doc.scrollLeft : Math.abs(e.doc.scrollLeft - t) < 2) && !n)) {
      e.doc.scrollLeft = t;
      xn(e);
      if (e.display.scroller.scrollLeft != t) {
        e.display.scroller.scrollLeft = t;
      }
      e.display.scrollbars.setScrollLeft(t);
    }
  }
  function Wn(e) {
    var t = e.display;
    var r = t.gutters.offsetWidth;
    var n = Math.round(e.doc.height + (e.display.mover.offsetHeight - e.display.lineSpace.offsetHeight));
    return {
      clientHeight: t.scroller.clientHeight,
      viewHeight: t.wrapper.clientHeight,
      scrollWidth: t.scroller.scrollWidth,
      clientWidth: t.scroller.clientWidth,
      viewWidth: t.wrapper.clientWidth,
      barLeft: e.options.fixedGutter ? r : 0,
      docHeight: n,
      scrollHeight: n + (30 - e.display.nativeBarWidth) + t.barHeight,
      nativeBarWidth: t.nativeBarWidth,
      gutterWidth: r
    };
  }
  var Hn = function (e, t, r) {
    this.cm = r;
    var n = this.vert = A("div", [A("div", null, null, "min-width: 1px")], "CodeMirror-vscrollbar");
    var i = this.horiz = A("div", [A("div", null, null, "height: 100%; min-height: 1px")], "CodeMirror-hscrollbar");
    n.tabIndex = i.tabIndex = -1;
    e(n);
    e(i);
    tt(n, "scroll", function () {
      if (n.clientHeight) {
        t(n.scrollTop, "vertical");
      }
    });
    tt(i, "scroll", function () {
      if (i.clientWidth) {
        t(i.scrollLeft, "horizontal");
      }
    });
    this.checkedZeroWidth = false;
    if (x && C < 8) {
      this.horiz.style.minHeight = this.vert.style.minWidth = "18px";
    }
  };
  Hn.prototype.update = function (e) {
    var t = e.scrollWidth > e.clientWidth + 1;
    var r = e.scrollHeight > e.clientHeight + 1;
    var n = e.nativeBarWidth;
    if (r) {
      this.vert.style.display = "block";
      this.vert.style.bottom = t ? n + "px" : "0";
      var i = e.viewHeight - (t ? n : 0);
      this.vert.firstChild.style.height = Math.max(0, e.scrollHeight - e.clientHeight + i) + "px";
    } else {
      this.vert.style.display = "";
      this.vert.firstChild.style.height = "0";
    }
    if (t) {
      this.horiz.style.display = "block";
      this.horiz.style.right = r ? n + "px" : "0";
      this.horiz.style.left = e.barLeft + "px";
      var o = e.viewWidth - e.barLeft - (r ? n : 0);
      this.horiz.firstChild.style.width = Math.max(0, e.scrollWidth - e.clientWidth + o) + "px";
    } else {
      this.horiz.style.display = "";
      this.horiz.firstChild.style.width = "0";
    }
    if (!this.checkedZeroWidth && 0 < e.clientHeight) {
      if (0 == n) {
        this.zeroWidthHack();
      }
      this.checkedZeroWidth = true;
    }
    return {
      right: r ? n : 0,
      bottom: t ? n : 0
    };
  };
  Hn.prototype.setScrollLeft = function (e) {
    if (this.horiz.scrollLeft != e) {
      this.horiz.scrollLeft = e;
    }
    if (this.disableHoriz) {
      this.enableZeroWidthBar(this.horiz, this.disableHoriz, "horiz");
    }
  };
  Hn.prototype.setScrollTop = function (e) {
    if (this.vert.scrollTop != e) {
      this.vert.scrollTop = e;
    }
    if (this.disableVert) {
      this.enableZeroWidthBar(this.vert, this.disableVert, "vert");
    }
  };
  Hn.prototype.zeroWidthHack = function () {
    var e = w && !s ? "12px" : "18px";
    this.horiz.style.height = this.vert.style.width = e;
    this.horiz.style.pointerEvents = this.vert.style.pointerEvents = "none";
    this.disableHoriz = new R();
    this.disableVert = new R();
  };
  Hn.prototype.enableZeroWidthBar = function (r, n, i) {
    r.style.pointerEvents = "auto";
    n.set(1e3, function e() {
      var t = r.getBoundingClientRect();
      if (("vert" == i ? document.elementFromPoint(t.right - 1, (t.top + t.bottom) / 2) : document.elementFromPoint((t.right + t.left) / 2, t.bottom - 1)) != r) {
        r.style.pointerEvents = "none";
      } else {
        n.set(1e3, e);
      }
    });
  };
  Hn.prototype.clear = function () {
    var e = this.horiz.parentNode;
    e.removeChild(this.horiz);
    e.removeChild(this.vert);
  };
  var Fn = function () {};
  function Pn(e, t) {
    if (!t) {
      t = Wn(e);
    }
    var r = e.display.barWidth;
    var n = e.display.barHeight;
    En(e, t);
    for (var i = 0; i < 4 && r != e.display.barWidth || n != e.display.barHeight; i++) {
      if (r != e.display.barWidth && e.options.lineWrapping) {
        yn(e);
      }
      En(e, Wn(e));
      r = e.display.barWidth;
      n = e.display.barHeight;
    }
  }
  function En(e, t) {
    var r = e.display;
    var n = r.scrollbars.update(t);
    r.sizer.style.paddingRight = (r.barWidth = n.right) + "px";
    r.sizer.style.paddingBottom = (r.barHeight = n.bottom) + "px";
    r.heightForcer.style.borderBottom = n.bottom + "px solid transparent";
    if (n.right && n.bottom) {
      r.scrollbarFiller.style.display = "block";
      r.scrollbarFiller.style.height = n.bottom + "px";
      r.scrollbarFiller.style.width = n.right + "px";
    } else {
      r.scrollbarFiller.style.display = "";
    }
    if (n.bottom && e.options.coverGutterNextToScrollbar && e.options.fixedGutter) {
      r.gutterFiller.style.display = "block";
      r.gutterFiller.style.height = n.bottom + "px";
      r.gutterFiller.style.width = t.gutterWidth + "px";
    } else {
      r.gutterFiller.style.display = "";
    }
  }
  Fn.prototype.update = function () {
    return {
      bottom: 0,
      right: 0
    };
  };
  Fn.prototype.setScrollLeft = function () {};
  Fn.prototype.setScrollTop = function () {};
  Fn.prototype.clear = function () {};
  var In = {
    native: Hn,
    null: Fn
  };
  function zn(r) {
    if (r.display.scrollbars) {
      r.display.scrollbars.clear();
      if (r.display.scrollbars.addClass) {
        T(r.display.wrapper, r.display.scrollbars.addClass);
      }
    }
    r.display.scrollbars = new In[r.options.scrollbarStyle](function (e) {
      r.display.wrapper.insertBefore(e, r.display.scrollbarFiller);
      tt(e, "mousedown", function () {
        if (r.state.focused) {
          setTimeout(function () {
            return r.display.input.focus();
          }, 0);
        }
      });
      e.setAttribute("cm-not-content", "true");
    }, function (e, t) {
      if ("horizontal" == t) {
        Dn(r, e);
      } else {
        On(r, e);
      }
    }, r);
    if (r.display.scrollbars.addClass) {
      H(r.display.wrapper, r.display.scrollbars.addClass);
    }
  }
  var Rn = 0;
  function Bn(e) {
    var t;
    e.curOp = {
      cm: e,
      viewChanged: false,
      startHeight: e.doc.height,
      forceUpdate: false,
      updateInput: 0,
      typing: false,
      changeObjs: null,
      cursorActivityHandlers: null,
      cursorActivityCalled: 0,
      selectionChanged: false,
      updateMaxLine: false,
      scrollLeft: null,
      scrollTop: null,
      scrollToPos: null,
      focus: false,
      id: ++Rn
    };
    t = e.curOp;
    if (or) {
      or.ops.push(t);
    } else {
      t.ownsGroup = or = {
        ops: [t],
        delayedCallbacks: []
      };
    }
  }
  function Gn(e) {
    var t = e.curOp;
    if (t) {
      (function (e, t) {
        var r = e.ownsGroup;
        if (r) {
          try {
            !function (e) {
              var t = e.delayedCallbacks;
              var r = 0;
              do {
                for (; r < t.length; r++) {
                  t[r].call(null);
                }
                for (var n = 0; n < e.ops.length; n++) {
                  var i = e.ops[n];
                  if (i.cursorActivityHandlers) {
                    for (; i.cursorActivityCalled < i.cursorActivityHandlers.length;) {
                      i.cursorActivityHandlers[i.cursorActivityCalled++].call(null, i.cm);
                    }
                  }
                }
              } while (r < t.length);
            }(r);
          } finally {
            or = null;
            t(r);
          }
        }
      })(t, function (e) {
        for (var t = 0; t < e.ops.length; t++) {
          e.ops[t].cm.curOp = null;
        }
        !function (e) {
          var t = e.ops;
          for (var r = 0; r < t.length; r++) {
            Un(t[r]);
          }
          for (var n = 0; n < t.length; n++) {
            (i = t[n]).updatedDisplay = i.mustUpdate && ii(i.cm, i.update);
          }
          var i;
          for (var o = 0; o < t.length; o++) {
            Vn(t[o]);
          }
          for (var l = 0; l < t.length; l++) {
            Kn(t[l]);
          }
          for (var s = 0; s < t.length; s++) {
            jn(t[s]);
          }
        }(e);
      });
    }
  }
  function Un(e) {
    var t;
    var r;
    var n = e.cm;
    var i = n.display;
    if (!(r = (t = n).display).scrollbarsClipped && r.scroller.offsetWidth) {
      r.nativeBarWidth = r.scroller.offsetWidth - r.scroller.clientWidth;
      r.heightForcer.style.height = 30 - t.display.nativeBarWidth + "px";
      r.sizer.style.marginBottom = -r.nativeBarWidth + "px";
      r.sizer.style.borderRightWidth = 30 - t.display.nativeBarWidth + "px";
      r.scrollbarsClipped = true;
    }
    if (e.updateMaxLine) {
      $e(n);
    }
    e.mustUpdate = e.viewChanged || e.forceUpdate || null != e.scrollTop || e.scrollToPos && (e.scrollToPos.from.line < i.viewFrom || e.scrollToPos.to.line >= i.viewTo) || i.maxLineChanged && n.options.lineWrapping;
    e.update = e.mustUpdate && new ni(n, e.mustUpdate && {
      top: e.scrollTop,
      ensure: e.scrollToPos
    }, e.forceUpdate);
  }
  function Vn(e) {
    var t = e.cm;
    var r = t.display;
    if (e.updatedDisplay) {
      yn(t);
    }
    e.barMeasure = Wn(t);
    if (r.maxLineChanged && !t.options.lineWrapping) {
      e.adjustWidthTo = Dr(t, Ar(t, r.maxLine), r.maxLine.text.length, undefined).left + 3;
      t.display.sizerWidth = e.adjustWidthTo;
      e.barMeasure.scrollWidth = Math.max(r.scroller.clientWidth, r.sizer.offsetLeft + e.adjustWidthTo + (30 - t.display.nativeBarWidth) + t.display.barWidth);
      e.maxScrollLeft = Math.max(0, r.sizer.offsetLeft + e.adjustWidthTo - (t.display.scroller.clientWidth - (30 - t.display.nativeBarWidth) - t.display.barWidth));
    }
    if (e.updatedDisplay || e.selectionChanged) {
      e.preparedSelection = r.input.prepareSelection();
    }
  }
  function Kn(e) {
    var t = e.cm;
    if (null != e.adjustWidthTo) {
      t.display.sizer.style.minWidth = e.adjustWidthTo + "px";
      if (e.maxScrollLeft < t.doc.scrollLeft) {
        Dn(t, Math.min(t.display.scroller.scrollLeft, e.maxScrollLeft), true);
      }
      t.display.maxLineChanged = false;
    }
    var r = e.focus && e.focus == W();
    if (e.preparedSelection) {
      t.display.input.showSelection(e.preparedSelection, r);
    }
    if (e.updatedDisplay || e.startHeight != t.doc.height) {
      Pn(t, e.barMeasure);
    }
    if (e.updatedDisplay) {
      ai(t, e.barMeasure);
    }
    if (e.selectionChanged) {
      dn(t);
    }
    if (t.state.focused && e.updateInput) {
      t.display.input.reset(e.typing);
    }
    if (r) {
      pn(e.cm);
    }
  }
  function jn(e) {
    var t = e.cm;
    var r = t.display;
    var n = t.doc;
    if (e.updatedDisplay) {
      oi(t, e.update);
    }
    if (!(null == r.wheelStartX || null == e.scrollTop && null == e.scrollLeft && !e.scrollToPos)) {
      r.wheelStartX = r.wheelStartY = null;
    }
    if (null != e.scrollTop) {
      An(t, e.scrollTop, e.forceScroll);
    }
    if (null != e.scrollLeft) {
      Dn(t, e.scrollLeft, true, true);
    }
    if (e.scrollToPos) {
      (function (e, t) {
        if (!ot(e, "scrollCursorIntoView")) {
          var r = e.display;
          var n = r.sizer.getBoundingClientRect();
          var i = null;
          if (t.top + n.top < 0) {
            i = true;
          } else if (t.bottom + n.top > (window.innerHeight || document.documentElement.clientHeight)) {
            i = false;
          }
          if (null != i && !u) {
            var o = A("div", "​", null, "position: absolute;\n                         top: " + (t.top - r.viewOffset - e.display.lineSpace.offsetTop) + "px;\n                         height: " + (t.bottom - t.top + (30 - e.display.nativeBarWidth) + r.barHeight) + "px;\n                         left: " + t.left + "px; width: " + Math.max(2, t.right - t.left) + "px;");
            e.display.lineSpace.appendChild(o);
            o.scrollIntoView(i);
            e.display.lineSpace.removeChild(o);
          }
        }
      })(t, function (e, t, r, n) {
        var i;
        if (null == n) {
          n = 0;
        }
        if (!(e.options.lineWrapping || t != r)) {
          r = "before" == (t = t.ch ? ve(t.line, "before" == t.sticky ? t.ch - 1 : t.ch, "after") : t).sticky ? ve(t.line, t.ch + 1, "before") : t;
        }
        for (var o = 0; o < 5; o++) {
          var l = false;
          var s = jr(e, t);
          var a = r && r != t ? jr(e, r) : s;
          var u = Sn(e, i = {
            left: Math.min(s.left, a.left),
            top: Math.min(s.top, a.top) - n,
            right: Math.max(s.left, a.left),
            bottom: Math.max(s.bottom, a.bottom) + n
          });
          var c = e.doc.scrollTop;
          var h = e.doc.scrollLeft;
          if (null != u.scrollTop) {
            On(e, u.scrollTop);
            if (1 < Math.abs(e.doc.scrollTop - c)) {
              l = true;
            }
          }
          if (null != u.scrollLeft) {
            Dn(e, u.scrollLeft);
            if (1 < Math.abs(e.doc.scrollLeft - h)) {
              l = true;
            }
          }
          if (!l) {
            break;
          }
        }
        return i;
      }(t, Se(n, e.scrollToPos.from), Se(n, e.scrollToPos.to), e.scrollToPos.margin));
    }
    var i = e.maybeHiddenMarkers;
    var o = e.maybeUnhiddenMarkers;
    if (i) {
      for (var l = 0; l < i.length; ++l) {
        if (!i[l].lines.length) {
          it(i[l], "hide");
        }
      }
    }
    if (o) {
      for (var s = 0; s < o.length; ++s) {
        if (o[s].lines.length) {
          it(o[s], "unhide");
        }
      }
    }
    if (r.wrapper.offsetHeight) {
      n.scrollTop = t.display.scroller.scrollTop;
    }
    if (e.changeObjs) {
      it(t, "changes", t, e.changeObjs);
    }
    if (e.update) {
      e.update.finish();
    }
  }
  function Xn(e, t) {
    if (e.curOp) {
      return t();
    }
    Bn(e);
    try {
      return t();
    } finally {
      Gn(e);
    }
  }
  function Yn(e, t) {
    return function () {
      if (e.curOp) {
        return t.apply(e, arguments);
      }
      Bn(e);
      try {
        return t.apply(e, arguments);
      } finally {
        Gn(e);
      }
    };
  }
  function _n(e) {
    return function () {
      if (this.curOp) {
        return e.apply(this, arguments);
      }
      Bn(this);
      try {
        return e.apply(this, arguments);
      } finally {
        Gn(this);
      }
    };
  }
  function $n(t) {
    return function () {
      var e = this.cm;
      if (!e || e.curOp) {
        return t.apply(this, arguments);
      }
      Bn(e);
      try {
        return t.apply(this, arguments);
      } finally {
        Gn(e);
      }
    };
  }
  function qn(e, t, r, n) {
    if (null == t) {
      t = e.doc.first;
    }
    if (null == r) {
      r = e.doc.first + e.doc.size;
    }
    if (!n) {
      n = 0;
    }
    var i = e.display;
    if (n && r < i.viewTo && (null == i.updateLineNumbers || i.updateLineNumbers > t)) {
      i.updateLineNumbers = t;
    }
    e.curOp.viewChanged = true;
    if (t >= i.viewTo) {
      if (Te && Ve(e.doc, t) < i.viewTo) {
        Qn(e);
      }
    } else if (r <= i.viewFrom) {
      if (Te && Ke(e.doc, r + n) > i.viewFrom) {
        Qn(e);
      } else {
        i.viewFrom += n;
        i.viewTo += n;
      }
    } else if (t <= i.viewFrom && r >= i.viewTo) {
      Qn(e);
    } else if (t <= i.viewFrom) {
      var o = Jn(e, r, r + n, 1);
      if (o) {
        i.view = i.view.slice(o.index);
        i.viewFrom = o.lineN;
        i.viewTo += n;
      } else {
        Qn(e);
      }
    } else if (r >= i.viewTo) {
      var l = Jn(e, t, t, -1);
      if (l) {
        i.view = i.view.slice(0, l.index);
        i.viewTo = l.lineN;
      } else {
        Qn(e);
      }
    } else {
      var s = Jn(e, t, t, -1);
      var a = Jn(e, r, r + n, 1);
      if (s && a) {
        i.view = i.view.slice(0, s.index).concat(ir(e, s.lineN, a.lineN)).concat(i.view.slice(a.index));
        i.viewTo += n;
      } else {
        Qn(e);
      }
    }
    var u = i.externalMeasured;
    if (u) {
      if (r < u.lineN) {
        u.lineN += n;
      } else if (t < u.lineN + u.size) {
        i.externalMeasured = null;
      }
    }
  }
  function Zn(e, t, r) {
    e.curOp.viewChanged = true;
    var n = e.display;
    var i = e.display.externalMeasured;
    if (i && t >= i.lineN && t < i.lineN + i.size) {
      n.externalMeasured = null;
    }
    if (!(t < n.viewFrom || t >= n.viewTo)) {
      var o = n.view[sn(e, t)];
      if (null != o.node) {
        var l = o.changes || (o.changes = []);
        if (-1 == B(l, r)) {
          l.push(r);
        }
      }
    }
  }
  function Qn(e) {
    e.display.viewFrom = e.display.viewTo = e.doc.first;
    e.display.view = [];
    e.display.viewOffset = 0;
  }
  function Jn(e, t, r, n) {
    var i;
    var o = sn(e, t);
    var l = e.display.view;
    if (!Te || r == e.doc.first + e.doc.size) {
      return {
        index: o,
        lineN: r
      };
    }
    var s = e.display.viewFrom;
    for (var a = 0; a < o; a++) {
      s += l[a].size;
    }
    if (s != t) {
      if (0 < n) {
        if (o == l.length - 1) {
          return null;
        }
        i = s + l[o].size - t;
        o++;
      } else {
        i = s - t;
      }
      t += i;
      r += i;
    }
    for (; Ve(e.doc, r) != r;) {
      if (o == (n < 0 ? 0 : l.length - 1)) {
        return null;
      }
      r += n * l[o - (n < 0 ? 1 : 0)].size;
      o += n;
    }
    return {
      index: o,
      lineN: r
    };
  }
  function ei(e) {
    var t = e.display.view;
    var r = 0;
    for (var n = 0; n < t.length; n++) {
      var i = t[n];
      if (!(i.hidden || i.node && !i.changes)) {
        ++r;
      }
    }
    return r;
  }
  function ti(e, t) {
    if (e.doc.highlightFrontier < e.display.viewTo) {
      e.state.highlight.set(t, E(ri, e));
    }
  }
  function ri(a) {
    var u = a.doc;
    if (!(u.highlightFrontier >= a.display.viewTo)) {
      var c = +new Date() + a.options.workTime;
      var h = Rt(a, u.highlightFrontier);
      var f = [];
      u.iter(h.line, Math.min(u.first + u.size, a.display.viewTo + 500), function (e) {
        if (h.line >= a.display.viewFrom) {
          var t = e.styles;
          var r = e.text.length > a.options.maxHighlightLength ? Dt(u.mode, h.state) : null;
          var n = It(a, e, h, true);
          if (r) {
            h.state = r;
          }
          e.styles = n.styles;
          var i = e.styleClasses;
          var o = n.classes;
          if (o) {
            e.styleClasses = o;
          } else if (i) {
            e.styleClasses = null;
          }
          var l = !t || t.length != e.styles.length || i != o && (!i || !o || i.bgClass != o.bgClass || i.textClass != o.textClass);
          for (var s = 0; !l && s < t.length; ++s) {
            l = t[s] != e.styles[s];
          }
          if (l) {
            f.push(h.line);
          }
          e.stateAfter = h.save();
          h.nextLine();
        } else {
          if (e.text.length <= a.options.maxHighlightLength) {
            Bt(a, e.text, h);
          }
          e.stateAfter = h.line % 5 == 0 ? h.save() : null;
          h.nextLine();
        }
        if (+new Date() > c) {
          ti(a, a.options.workDelay);
          return true;
        }
      });
      u.highlightFrontier = h.line;
      u.modeFrontier = Math.max(u.modeFrontier, h.line);
      if (f.length) {
        Xn(a, function () {
          for (var e = 0; e < f.length; e++) {
            Zn(a, f[e], "text");
          }
        });
      }
    }
  }
  var ni = function (e, t, r) {
    var n = e.display;
    this.viewport = t;
    this.visible = wn(n, e.doc, t);
    this.editorIsHidden = !n.wrapper.offsetWidth;
    this.wrapperHeight = n.wrapper.clientHeight;
    this.wrapperWidth = n.wrapper.clientWidth;
    this.oldDisplayWidth = e.display.scroller.clientWidth - (30 - e.display.nativeBarWidth) - e.display.barWidth;
    this.force = r;
    this.dims = tn(e);
    this.events = [];
  };
  function ii(e, t) {
    var r = e.display;
    var n = e.doc;
    if (t.editorIsHidden) {
      Qn(e);
      return false;
    }
    if (!t.force && t.visible.from >= r.viewFrom && t.visible.to <= r.viewTo && (null == r.updateLineNumbers || r.updateLineNumbers >= r.viewTo) && r.renderedView == r.view && 0 == ei(e)) {
      return false;
    }
    if (Cn(e)) {
      Qn(e);
      t.dims = tn(e);
    }
    var i = n.first + n.size;
    var o = Math.max(t.visible.from - e.options.viewportMargin, n.first);
    var l = Math.min(i, t.visible.to + e.options.viewportMargin);
    if (r.viewFrom < o && o - r.viewFrom < 20) {
      o = Math.max(n.first, r.viewFrom);
    }
    if (r.viewTo > l && r.viewTo - l < 20) {
      l = Math.min(i, r.viewTo);
    }
    if (Te) {
      o = Ve(e.doc, o);
      l = Ke(e.doc, l);
    }
    var s;
    var a;
    var u;
    var c;
    var h = o != r.viewFrom || l != r.viewTo || r.lastWrapHeight != t.wrapperHeight || r.lastWrapWidth != t.wrapperWidth;
    a = o;
    u = l;
    if (0 == (c = (s = e).display).view.length || a >= c.viewTo || u <= c.viewFrom) {
      c.view = ir(s, a, u);
      c.viewFrom = a;
    } else {
      if (c.viewFrom > a) {
        c.view = ir(s, a, c.viewFrom).concat(c.view);
      } else if (c.viewFrom < a) {
        c.view = c.view.slice(sn(s, a));
      }
      c.viewFrom = a;
      if (c.viewTo < u) {
        c.view = c.view.concat(ir(s, c.viewTo, u));
      } else if (c.viewTo > u) {
        c.view = c.view.slice(0, sn(s, u));
      }
    }
    c.viewTo = u;
    r.viewOffset = Ye(ae(e.doc, r.viewFrom));
    e.display.mover.style.top = r.viewOffset + "px";
    var f = ei(e);
    if (!h && 0 == f && !t.force && r.renderedView == r.view && (null == r.updateLineNumbers || r.updateLineNumbers >= r.viewTo)) {
      return false;
    }
    var d = function (e) {
      if (e.hasFocus()) {
        return null;
      }
      var t = W();
      if (!t || !D(e.display.lineDiv, t)) {
        return null;
      }
      var r = {
        activeElt: t
      };
      if (window.getSelection) {
        var n = window.getSelection();
        if (n.anchorNode && n.extend && D(e.display.lineDiv, n.anchorNode)) {
          r.anchorNode = n.anchorNode;
          r.anchorOffset = n.anchorOffset;
          r.focusNode = n.focusNode;
          r.focusOffset = n.focusOffset;
        }
      }
      return r;
    }(e);
    if (4 < f) {
      r.lineDiv.style.display = "none";
    }
    (function (r, e, t) {
      var n = r.display;
      var i = r.options.lineNumbers;
      var o = n.lineDiv;
      var l = o.firstChild;
      function s(e) {
        var t = e.nextSibling;
        if (b && w && r.display.currentWheelTarget == e) {
          e.style.display = "none";
        } else {
          e.parentNode.removeChild(e);
        }
        return t;
      }
      var a = n.view;
      var u = n.viewFrom;
      for (var c = 0; c < a.length; c++) {
        var h = a[c];
        if (h.hidden) {
          ;
        } else if (h.node && h.node.parentNode == o) {
          for (; l != h.node;) {
            l = s(l);
          }
          var f = i && null != e && e <= u && h.lineNumber;
          if (h.changes) {
            if (-1 < B(h.changes, "gutter")) {
              f = false;
            }
            ur(r, h, u, t);
          }
          if (f) {
            M(h.lineNumber);
            h.lineNumber.appendChild(document.createTextNode(String(r.options.lineNumberFormatter(u + r.options.firstLineNumber))));
          }
          l = h.node.nextSibling;
        } else {
          v = u;
          m = t;
          undefined;
          y = hr(p = r, g = h);
          g.text = g.node = y.pre;
          if (y.bgClass) {
            g.bgClass = y.bgClass;
          }
          if (y.textClass) {
            g.textClass = y.textClass;
          }
          dr(p, g);
          pr(p, g, v, m);
          vr(p, g, m);
          var d = g.node;
          o.insertBefore(d, l);
        }
        u += h.size;
      }
      var p;
      var g;
      var v;
      var m;
      var y;
      for (; l;) {
        l = s(l);
      }
    })(e, r.updateLineNumbers, t.dims);
    if (4 < f) {
      r.lineDiv.style.display = "";
    }
    r.renderedView = r.view;
    (function (e) {
      if (e && e.activeElt && e.activeElt != W() && (e.activeElt.focus(), e.anchorNode && D(document.body, e.anchorNode) && D(document.body, e.focusNode))) {
        var t = window.getSelection();
        var r = document.createRange();
        r.setEnd(e.anchorNode, e.anchorOffset);
        r.collapse(false);
        t.removeAllRanges();
        t.addRange(r);
        t.extend(e.focusNode, e.focusOffset);
      }
    })(d);
    M(r.cursorDiv);
    M(r.selectionDiv);
    r.gutters.style.height = r.sizer.style.minHeight = 0;
    if (h) {
      r.lastWrapHeight = t.wrapperHeight;
      r.lastWrapWidth = t.wrapperWidth;
      ti(e, 400);
    }
    return !(r.updateLineNumbers = null);
  }
  function oi(e, t) {
    var r = t.viewport;
    for (var n = true; (n && e.options.lineWrapping && t.oldDisplayWidth != e.display.scroller.clientWidth - (30 - e.display.nativeBarWidth) - e.display.barWidth || (r && null != r.top && (r = {
      top: Math.min(e.doc.height + (e.display.mover.offsetHeight - e.display.lineSpace.offsetHeight) - (e.display.scroller.clientHeight - (30 - e.display.nativeBarWidth) - e.display.barHeight), r.top)
    }), t.visible = wn(e.display, e.doc, r), !(t.visible.from >= e.display.viewFrom && t.visible.to <= e.display.viewTo))) && ii(e, t); n = false) {
      yn(e);
      var i = Wn(e);
      an(e);
      Pn(e, i);
      ai(e, i);
      t.force = false;
    }
    t.signal(e, "update", e);
    if (!(e.display.viewFrom == e.display.reportedViewFrom && e.display.viewTo == e.display.reportedViewTo)) {
      t.signal(e, "viewportChange", e, e.display.viewFrom, e.display.viewTo);
      e.display.reportedViewFrom = e.display.viewFrom;
      e.display.reportedViewTo = e.display.viewTo;
    }
  }
  function li(e, t) {
    var r = new ni(e, t);
    if (ii(e, r)) {
      yn(e);
      oi(e, r);
      var n = Wn(e);
      an(e);
      Pn(e, n);
      ai(e, n);
      r.finish();
    }
  }
  function si(e) {
    var t = e.display.gutters.offsetWidth;
    e.display.sizer.style.marginLeft = t + "px";
  }
  function ai(e, t) {
    e.display.sizer.style.minHeight = t.docHeight + "px";
    e.display.heightForcer.style.top = t.docHeight + "px";
    e.display.gutters.style.height = t.docHeight + e.display.barHeight + (30 - e.display.nativeBarWidth) + "px";
  }
  function ui(e) {
    var t = e.display.gutters;
    var r = e.options.gutters;
    M(t);
    for (var n = 0; n < r.length; ++n) {
      var i = r[n];
      var o = t.appendChild(A("div", null, "CodeMirror-gutter " + i));
      if ("CodeMirror-linenumbers" == i) {
        (e.display.lineGutter = o).style.width = (e.display.lineNumWidth || 1) + "px";
      }
    }
    t.style.display = n ? "" : "none";
    si(e);
  }
  function ci(e) {
    var t = B(e.gutters, "CodeMirror-linenumbers");
    if (-1 == t && e.lineNumbers) {
      e.gutters = e.gutters.concat(["CodeMirror-linenumbers"]);
    } else if (-1 < t && !e.lineNumbers) {
      e.gutters = e.gutters.slice(0);
      e.gutters.splice(t, 1);
    }
  }
  ni.prototype.signal = function (e, t) {
    if (0 < (e._handlers && e._handlers[t] || et).length) {
      this.events.push(arguments);
    }
  };
  ni.prototype.finish = function () {
    for (var e = 0; e < this.events.length; e++) {
      it.apply(null, this.events[e]);
    }
  };
  var hi = 0;
  var fi = null;
  function di(e) {
    var t = e.wheelDeltaX;
    var r = e.wheelDeltaY;
    if (null == t && e.detail && e.axis == e.HORIZONTAL_AXIS) {
      t = e.detail;
    }
    if (null == r && e.detail && e.axis == e.VERTICAL_AXIS) {
      r = e.detail;
    } else if (null == r) {
      r = e.wheelDelta;
    }
    return {
      x: t,
      y: r
    };
  }
  function pi(e) {
    var t = di(e);
    t.x *= fi;
    t.y *= fi;
    return t;
  }
  function gi(e, t) {
    var r = di(t);
    var n = r.x;
    var i = r.y;
    var o = e.display;
    var l = o.scroller;
    var s = l.scrollWidth > l.clientWidth;
    var a = l.scrollHeight > l.clientHeight;
    if (n && s || i && a) {
      if (i && w && b) {
        var u = t.target;
        e: for (var c = o.view; u != l; u = u.parentNode) {
          for (var h = 0; h < c.length; h++) {
            if (c[h].node == u) {
              e.display.currentWheelTarget = u;
              break e;
            }
          }
        }
      }
      if (n && !g && !v && null != fi) {
        if (i && a) {
          On(e, Math.max(0, l.scrollTop + i * fi));
        }
        Dn(e, Math.max(0, l.scrollLeft + n * fi));
        if (!i || i && a) {
          ut(t);
        }
        return void (o.wheelStartX = null);
      }
      if (i && null != fi) {
        var f = i * fi;
        var d = e.doc.scrollTop;
        var p = d + o.wrapper.clientHeight;
        if (f < 0) {
          d = Math.max(0, d + f - 50);
        } else {
          p = Math.min(e.doc.height, p + f + 50);
        }
        li(e, {
          top: d,
          bottom: p
        });
      }
      if (hi < 20) {
        if (null == o.wheelStartX) {
          o.wheelStartX = l.scrollLeft;
          o.wheelStartY = l.scrollTop;
          o.wheelDX = n;
          o.wheelDY = i;
          setTimeout(function () {
            if (null != o.wheelStartX) {
              var e = l.scrollLeft - o.wheelStartX;
              var t = l.scrollTop - o.wheelStartY;
              var r = t && o.wheelDY && t / o.wheelDY || e && o.wheelDX && e / o.wheelDX;
              o.wheelStartX = o.wheelStartY = null;
              if (r) {
                fi = (fi * hi + r) / (hi + 1);
                ++hi;
              }
            }
          }, 200);
        } else {
          o.wheelDX += n;
          o.wheelDY += i;
        }
      }
    }
  }
  if (x) {
    fi = -.53;
  } else if (g) {
    fi = 15;
  } else if (l) {
    fi = -.7;
  } else if (a) {
    fi = -0.3333333333333333;
  }
  var vi = function (e, t) {
    this.ranges = e;
    this.primIndex = t;
  };
  vi.prototype.primary = function () {
    return this.ranges[this.primIndex];
  };
  vi.prototype.equals = function (e) {
    if (e == this) {
      return true;
    }
    if (e.primIndex != this.primIndex || e.ranges.length != this.ranges.length) {
      return false;
    }
    for (var t = 0; t < this.ranges.length; t++) {
      var r = this.ranges[t];
      var n = e.ranges[t];
      if (!(r.anchor.sticky == n.anchor.sticky && 0 == (r.anchor.line - n.anchor.line || r.anchor.ch - n.anchor.ch)) || !(r.head.sticky == n.head.sticky && 0 == (r.head.line - n.head.line || r.head.ch - n.head.ch))) {
        return false;
      }
    }
    return true;
  };
  vi.prototype.deepCopy = function () {
    var e = [];
    for (var t = 0; t < this.ranges.length; t++) {
      e[t] = new mi(ve(this.ranges[t].anchor.line, this.ranges[t].anchor.ch), ve(this.ranges[t].head.line, this.ranges[t].head.ch));
    }
    return new vi(e, this.primIndex);
  };
  vi.prototype.somethingSelected = function () {
    for (var e = 0; e < this.ranges.length; e++) {
      if (!this.ranges[e].empty()) {
        return true;
      }
    }
    return false;
  };
  vi.prototype.contains = function (e, t) {
    if (!t) {
      t = e;
    }
    for (var r = 0; r < this.ranges.length; r++) {
      var n = this.ranges[r];
      if (0 <= (t.line - n.from().line || t.ch - n.from().ch) && (e.line - n.to().line || e.ch - n.to().ch) <= 0) {
        return r;
      }
    }
    return -1;
  };
  var mi = function (e, t) {
    this.anchor = e;
    this.head = t;
  };
  function yi(e, t, r) {
    var n = e && e.options.selectionsMayTouch;
    var i = t[r];
    t.sort(function (e, t) {
      return e.from().line - t.from().line || e.from().ch - t.from().ch;
    });
    r = B(t, i);
    for (var o = 1; o < t.length; o++) {
      var l = t[o];
      var s = t[o - 1];
      var a = s.to().line - l.from().line || s.to().ch - l.from().ch;
      if (n && !l.empty() ? 0 < a : 0 <= a) {
        var u = (s.from().line - l.from().line || s.from().ch - l.from().ch) < 0 ? s.from() : l.from();
        var c = (s.to().line - l.to().line || s.to().ch - l.to().ch) < 0 ? l.to() : s.to();
        var h = s.empty() ? l.from() == l.head : s.from() == s.head;
        if (o <= r) {
          --r;
        }
        t.splice(--o, 2, new mi(h ? c : u, h ? u : c));
      }
    }
    return new vi(t, r);
  }
  function wi(e) {
    return e.text ? ve(e.from.line + e.text.length - 1, e.text[e.text.length - 1].length + (1 == e.text.length ? e.from.ch : 0)) : e.to;
  }
  function xi(e, t) {
    if ((e.line - t.from.line || e.ch - t.from.ch) < 0) {
      return e;
    }
    if ((e.line - t.to.line || e.ch - t.to.ch) <= 0) {
      return t.text ? ve(t.from.line + t.text.length - 1, t.text[t.text.length - 1].length + (1 == t.text.length ? t.from.ch : 0)) : t.to;
    }
    var r = e.line + t.text.length - (t.to.line - t.from.line) - 1;
    var n = e.ch;
    if (e.line == t.to.line) {
      n += (t.text ? ve(t.from.line + t.text.length - 1, t.text[t.text.length - 1].length + (1 == t.text.length ? t.from.ch : 0)) : t.to).ch - t.to.ch;
    }
    return ve(r, n);
  }
  function Ci(e, t) {
    var r = [];
    for (var n = 0; n < e.sel.ranges.length; n++) {
      var i = e.sel.ranges[n];
      r.push(new mi(xi(i.anchor, t), xi(i.head, t)));
    }
    return yi(e.cm, r, e.sel.primIndex);
  }
  function Li(e) {
    e.doc.mode = Nt(e.options, e.doc.modeOption);
    ki(e);
  }
  function ki(e) {
    e.doc.iter(function (e) {
      if (e.stateAfter) {
        e.stateAfter = null;
      }
      if (e.styles) {
        e.styles = null;
      }
    });
    e.doc.modeFrontier = e.doc.highlightFrontier = e.doc.first;
    ti(e, 100);
    e.state.modeGen++;
    if (e.curOp) {
      qn(e);
    }
  }
  function Mi(e, n, t, i) {
    function r(e, t, r) {
      !function (e, t, r, n) {
        e.text = t;
        if (e.stateAfter) {
          e.stateAfter = null;
        }
        if (e.styles) {
          e.styles = null;
        }
        if (null != e.order) {
          e.order = null;
        }
        We(e);
        He(e, r);
        var i = n ? n(e) : 1;
        if (i != e.height) {
          he(e, i);
        }
      }(e, t, r, i);
      sr(e, "change", e, n);
    }
    function l(e, t) {
      var r = [];
      for (var n = e; n < t; ++n) {
        r.push(new Yt(u[n], t ? t[e] : null, i));
      }
      return r;
    }
    var s = n.from;
    var a = n.to;
    var u = n.text;
    var c = ae(e, s.line);
    var h = ae(e, a.line);
    var f = u[u.length - 1];
    var d = t ? t[e] : null;
    var p = a.line - s.line;
    if (n.full) {
      e.insert(0, l(0, u.length));
      e.remove(u.length, e.size - u.length);
    } else if (0 == n.from.ch && 0 == n.to.ch && "" == n.text[n.text.length - 1] && (!e.cm || e.cm.options.wholeLineUpdateBefore)) {
      var g = l(0, u.length - 1);
      r(h, h.text, d);
      if (p) {
        e.remove(s.line, p);
      }
      if (g.length) {
        e.insert(s.line, g);
      }
    } else if (c == h) {
      if (1 == u.length) {
        r(c, c.text.slice(0, s.ch) + f + c.text.slice(a.ch), d);
      } else {
        var v = l(1, u.length - 1);
        v.push(new Yt(f + c.text.slice(a.ch), d, i));
        r(c, c.text.slice(0, s.ch) + u[0], t ? t[e] : null);
        e.insert(s.line + 1, v);
      }
    } else if (1 == u.length) {
      r(c, c.text.slice(0, s.ch) + u[0] + h.text.slice(a.ch), t ? t[e] : null);
      e.remove(s.line + 1, p);
    } else {
      r(c, c.text.slice(0, s.ch) + u[0], t ? t[e] : null);
      r(h, f + h.text.slice(a.ch), d);
      var m = l(1, u.length - 1);
      if (1 < p) {
        e.remove(s.line + 1, p - 1);
      }
      e.insert(s.line + 1, m);
    }
    sr(e, "change", e, n);
  }
  function Ni(e, s, a) {
    !function e(t, r, n) {
      if (t.linked) {
        for (var i = 0; i < t.linked.length; ++i) {
          var o = t.linked[i];
          if (o.doc != r) {
            var l = n && o.sharedHist;
            if (!(a && !l)) {
              s(o.doc, l);
              e(o.doc, t, l);
            }
          }
        }
      }
    }(e, null, true);
  }
  function Oi(e, t) {
    if (t.cm) {
      throw new Error("This document is already in use.");
    }
    on((e.doc = t).cm = e);
    Li(e);
    Ai(e);
    if (!e.options.lineWrapping) {
      $e(e);
    }
    e.options.mode = t.modeOption;
    qn(e);
  }
  function Ai(e) {
    ("rtl" == e.doc.direction ? H : T)(e.display.lineDiv, "CodeMirror-rtl");
  }
  function Di(e) {
    this.done = [];
    this.undone = [];
    this.undoDepth = Infinity;
    this.lastModTime = this.lastSelTime = 0;
    this.lastOp = this.lastSelOp = null;
    this.lastOrigin = this.lastSelOrigin = null;
    this.generation = this.maxGeneration = e || 1;
  }
  function Wi(e, t) {
    var r = {
      from: ve(t.from.line, t.from.ch),
      to: t.text ? ve(t.from.line + t.text.length - 1, t.text[t.text.length - 1].length + (1 == t.text.length ? t.from.ch : 0)) : t.to,
      text: ue(e, t.from, t.to)
    };
    Ii(e, r, t.from.line, t.to.line + 1);
    Ni(e, function (e) {
      return Ii(e, r, t.from.line, t.to.line + 1);
    }, true);
    return r;
  }
  function Hi(e) {
    for (; e.length;) {
      if (!e[e.length - 1].ranges) {
        break;
      }
      e.pop();
    }
  }
  function Fi(e, t, r, n) {
    var i = e.history;
    i.undone.length = 0;
    var o;
    var l;
    var s;
    var a = +new Date();
    if ((i.lastOp == n || i.lastOrigin == t.origin && t.origin && ("+" == t.origin.charAt(0) && i.lastModTime > a - (e.cm ? e.cm.options.historyEventDelay : 500) || "*" == t.origin.charAt(0))) && (o = (s = i).lastOp == n ? (Hi(s.done), s.done[s.done.length - 1]) : s.done.length && !s.done[s.done.length - 1].ranges ? s.done[s.done.length - 1] : 1 < s.done.length && !s.done[s.done.length - 2].ranges ? (s.done.pop(), s.done[s.done.length - 1]) : undefined)) {
      l = o.changes[o.changes.length - 1];
      if (0 == (t.from.line - t.to.line || t.from.ch - t.to.ch) && 0 == (t.from.line - l.to.line || t.from.ch - l.to.ch)) {
        l.to = t.text ? ve(t.from.line + t.text.length - 1, t.text[t.text.length - 1].length + (1 == t.text.length ? t.from.ch : 0)) : t.to;
      } else {
        o.changes.push(Wi(e, t));
      }
    } else {
      var u = i.done[i.done.length - 1];
      if (!(u && u.ranges)) {
        Ei(e.sel, i.done);
      }
      o = {
        changes: [Wi(e, t)],
        generation: i.generation
      };
      for (i.done.push(o); i.done.length > i.undoDepth;) {
        i.done.shift();
        if (!i.done[0].ranges) {
          i.done.shift();
        }
      }
    }
    i.done.push(r);
    i.generation = ++i.maxGeneration;
    i.lastModTime = i.lastSelTime = a;
    i.lastOp = i.lastSelOp = n;
    i.lastOrigin = i.lastSelOrigin = t.origin;
    if (!l) {
      it(e, "historyAdded");
    }
  }
  function Pi(e, t, r, n) {
    var i;
    var o;
    var l;
    var s;
    var a;
    var u = e.history;
    var c = n && n.origin;
    if (r == u.lastSelOp || c && u.lastSelOrigin == c && (u.lastModTime == u.lastSelTime && u.lastOrigin == c || (i = e, o = c, l = u.done[u.done.length - 1], s = t, "*" == (a = o.charAt(0)) || "+" == a && l.ranges.length == s.ranges.length && l.somethingSelected() == s.somethingSelected() && new Date() - i.history.lastSelTime <= (i.cm ? i.cm.options.historyEventDelay : 500)))) {
      u.done[u.done.length - 1] = t;
    } else {
      Ei(t, u.done);
    }
    u.lastSelTime = +new Date();
    u.lastSelOrigin = c;
    u.lastSelOp = r;
    if (n && false !== n.clearRedo) {
      Hi(u.undone);
    }
  }
  function Ei(e, t) {
    var r = t[t.length - 1];
    if (!(r && r.ranges && r.equals(e))) {
      t.push(e);
    }
  }
  function Ii(t, r, e, n) {
    var i = r["spans_" + t.id];
    var o = 0;
    t.iter(Math.max(t.first, e), Math.min(t.first + t.size, n), function (e) {
      if (e.markedSpans) {
        (i || (i = r["spans_" + t.id] = {}))[o] = e.markedSpans;
      }
      ++o;
    });
  }
  function zi(e) {
    if (!e) {
      return null;
    }
    var t;
    for (var r = 0; r < e.length; ++r) {
      if (e[r].marker.explicitlyCleared) {
        if (!t) {
          t = e.slice(0, r);
        }
      } else if (t) {
        t.push(e[r]);
      }
    }
    return t ? t.length ? t : null : e;
  }
  function Ri(e, t) {
    var r = function (e, t) {
      var r = t["spans_" + e.id];
      if (!r) {
        return null;
      }
      var n = [];
      for (var i = 0; i < t.text.length; ++i) {
        n.push(zi(r[i]));
      }
      return n;
    }(e, t);
    var n = Ae(e, t);
    if (!r) {
      return n;
    }
    if (!n) {
      return r;
    }
    for (var i = 0; i < r.length; ++i) {
      var o = r[i];
      var l = n[i];
      if (o && l) {
        e: for (var s = 0; s < l.length; ++s) {
          var a = l[s];
          for (var u = 0; u < o.length; ++u) {
            if (o[u].marker == a.marker) {
              continue e;
            }
          }
          o.push(a);
        }
      } else if (l) {
        r[i] = l;
      }
    }
    return r;
  }
  function Bi(e, t, r) {
    var n = [];
    for (var i = 0; i < e.length; ++i) {
      var o = e[i];
      if (o.ranges) {
        n.push(r ? vi.prototype.deepCopy.call(o) : o);
      } else {
        var l = o.changes;
        var s = [];
        n.push({
          changes: s
        });
        for (var a = 0; a < l.length; ++a) {
          var u = l[a];
          var c = undefined;
          s.push({
            from: u.from,
            to: u.to,
            text: u.text
          });
          if (t) {
            for (var h in u) if ((c = h.match(/^spans_(\d+)$/)) && -1 < B(t, Number(c[1]))) {
              s[s.length - 1][h] = u[h];
              delete u[h];
            }
          }
        }
      }
    }
    return n;
  }
  function Gi(e, t, r, n) {
    if (n) {
      var i = e.anchor;
      if (r) {
        var o = (t.line - i.line || t.ch - i.ch) < 0;
        if (o != (r.line - i.line || r.ch - i.ch) < 0) {
          i = t;
          t = r;
        } else if (o != (t.line - r.line || t.ch - r.ch) < 0) {
          t = r;
        }
      }
      return new mi(i, t);
    }
    return new mi(r || t, t);
  }
  function Ui(e, t, r, n, i) {
    if (null == i) {
      i = e.cm && (e.cm.display.shift || e.extend);
    }
    Yi(e, new vi([Gi(e.sel.primary(), t, r, i)], 0), n);
  }
  function Vi(e, t, r) {
    var n = [];
    var i = e.cm && (e.cm.display.shift || e.extend);
    for (var o = 0; o < e.sel.ranges.length; o++) {
      n[o] = Gi(e.sel.ranges[o], t[o], null, i);
    }
    Yi(e, yi(e.cm, n, e.sel.primIndex), r);
  }
  function Ki(e, t, r, n) {
    var i = e.sel.ranges.slice(0);
    i[t] = r;
    Yi(e, yi(e.cm, i, e.sel.primIndex), n);
  }
  function ji(e, t, r, n) {
    Yi(e, new vi([new mi(t, r || t)], 0), n);
  }
  function Xi(e, t, r) {
    var n = e.history.done;
    var i = n[n.length - 1];
    if (i && i.ranges) {
      _i(e, n[n.length - 1] = t, r);
    } else {
      Yi(e, t, r);
    }
  }
  function Yi(e, t, r) {
    _i(e, t, r);
    Pi(e, e.sel, e.cm ? e.cm.curOp.id : NaN, r);
  }
  function _i(e, t, r) {
    var n;
    var i;
    var o;
    var l;
    if (0 < (e._handlers && e._handlers[t] || et).length || e.cm && 0 < (e.cm._handlers && e.cm._handlers[t] || et).length) {
      n = e;
      o = r;
      l = {
        ranges: (i = t).ranges,
        update: function (e) {
          this.ranges = [];
          for (var t = 0; t < e.length; t++) {
            this.ranges[t] = new mi(Se(n, e[t].anchor), Se(n, e[t].head));
          }
        },
        origin: o && o.origin
      };
      it(n, "beforeSelectionChange", n, l);
      if (n.cm) {
        it(n.cm, "beforeSelectionChange", n.cm, l);
      }
      t = l.ranges != i.ranges ? yi(n.cm, l.ranges, l.ranges.length - 1) : i;
    }
    $i(e, Zi(e, t, r && r.bias || ((t.primary().head.line - e.sel.primary().head.line || t.primary().head.ch - e.sel.primary().head.ch) < 0 ? -1 : 1), true));
    if (!(r && false === r.scroll || !e.cm)) {
      kn(e.cm);
    }
  }
  function $i(e, t) {
    if (!t.equals(e.sel)) {
      e.sel = t;
      if (e.cm) {
        e.cm.curOp.updateInput = 1;
        e.cm.curOp.selectionChanged = true;
        lt(e.cm);
      }
      sr(e, "cursorActivity", e);
    }
  }
  function qi(e) {
    $i(e, Zi(e, e.sel, null, false));
  }
  function Zi(e, t, r, n) {
    var i;
    for (var o = 0; o < t.ranges.length; o++) {
      var l = t.ranges[o];
      var s = t.ranges.length == e.sel.ranges.length && e.sel.ranges[o];
      var a = Ji(e, l.anchor, s && s.anchor, r, n);
      var u = Ji(e, l.head, s && s.head, r, n);
      if (i || a != l.anchor || u != l.head) {
        if (!i) {
          i = t.ranges.slice(0, o);
        }
        i[o] = new mi(a, u);
      }
    }
    return i ? yi(e.cm, i, t.primIndex) : t;
  }
  function Qi(e, t, r, n, i) {
    var o = ae(e, t.line);
    if (o.markedSpans) {
      for (var l = 0; l < o.markedSpans.length; ++l) {
        var s = o.markedSpans[l];
        var a = s.marker;
        if ((null == s.from || (a.inclusiveLeft ? s.from <= t.ch : s.from < t.ch)) && (null == s.to || (a.inclusiveRight ? s.to >= t.ch : s.to > t.ch))) {
          if (i && (it(a, "beforeCursorEnter"), a.explicitlyCleared)) {
            if (o.markedSpans) {
              --l;
              continue;
            }
            break;
          }
          if (!a.atomic) {
            continue;
          }
          if (r) {
            var u = a.find(n < 0 ? 1 : -1);
            var c = undefined;
            if (n < 0 ? a.inclusiveRight : a.inclusiveLeft) {
              u = -n < 0 && 0 == u.ch ? u.line > e.first ? Se(e, ve(u.line - 1)) : null : 0 < -n && u.ch == ((u && u.line == t.line ? o : null) || ae(e, u.line)).text.length ? u.line < e.first + e.size - 1 ? ve(u.line + 1, 0) : null : new ve(u.line, u.ch + -n);
            }
            if (u && u.line == t.line && (c = u.line - r.line || u.ch - r.ch) && (n < 0 ? c < 0 : 0 < c)) {
              return Qi(e, u, t, n, i);
            }
          }
          var h = a.find(n < 0 ? -1 : 1);
          if (n < 0 ? a.inclusiveLeft : a.inclusiveRight) {
            h = n < 0 && 0 == h.ch ? h.line > e.first ? Se(e, ve(h.line - 1)) : null : 0 < n && h.ch == ((h.line == t.line ? o : null) || ae(e, h.line)).text.length ? h.line < e.first + e.size - 1 ? ve(h.line + 1, 0) : null : new ve(h.line, h.ch + n);
          }
          return h ? Qi(e, h, t, n, i) : null;
        }
      }
    }
    return t;
  }
  function Ji(e, t, r, n, i) {
    var o = n || 1;
    var l = Qi(e, t, r, o, i) || !i && Qi(e, t, r, o, true) || Qi(e, t, r, -o, i) || !i && Qi(e, t, r, -o, true);
    return l || (e.cantEdit = true, ve(e.first, 0));
  }
  function to(e) {
    e.setSelection(ve(e.firstLine(), 0), ve(e.lastLine()), V);
  }
  function ro(i, e, t) {
    var o = {
      canceled: false,
      from: e.from,
      to: e.to,
      text: e.text,
      origin: e.origin,
      cancel: function () {
        return o.canceled = true;
      }
    };
    if (t) {
      o.update = function (e, t, r, n) {
        if (e) {
          o.from = Se(i, e);
        }
        if (t) {
          o.to = Se(i, t);
        }
        if (r) {
          o.text = r;
        }
        if (undefined !== n) {
          o.origin = n;
        }
      };
    }
    it(i, "beforeChange", i, o);
    if (i.cm) {
      it(i.cm, "beforeChange", i.cm, o);
    }
    return {
      from: o.from,
      to: o.to,
      text: o.text,
      origin: o.origin
    };
  }
  function no(e, t, r) {
    if (e.cm) {
      if (!e.cm.curOp) {
        return Yn(e.cm, no)(e, t, r);
      }
      if (e.cm.state.suppressEdits) {
        return;
      }
    }
    if (!(0 < (e._handlers && e._handlers[t] || et).length || e.cm && 0 < (e.cm._handlers && e.cm._handlers[t] || et).length) || (t = ro(e, t, true))) {
      var n = ke && !r && function (e, t, r) {
        var n = null;
        e.iter(t.line, r.line + 1, function (e) {
          if (e.markedSpans) {
            for (var t = 0; t < e.markedSpans.length; ++t) {
              var r = e.markedSpans[t].marker;
              if (!(!r.readOnly || n && -1 != B(n, r))) {
                (n || (n = [])).push(r);
              }
            }
          }
        });
        if (!n) {
          return null;
        }
        var i = [{
          from: t,
          to: r
        }];
        for (var o = 0; o < n.length; ++o) {
          var l = n[o];
          var s = l.find(0);
          for (var a = 0; a < i.length; ++a) {
            var u = i[a];
            if (!((u.to.line - s.from.line || u.to.ch - s.from.ch) < 0 || 0 < (u.from.line - s.to.line || u.from.ch - s.to.ch))) {
              var c = [a, 1];
              var h = u.from.line - s.from.line || u.from.ch - s.from.ch;
              var f = u.to.line - s.to.line || u.to.ch - s.to.ch;
              if (h < 0 || !l.inclusiveLeft && !h) {
                c.push({
                  from: u.from,
                  to: s.from
                });
              }
              if (0 < f || !l.inclusiveRight && !f) {
                c.push({
                  from: s.to,
                  to: u.to
                });
              }
              i.splice.apply(i, c);
              a += c.length - 3;
            }
          }
        }
        return i;
      }(e, t.from, t.to);
      if (n) {
        for (var i = n.length - 1; 0 <= i; --i) {
          io(e, {
            from: n[i].from,
            to: n[i].to,
            text: i ? [""] : t.text,
            origin: t.origin
          });
        }
      } else {
        io(e, t);
      }
    }
  }
  function io(e, r) {
    if (1 != r.text.length || "" != r.text[0] || 0 != (r.from.line - r.to.line || r.from.ch - r.to.ch)) {
      var t = Ci(e, r);
      Fi(e, r, t, e.cm ? e.cm.curOp.id : NaN);
      so(e, r, t, Ae(e, r));
      var n = [];
      Ni(e, function (e, t) {
        if (!(t || -1 != B(n, e.history))) {
          ho(e.history, r);
          n.push(e.history);
        }
        so(e, r, null, Ae(e, r));
      });
    }
  }
  function oo(i, o, e) {
    var t = i.cm && i.cm.state.suppressEdits;
    if (!t || e) {
      var l;
      var r = i.history;
      var n = i.sel;
      var s = "undo" == o ? r.done : r.undone;
      var a = "undo" == o ? r.undone : r.done;
      for (var u = 0; u < s.length && (l = s[u], e ? !l.ranges || l.equals(i.sel) : l.ranges); u++) {
        ;
      }
      if (u != s.length) {
        for (r.lastOrigin = r.lastSelOrigin = null;;) {
          if (!(l = s.pop()).ranges) {
            if (t) {
              return void s.push(l);
            }
            break;
          }
          Ei(l, a);
          if (e && !l.equals(i.sel)) {
            return void Yi(i, l, {
              clearRedo: false
            });
          }
          n = l;
        }
        var c = [];
        Ei(n, a);
        a.push({
          changes: c,
          generation: r.generation
        });
        r.generation = l.generation || ++r.maxGeneration;
        var h = 0 < (i._handlers && i._handlers[t] || et).length || i.cm && 0 < (i.cm._handlers && i.cm._handlers[t] || et).length;
        var f = function (e) {
          var r = l.changes[e];
          r.origin = o;
          if (h && !ro(i, r, false)) {
            s.length = 0;
            return {};
          }
          c.push(Wi(i, r));
          var t = e ? Ci(i, r) : s[s.length - 1];
          so(i, r, t, Ri(i, r));
          if (!e && i.cm) {
            i.cm.scrollIntoView({
              from: r.from,
              to: r.text ? ve(r.from.line + r.text.length - 1, r.text[r.text.length - 1].length + (1 == r.text.length ? r.from.ch : 0)) : r.to
            });
          }
          var n = [];
          Ni(i, function (e, t) {
            if (!(t || -1 != B(n, e.history))) {
              ho(e.history, r);
              n.push(e.history);
            }
            so(e, r, null, Ri(e, r));
          });
        };
        for (var d = l.changes.length - 1; 0 <= d; --d) {
          var p = f(d);
          if (p) {
            return p.v;
          }
        }
      }
    }
  }
  function lo(e, t) {
    if (0 != t && (e.first += t, e.sel = new vi(q(e.sel.ranges, function (e) {
      return new mi(ve(e.anchor.line + t, e.anchor.ch), ve(e.head.line + t, e.head.ch));
    }), e.sel.primIndex), e.cm)) {
      qn(e.cm, e.first, e.first - t, t);
      var r = e.cm.display;
      for (var n = r.viewFrom; n < r.viewTo; n++) {
        Zn(e.cm, n, "gutter");
      }
    }
  }
  function so(e, t, r, n) {
    if (e.cm && !e.cm.curOp) {
      return Yn(e.cm, so)(e, t, r, n);
    }
    if (t.to.line < e.first) {
      lo(e, t.text.length - 1 - (t.to.line - t.from.line));
    } else if (!(t.from.line > e.lastLine())) {
      if (t.from.line < e.first) {
        var i = t.text.length - 1 - (e.first - t.from.line);
        lo(e, i);
        t = {
          from: ve(e.first, 0),
          to: ve(t.to.line + i, t.to.ch),
          text: [t.text[t.text.length - 1]],
          origin: t.origin
        };
      }
      var o = e.lastLine();
      if (t.to.line > o) {
        t = {
          from: t.from,
          to: ve(o, ae(e, o).text.length),
          text: [t.text[0]],
          origin: t.origin
        };
      }
      t.removed = ue(e, t.from, t.to);
      if (!r) {
        r = Ci(e, t);
      }
      if (e.cm) {
        (function (e, t, r) {
          var n = e.doc;
          var i = e.display;
          var o = t.from;
          var l = t.to;
          var s = false;
          var a = o.line;
          if (!e.options.lineWrapping) {
            a = fe(Ue(ae(n, o.line)));
            n.iter(a, l.line + 1, function (e) {
              if (e == i.maxLine) {
                return s = true;
              }
            });
          }
          if (-1 < n.sel.contains(t.from, t.to)) {
            lt(e);
          }
          Mi(n, t, r, nn(e));
          if (!e.options.lineWrapping) {
            n.iter(a, o.line + t.text.length, function (e) {
              var t = _e(e);
              if (t > i.maxLineLength) {
                i.maxLine = e;
                i.maxLineLength = t;
                i.maxLineChanged = true;
                s = false;
              }
            });
            if (s) {
              e.curOp.updateMaxLine = true;
            }
          }
          (function (e, t) {
            e.modeFrontier = Math.min(e.modeFrontier, t);
            if (!(e.highlightFrontier < t - 10)) {
              var r = e.first;
              for (var n = t - 1; r < n; n--) {
                var i = ae(e, n).stateAfter;
                if (i && (!(i instanceof Pt) || n + i.lookAhead < t)) {
                  r = n + 1;
                  break;
                }
              }
              e.highlightFrontier = Math.min(e.highlightFrontier, r);
            }
          })(n, o.line);
          ti(e, 400);
          var u = t.text.length - (l.line - o.line) - 1;
          if (t.full) {
            qn(e);
          } else if (o.line != l.line || 1 != t.text.length || 0 == t.from.ch && 0 == t.to.ch && "" == t.text[t.text.length - 1] && (!e.doc.cm || e.doc.cm.options.wholeLineUpdateBefore)) {
            qn(e, o.line, l.line + 1, u);
          } else {
            Zn(e, o.line, "text");
          }
          var c = 0 < (e._handlers && e._handlers[t] || et).length;
          var h = 0 < (e._handlers && e._handlers[t] || et).length;
          if (h || c) {
            var f = {
              from: o,
              to: l,
              text: t.text,
              removed: t.removed,
              origin: t.origin
            };
            if (h) {
              sr(e, "change", e, f);
            }
            if (c) {
              (e.curOp.changeObjs || (e.curOp.changeObjs = [])).push(f);
            }
          }
          e.display.selForContextMenu = null;
        })(e.cm, t, n);
      } else {
        Mi(e, t, n);
      }
      _i(e, r, V);
    }
  }
  function ao(e, t, r, n, i) {
    var o;
    if (!n) {
      n = r;
    }
    if ((n.line - r.line || n.ch - r.ch) < 0) {
      r = (o = [n, r])[0];
      n = o[1];
    }
    if ("string" == typeof t) {
      t = e.splitLines(t);
    }
    no(e, {
      from: r,
      to: n,
      text: t,
      origin: i
    });
  }
  function uo(e, t, r, n) {
    if (r < e.line) {
      e.line += n;
    } else if (t < e.line) {
      e.line = t;
      e.ch = 0;
    }
  }
  function co(e, t, r, n) {
    for (var i = 0; i < e.length; ++i) {
      var o = e[i];
      var l = true;
      if (o.ranges) {
        if (!o.copied) {
          (o = e[i] = o.deepCopy()).copied = true;
        }
        for (var s = 0; s < o.ranges.length; s++) {
          uo(o.ranges[s].anchor, t, r, n);
          uo(o.ranges[s].head, t, r, n);
        }
      } else {
        for (var a = 0; a < o.changes.length; ++a) {
          var u = o.changes[a];
          if (r < u.from.line) {
            u.from = ve(u.from.line + n, u.from.ch);
            u.to = ve(u.to.line + n, u.to.ch);
          } else if (t <= u.to.line) {
            l = false;
            break;
          }
        }
        if (!l) {
          e.splice(0, i + 1);
          i = 0;
        }
      }
    }
  }
  function ho(e, t) {
    var r = t.from.line;
    var n = t.to.line;
    var i = t.text.length - (n - r) - 1;
    co(e.done, r, n, i);
    co(e.undone, r, n, i);
  }
  function fo(e, t, r, n) {
    var i = t;
    var o = t;
    if ("number" == typeof t) {
      o = ae(e, Math.max(e.first, Math.min(t, e.first + e.size - 1)));
    } else {
      i = fe(t);
    }
    return null == i ? null : (n(o, i) && e.cm && Zn(e.cm, i, r), o);
  }
  function po(e) {
    this.lines = e;
    this.parent = null;
    var t = 0;
    for (var r = 0; r < e.length; ++r) {
      e[r].parent = this;
      t += e[r].height;
    }
    this.height = t;
  }
  function go(e) {
    this.children = e;
    var t = 0;
    var r = 0;
    for (var n = 0; n < e.length; ++n) {
      var i = e[n];
      t += i.chunkSize();
      r += i.height;
      i.parent = this;
    }
    this.size = t;
    this.height = r;
    this.parent = null;
  }
  mi.prototype.from = function () {
    return (this.anchor.line - this.head.line || this.anchor.ch - this.head.ch) < 0 ? this.anchor : this.head;
  };
  mi.prototype.to = function () {
    return (this.anchor.line - this.head.line || this.anchor.ch - this.head.ch) < 0 ? this.head : this.anchor;
  };
  mi.prototype.empty = function () {
    return this.head.line == this.anchor.line && this.head.ch == this.anchor.ch;
  };
  po.prototype = {
    chunkSize: function () {
      return this.lines.length;
    },
    removeInner: function (e, t) {
      var r;
      var n = e;
      for (var i = e + t; n < i; ++n) {
        var o = this.lines[n];
        this.height -= o.height;
        (r = o).parent = null;
        We(r);
        sr(o, "delete");
      }
      this.lines.splice(e, t);
    },
    collapse: function (e) {
      e.push.apply(e, this.lines);
    },
    insertInner: function (e, t, r) {
      this.height += r;
      this.lines = this.lines.slice(0, e).concat(t).concat(this.lines.slice(e));
      for (var n = 0; n < t.length; ++n) {
        t[n].parent = this;
      }
    },
    iterN: function (e, t, r) {
      for (var n = e + t; e < n; ++e) {
        if (r(this.lines[e])) {
          return true;
        }
      }
    }
  };
  go.prototype = {
    chunkSize: function () {
      return this.size;
    },
    removeInner: function (e, t) {
      this.size -= t;
      for (var r = 0; r < this.children.length; ++r) {
        var n = this.children[r];
        var i = n.chunkSize();
        if (e < i) {
          var o = Math.min(t, i - e);
          var l = n.height;
          n.removeInner(e, o);
          this.height -= l - n.height;
          if (i == o) {
            this.children.splice(r--, 1);
            n.parent = null;
          }
          if (0 == (t -= o)) {
            break;
          }
          e = 0;
        } else {
          e -= i;
        }
      }
      if (this.size - t < 25 && (1 < this.children.length || !(this.children[0] instanceof po))) {
        var s = [];
        this.collapse(s);
        this.children = [new po(s)];
        this.children[0].parent = this;
      }
    },
    collapse: function (e) {
      for (var t = 0; t < this.children.length; ++t) {
        this.children[t].collapse(e);
      }
    },
    insertInner: function (e, t, r) {
      this.size += t.length;
      this.height += r;
      for (var n = 0; n < this.children.length; ++n) {
        var i = this.children[n];
        var o = i.chunkSize();
        if (e <= o) {
          i.insertInner(e, t, r);
          if (i.lines && 50 < i.lines.length) {
            var l = i.lines.length % 25 + 25;
            for (var s = l; s < i.lines.length;) {
              var a = new po(i.lines.slice(s, s += 25));
              i.height -= a.height;
              this.children.splice(++n, 0, a);
              a.parent = this;
            }
            i.lines = i.lines.slice(0, l);
            this.maybeSpill();
          }
          break;
        }
        e -= o;
      }
    },
    maybeSpill: function () {
      if (!(this.children.length <= 10)) {
        var e = this;
        do {
          var t = new go(e.children.splice(e.children.length - 5, 5));
          if (e.parent) {
            e.size -= t.size;
            e.height -= t.height;
            var r = B(e.parent.children, e);
            e.parent.children.splice(r + 1, 0, t);
          } else {
            var n = new go(e.children);
            (n.parent = e).children = [n, t];
            e = n;
          }
          t.parent = e.parent;
        } while (10 < e.children.length);
        e.parent.maybeSpill();
      }
    },
    iterN: function (e, t, r) {
      for (var n = 0; n < this.children.length; ++n) {
        var i = this.children[n];
        var o = i.chunkSize();
        if (e < o) {
          var l = Math.min(t, o - e);
          if (i.iterN(e, l, r)) {
            return true;
          }
          if (0 == (t -= l)) {
            break;
          }
          e = 0;
        } else {
          e -= o;
        }
      }
    }
  };
  var vo = function (e, t, r) {
    if (r) {
      for (var n in r) if (r.hasOwnProperty(n)) {
        this[n] = r[n];
      }
    }
    this.doc = e;
    this.node = t;
  };
  function mo(e, t, r) {
    if (Ye(t) < (e.curOp && e.curOp.scrollTop || e.doc.scrollTop)) {
      Ln(e, r);
    }
  }
  vo.prototype.clear = function () {
    var e = this.doc.cm;
    var t = this.line.widgets;
    var r = this.line;
    var n = fe(r);
    if (null != n && t) {
      for (var i = 0; i < t.length; ++i) {
        if (t[i] == this) {
          t.splice(i--, 1);
        }
      }
      if (!t.length) {
        r.widgets = null;
      }
      var o = br(this);
      he(r, Math.max(0, r.height - o));
      if (e) {
        Xn(e, function () {
          mo(e, r, -o);
          Zn(e, n, "widget");
        });
        sr(e, "lineWidgetCleared", e, this, n);
      }
    }
  };
  vo.prototype.changed = function () {
    var e = this;
    var t = this.height;
    var r = this.doc.cm;
    var n = this.line;
    this.height = null;
    var i = br(this) - t;
    if (i) {
      if (!je(this.doc, n)) {
        he(n, n.height + i);
      }
      if (r) {
        Xn(r, function () {
          r.curOp.forceUpdate = true;
          mo(r, n, i);
          sr(r, "lineWidgetChanged", r, e, fe(n));
        });
      }
    }
  };
  at(vo);
  var yo = 0;
  var bo = function (e, t) {
    this.lines = [];
    this.type = t;
    this.doc = e;
    this.id = ++yo;
  };
  function wo(t, n, i, e, r) {
    if (e && e.shared) {
      return function (e, r, n, i, o) {
        (i = I(i)).shared = false;
        var l = [wo(e, r, n, i, o)];
        var s = l[0];
        var a = i.widgetNode;
        Ni(e, function (e) {
          if (a) {
            i.widgetNode = a.cloneNode(true);
          }
          l.push(wo(e, Se(e, r), Se(e, n), i, o));
          for (var t = 0; t < e.linked.length; ++t) {
            if (e.linked[t].isParent) {
              return;
            }
          }
          s = l[l.length - 1];
        });
        return new xo(l, s);
      }(t, n, i, e, r);
    }
    if (t.cm && !t.cm.curOp) {
      return Yn(t.cm, wo)(t, n, i, e, r);
    }
    var o = new bo(t, r);
    var l = n.line - i.line || n.ch - i.ch;
    if (e) {
      I(e, o, false);
    }
    if (0 < l || 0 == l && false !== o.clearWhenEmpty) {
      return o;
    }
    if (o.replacedWith) {
      o.collapsed = true;
      o.widgetNode = O("span", [o.replacedWith], "CodeMirror-widget");
      if (!e.handleMouseEvents) {
        o.widgetNode.setAttribute("cm-ignore-events", "true");
      }
      if (e.insertLeft) {
        o.widgetNode.insertLeft = true;
      }
    }
    if (o.collapsed) {
      if (Ge(t, n.line, n, i, o) || n.line != i.line && Ge(t, i.line, n, i, o)) {
        throw new Error("Inserting collapsed marker partially overlapping an existing one");
      }
      Te = true;
    }
    if (o.addToHistory) {
      Fi(t, {
        from: n,
        to: i,
        origin: "markText"
      }, t.sel, NaN);
    }
    var s;
    var a = n.line;
    var u = t.cm;
    t.iter(a, i.line + 1, function (e) {
      var r;
      if (u && o.collapsed && !u.options.lineWrapping && Ue(e) == u.display.maxLine) {
        s = true;
      }
      if (o.collapsed && a != n.line) {
        he(e, 0);
      }
      r = new Me(o, a == n.line ? n.ch : null, a == i.line ? i.ch : null);
      e.markedSpans = e.markedSpans ? e.markedSpans.concat([r]) : [r];
      r.marker.attachLine(e);
      ++a;
    });
    if (o.collapsed) {
      t.iter(n.line, i.line + 1, function (e) {
        if (je(t, e)) {
          he(e, 0);
        }
      });
    }
    if (o.clearOnEnter) {
      tt(o, "beforeCursorEnter", function () {
        return o.clear();
      });
    }
    if (o.readOnly) {
      ke = true;
      if (t.history.done.length || t.history.undone.length) {
        t.clearHistory();
      }
    }
    if (o.collapsed) {
      o.id = ++yo;
      o.atomic = true;
    }
    if (u) {
      if (s) {
        u.curOp.updateMaxLine = true;
      }
      if (o.collapsed) {
        qn(u, n.line, i.line + 1);
      } else if (o.className || o.startStyle || o.endStyle || o.css || o.attributes || o.title) {
        for (var c = n.line; c <= i.line; c++) {
          Zn(u, c, "text");
        }
      }
      if (o.atomic) {
        qi(u.doc);
      }
      sr(u, "markerAdded", u, o);
    }
    return o;
  }
  bo.prototype.clear = function () {
    var e = this;
    if (!this.explicitlyCleared) {
      var t = this.doc.cm;
      var r = t && !t.curOp;
      if (r) {
        Bn(t);
      }
      if (0 < (this._handlers && this._handlers[t] || et).length) {
        var n = this.find();
        if (n) {
          sr(this, "clear", n.from, n.to);
        }
      }
      var i = null;
      var o = null;
      for (var l = 0; l < this.lines.length; ++l) {
        var s = e.lines[l];
        var a = Ne(s.markedSpans, e);
        if (t && !e.collapsed) {
          Zn(t, fe(s), "text");
        } else if (t) {
          if (null != a.to) {
            o = fe(s);
          }
          if (null != a.from) {
            i = fe(s);
          }
        }
        s.markedSpans = Oe(s.markedSpans, a);
        if (null == a.from && e.collapsed && !je(e.doc, s) && t) {
          he(s, Jr(t.display));
        }
      }
      if (t && this.collapsed && !t.options.lineWrapping) {
        for (var u = 0; u < this.lines.length; ++u) {
          var c = Ue(e.lines[u]);
          var h = _e(c);
          if (h > t.display.maxLineLength) {
            t.display.maxLine = c;
            t.display.maxLineLength = h;
            t.display.maxLineChanged = true;
          }
        }
      }
      if (null != i && t && this.collapsed) {
        qn(t, i, o + 1);
      }
      this.lines.length = 0;
      this.explicitlyCleared = true;
      if (this.atomic && this.doc.cantEdit) {
        this.doc.cantEdit = false;
        if (t) {
          qi(t.doc);
        }
      }
      if (t) {
        sr(t, "markerCleared", t, this, i, o);
      }
      if (r) {
        Gn(t);
      }
      if (this.parent) {
        this.parent.clear();
      }
    }
  };
  bo.prototype.find = function (e, t) {
    var r;
    var n;
    if (null == e && "bookmark" == this.type) {
      e = 1;
    }
    for (var i = 0; i < this.lines.length; ++i) {
      var o = this.lines[i];
      var l = Ne(o.markedSpans, this);
      if (null != l.from && (r = ve(t ? o : fe(o), l.from), -1 == e)) {
        return r;
      }
      if (null != l.to && (n = ve(t ? o : fe(o), l.to), 1 == e)) {
        return n;
      }
    }
    return r && {
      from: r,
      to: n
    };
  };
  bo.prototype.changed = function () {
    var o = this;
    var l = this.find(-1, true);
    var s = this;
    var a = this.doc.cm;
    if (l && a) {
      Xn(a, function () {
        var e = l.line;
        var t = fe(l.line);
        var r = Or(a, t);
        if (r) {
          Er(r);
          a.curOp.selectionChanged = a.curOp.forceUpdate = true;
        }
        a.curOp.updateMaxLine = true;
        if (!je(s.doc, e) && null != s.height) {
          var n = s.height;
          s.height = null;
          var i = br(s) - n;
          if (i) {
            he(e, e.height + i);
          }
        }
        sr(a, "markerChanged", a, o);
      });
    }
  };
  bo.prototype.attachLine = function (e) {
    if (!this.lines.length && this.doc.cm) {
      var t = this.doc.cm.curOp;
      if (!(t.maybeHiddenMarkers && -1 != B(t.maybeHiddenMarkers, this))) {
        (t.maybeUnhiddenMarkers || (t.maybeUnhiddenMarkers = [])).push(this);
      }
    }
    this.lines.push(e);
  };
  bo.prototype.detachLine = function (e) {
    this.lines.splice(B(this.lines, e), 1);
    if (!this.lines.length && this.doc.cm) {
      var t = this.doc.cm.curOp;
      (t.maybeHiddenMarkers || (t.maybeHiddenMarkers = [])).push(this);
    }
  };
  at(bo);
  var xo = function (e, t) {
    this.markers = e;
    this.primary = t;
    for (var r = 0; r < e.length; ++r) {
      e[r].parent = this;
    }
  };
  function Co(e) {
    return e.findMarks(ve(e.first, 0), e.clipPos(ve(e.lastLine())), function (e) {
      return e.parent;
    });
  }
  function So(o) {
    var e = function (e) {
      var t = o[e];
      var r = [t.primary.doc];
      Ni(t.primary.doc, function (e) {
        return r.push(e);
      });
      for (var n = 0; n < t.markers.length; n++) {
        var i = t.markers[n];
        if (-1 == B(r, i.doc)) {
          i.parent = null;
          t.markers.splice(n--, 1);
        }
      }
    };
    for (var t = 0; t < o.length; t++) {
      e(t);
    }
  }
  xo.prototype.clear = function () {
    if (!this.explicitlyCleared) {
      this.explicitlyCleared = true;
      for (var e = 0; e < this.markers.length; ++e) {
        this.markers[e].clear();
      }
      sr(this, "clear");
    }
  };
  xo.prototype.find = function (e, t) {
    return this.primary.find(e, t);
  };
  at(xo);
  var Lo = 0;
  var ko = function (e, t, r, n, i) {
    if (!(this instanceof ko)) {
      return new ko(e, t, r, n, i);
    }
    if (null == r) {
      r = 0;
    }
    go.call(this, [new po([new Yt("", null)])]);
    this.first = r;
    this.scrollTop = this.scrollLeft = 0;
    this.cantEdit = false;
    this.cleanGeneration = 1;
    this.modeFrontier = this.highlightFrontier = r;
    var o = ve(r, 0);
    this.sel = new vi([new mi(o, undefined || o)], 0);
    this.history = new Di(null);
    this.id = ++Lo;
    this.modeOption = t;
    this.lineSep = n;
    this.direction = "rtl" == i ? "rtl" : "ltr";
    this.extend = false;
    if ("string" == typeof e) {
      e = this.splitLines(e);
    }
    Mi(this, {
      from: o,
      to: o,
      text: e
    });
    Yi(this, new vi([new mi(o, undefined || o)], 0), V);
  };
  ko.prototype = Q(go.prototype, {
    constructor: ko,
    iter: function (e, t, r) {
      if (r) {
        this.iterN(e - this.first, t - e, r);
      } else {
        this.iterN(this.first, this.first + this.size, e);
      }
    },
    insert: function (e, t) {
      var r = 0;
      for (var n = 0; n < t.length; ++n) {
        r += t[n].height;
      }
      this.insertInner(e - this.first, t, r);
    },
    remove: function (e, t) {
      this.removeInner(e - this.first, t);
    },
    getValue: function (e) {
      var t = ce(this, this.first, this.first + this.size);
      return false === e ? t : t.join(e || this.lineSeparator());
    },
    setValue: $n(function (e) {
      var t = ve(this.first, 0);
      var r = this.first + this.size - 1;
      no(this, {
        from: t,
        to: ve(r, ae(this, r).text.length),
        text: this.splitLines(e),
        origin: "setValue",
        full: true
      }, true);
      if (this.cm) {
        Tn(this.cm, 0, 0);
      }
      Yi(this, new vi([new mi(t, undefined || t)], 0), V);
    }),
    replaceRange: function (e, t, r, n) {
      ao(this, e, t = Se(this, t), r = r ? Se(this, r) : t, n);
    },
    getRange: function (e, t, r) {
      var n = ue(this, Se(this, e), Se(this, t));
      return false === r ? n : n.join(r || this.lineSeparator());
    },
    getLine: function (e) {
      var t = this.getLineHandle(e);
      return t && t.text;
    },
    getLineHandle: function (e) {
      if (e >= this.first && e < this.first + this.size) {
        return ae(this, e);
      }
    },
    getLineNumber: function (e) {
      return fe(e);
    },
    getLineHandleVisualStart: function (e) {
      if ("number" == typeof e) {
        e = ae(this, e);
      }
      return Ue(e);
    },
    lineCount: function () {
      return this.size;
    },
    firstLine: function () {
      return this.first;
    },
    lastLine: function () {
      return this.first + this.size - 1;
    },
    clipPos: function (e) {
      return Se(this, e);
    },
    getCursor: function (e) {
      var t = this.sel.primary();
      return null == e || "head" == e ? t.head : "anchor" == e ? t.anchor : "end" == e || "to" == e || false === e ? t.to() : t.from();
    },
    listSelections: function () {
      return this.sel.ranges;
    },
    somethingSelected: function () {
      return this.sel.somethingSelected();
    },
    setCursor: $n(function (e, t, r) {
      ji(this, Se(this, "number" == typeof e ? ve(e, t || 0) : e), null, r);
    }),
    setSelection: $n(function (e, t, r) {
      ji(this, Se(this, e), Se(this, t || e), r);
    }),
    extendSelection: $n(function (e, t, r) {
      Ui(this, Se(this, e), t && Se(this, t), r);
    }),
    extendSelections: $n(function (e, t) {
      Vi(this, Le(this, e), t);
    }),
    extendSelectionsBy: $n(function (e, t) {
      Vi(this, Le(this, q(this.sel.ranges, e)), t);
    }),
    setSelections: $n(function (e, t, r) {
      if (e.length) {
        var n = [];
        for (var i = 0; i < e.length; i++) {
          n[i] = new mi(Se(this, e[i].anchor), Se(this, e[i].head));
        }
        if (null == t) {
          t = Math.min(e.length - 1, this.sel.primIndex);
        }
        Yi(this, yi(this.cm, n, t), r);
      }
    }),
    addSelection: $n(function (e, t, r) {
      var n = this.sel.ranges.slice(0);
      n.push(new mi(Se(this, e), Se(this, t || e)));
      Yi(this, yi(this.cm, n, n.length - 1), r);
    }),
    getSelection: function (e) {
      var t;
      var r = this.sel.ranges;
      for (var n = 0; n < r.length; n++) {
        var i = ue(this, r[n].from(), r[n].to());
        t = t ? t.concat(i) : i;
      }
      return false === e ? t : t.join(e || this.lineSeparator());
    },
    getSelections: function (e) {
      var t = [];
      var r = this.sel.ranges;
      for (var n = 0; n < r.length; n++) {
        var i = ue(this, r[n].from(), r[n].to());
        if (false !== e) {
          i = i.join(e || this.lineSeparator());
        }
        t[n] = i;
      }
      return t;
    },
    replaceSelection: function (e, t, r) {
      var n = [];
      for (var i = 0; i < this.sel.ranges.length; i++) {
        n[i] = e;
      }
      this.replaceSelections(n, t, r || "+input");
    },
    replaceSelections: $n(function (e, t, r) {
      var n = [];
      var i = this.sel;
      for (var o = 0; o < i.ranges.length; o++) {
        var l = i.ranges[o];
        n[o] = {
          from: l.from(),
          to: l.to(),
          text: this.splitLines(e[o]),
          origin: r
        };
      }
      var s = t && "end" != t && function (e, t, r) {
        var n = [];
        var i = ve(e.first, 0);
        var o = i;
        for (var l = 0; l < t.length; l++) {
          var s = t[l];
          var a = s.from.line == i.line ? ve(o.line, s.from.ch - i.ch + o.ch) : ve(o.line + (s.from.line - i.line), s.from.ch);
          var u = (s.text ? ve(s.from.line + s.text.length - 1, s.text[s.text.length - 1].length + (1 == s.text.length ? s.from.ch : 0)) : s.to).line == i.line ? ve(o.line, (s.text ? ve(s.from.line + s.text.length - 1, s.text[s.text.length - 1].length + (1 == s.text.length ? s.from.ch : 0)) : s.to).ch - i.ch + o.ch) : ve(o.line + ((s.text ? ve(s.from.line + s.text.length - 1, s.text[s.text.length - 1].length + (1 == s.text.length ? s.from.ch : 0)) : s.to).line - i.line), (s.text ? ve(s.from.line + s.text.length - 1, s.text[s.text.length - 1].length + (1 == s.text.length ? s.from.ch : 0)) : s.to).ch);
          i = s.to;
          o = u;
          if ("around" == r) {
            var c = e.sel.ranges[l];
            var h = (c.head.line - c.anchor.line || c.head.ch - c.anchor.ch) < 0;
            n[l] = new mi(h ? u : a, h ? a : u);
          } else {
            n[l] = new mi(a, a);
          }
        }
        return new vi(n, e.sel.primIndex);
      }(this, n, t);
      for (var a = n.length - 1; 0 <= a; a--) {
        no(this, n[a]);
      }
      if (s) {
        Xi(this, s);
      } else if (this.cm) {
        kn(this.cm);
      }
    }),
    undo: $n(function () {
      oo(this, "undo");
    }),
    redo: $n(function () {
      oo(this, "redo");
    }),
    undoSelection: $n(function () {
      oo(this, "undo", true);
    }),
    redoSelection: $n(function () {
      oo(this, "redo", true);
    }),
    setExtending: function (e) {
      this.extend = e;
    },
    getExtending: function () {
      return this.extend;
    },
    historySize: function () {
      var e = this.history;
      var t = 0;
      var r = 0;
      for (var n = 0; n < e.done.length; n++) {
        if (!e.done[n].ranges) {
          ++t;
        }
      }
      for (var i = 0; i < e.undone.length; i++) {
        if (!e.undone[i].ranges) {
          ++r;
        }
      }
      return {
        undo: t,
        redo: r
      };
    },
    clearHistory: function () {
      this.history = new Di(this.history.maxGeneration);
    },
    markClean: function () {
      this.cleanGeneration = this.changeGeneration(true);
    },
    changeGeneration: function (e) {
      if (e) {
        this.history.lastOp = this.history.lastSelOp = this.history.lastOrigin = null;
      }
      return this.history.generation;
    },
    isClean: function (e) {
      return this.history.generation == (e || this.cleanGeneration);
    },
    getHistory: function () {
      return {
        done: Bi(this.history.done),
        undone: Bi(this.history.undone)
      };
    },
    setHistory: function (e) {
      var t = this.history = new Di(this.history.maxGeneration);
      t.done = Bi(e.done.slice(0), null, true);
      t.undone = Bi(e.undone.slice(0), null, true);
    },
    setGutterMarker: $n(function (e, r, n) {
      return fo(this, e, "gutter", function (e) {
        var t = e.gutterMarkers || (e.gutterMarkers = {});
        if (!(t[r] = n) && re(t)) {
          e.gutterMarkers = null;
        }
        return true;
      });
    }),
    clearGutter: $n(function (t) {
      var r = this;
      this.iter(function (e) {
        if (e.gutterMarkers && e.gutterMarkers[t]) {
          fo(r, e, "gutter", function () {
            e.gutterMarkers[t] = null;
            if (re(e.gutterMarkers)) {
              e.gutterMarkers = null;
            }
            return true;
          });
        }
      });
    }),
    lineInfo: function (e) {
      var t;
      if ("number" == typeof e) {
        if (!(e >= this.first && e < this.first + this.size)) {
          return null;
        }
        if (!(e = ae(this, t = e))) {
          return null;
        }
      } else if (null == (t = fe(e))) {
        return null;
      }
      return {
        line: t,
        handle: e,
        text: e.text,
        gutterMarkers: e.gutterMarkers,
        textClass: e.textClass,
        bgClass: e.bgClass,
        wrapClass: e.wrapClass,
        widgets: e.widgets
      };
    },
    addLineClass: $n(function (e, r, n) {
      return fo(this, e, "gutter" == r ? "gutter" : "class", function (e) {
        var t = "text" == r ? "textClass" : "background" == r ? "bgClass" : "gutter" == r ? "gutterClass" : "wrapClass";
        if (e[t]) {
          if (new RegExp("(^|\\s)" + n + "(?:$|\\s)\\s*").test(e[t])) {
            return false;
          }
          e[t] += " " + n;
        } else {
          e[t] = n;
        }
        return true;
      });
    }),
    removeLineClass: $n(function (e, o, l) {
      return fo(this, e, "gutter" == o ? "gutter" : "class", function (e) {
        var t = "text" == o ? "textClass" : "background" == o ? "bgClass" : "gutter" == o ? "gutterClass" : "wrapClass";
        var r = e[t];
        if (!r) {
          return false;
        }
        if (null == l) {
          e[t] = null;
        } else {
          var n = r.match(new RegExp("(^|\\s)" + l + "(?:$|\\s)\\s*"));
          if (!n) {
            return false;
          }
          var i = n.index + n[0].length;
          e[t] = r.slice(0, n.index) + (n.index && i != r.length ? " " : "") + r.slice(i) || null;
        }
        return true;
      });
    }),
    addLineWidget: $n(function (e, t, r) {
      o = new vo(n = this, t, r);
      if ((l = n.cm) && o.noHScroll) {
        l.display.alignWidgets = true;
      }
      fo(n, e, "widget", function (e) {
        var t = e.widgets || (e.widgets = []);
        if (null == o.insertAt) {
          t.push(o);
        } else {
          t.splice(Math.min(t.length - 1, Math.max(0, o.insertAt)), 0, o);
        }
        o.line = e;
        if (l && !je(n, e)) {
          var r = Ye(e) < n.scrollTop;
          he(e, e.height + br(o));
          if (r) {
            Ln(l, o.height);
          }
          l.curOp.forceUpdate = true;
        }
        return true;
      });
      if (l) {
        sr(l, "lineWidgetAdded", l, o, "number" == typeof e ? e : fe(e));
      }
      return o;
      var n;
      var o;
      var l;
    }),
    removeLineWidget: function (e) {
      e.clear();
    },
    markText: function (e, t, r) {
      return wo(this, Se(this, e), Se(this, t), r, r && r.type || "range");
    },
    setBookmark: function (e, t) {
      var r = {
        replacedWith: t && (null == t.nodeType ? t.widget : t),
        insertLeft: t && t.insertLeft,
        clearWhenEmpty: false,
        shared: t && t.shared,
        handleMouseEvents: t && t.handleMouseEvents
      };
      return wo(this, e = Se(this, e), e, r, "bookmark");
    },
    findMarksAt: function (e) {
      var t = [];
      var r = ae(this, (e = Se(this, e)).line).markedSpans;
      if (r) {
        for (var n = 0; n < r.length; ++n) {
          var i = r[n];
          if ((null == i.from || i.from <= e.ch) && (null == i.to || i.to >= e.ch)) {
            t.push(i.marker.parent || i.marker);
          }
        }
      }
      return t;
    },
    findMarks: function (i, o, l) {
      i = Se(this, i);
      o = Se(this, o);
      var s = [];
      var a = i.line;
      this.iter(i.line, o.line + 1, function (e) {
        var t = e.markedSpans;
        if (t) {
          for (var r = 0; r < t.length; r++) {
            var n = t[r];
            if (!(null != n.to && a == i.line && i.ch >= n.to || null == n.from && a != i.line || null != n.from && a == o.line && n.from >= o.ch || l && !l(n.marker))) {
              s.push(n.marker.parent || n.marker);
            }
          }
        }
        ++a;
      });
      return s;
    },
    getAllMarks: function () {
      var n = [];
      this.iter(function (e) {
        var t = e.markedSpans;
        if (t) {
          for (var r = 0; r < t.length; ++r) {
            if (null != t[r].from) {
              n.push(t[r].marker);
            }
          }
        }
      });
      return n;
    },
    posFromIndex: function (r) {
      var n;
      var i = this.first;
      var o = this.lineSeparator().length;
      this.iter(function (e) {
        var t = e.text.length + o;
        if (r < t) {
          n = r;
          return true;
        }
        r -= t;
        ++i;
      });
      return Se(this, ve(i, n));
    },
    indexFromPos: function (e) {
      var t = (e = Se(this, e)).ch;
      if (e.line < this.first || e.ch < 0) {
        return 0;
      }
      var r = this.lineSeparator().length;
      this.iter(this.first, e.line, function (e) {
        t += e.text.length + r;
      });
      return t;
    },
    copy: function (e) {
      var t = new ko(ce(this, this.first, this.first + this.size), this.modeOption, this.first, this.lineSep, this.direction);
      t.scrollTop = this.scrollTop;
      t.scrollLeft = this.scrollLeft;
      t.sel = this.sel;
      t.extend = false;
      if (e) {
        t.history.undoDepth = this.history.undoDepth;
        t.setHistory(this.getHistory());
      }
      return t;
    },
    linkedDoc: function (e) {
      if (!e) {
        e = {};
      }
      var t = this.first;
      var r = this.first + this.size;
      if (null != e.from && e.from > t) {
        t = e.from;
      }
      if (null != e.to && e.to < r) {
        r = e.to;
      }
      var n = new ko(ce(this, t, r), e.mode || this.modeOption, t, this.lineSep, this.direction);
      if (e.sharedHist) {
        n.history = this.history;
      }
      (this.linked || (this.linked = [])).push({
        doc: n,
        sharedHist: e.sharedHist
      });
      n.linked = [{
        doc: this,
        isParent: true,
        sharedHist: e.sharedHist
      }];
      (function (e, t) {
        for (var r = 0; r < t.length; r++) {
          var n = t[r];
          var i = n.find();
          var o = e.clipPos(i.from);
          var l = e.clipPos(i.to);
          if (o.line - l.line || o.ch - l.ch) {
            var s = wo(e, o, l, n.primary, n.primary.type);
            n.markers.push(s);
            s.parent = n;
          }
        }
      })(n, Co(this));
      return n;
    },
    unlinkDoc: function (e) {
      if (e instanceof Cl) {
        e = e.doc;
      }
      if (this.linked) {
        for (var t = 0; t < this.linked.length; ++t) {
          if (this.linked[t].doc == e) {
            this.linked.splice(t, 1);
            e.unlinkDoc(this);
            So(Co(this));
            break;
          }
        }
      }
      if (e.history == this.history) {
        var r = [e.id];
        Ni(e, function (e) {
          return r.push(e.id);
        }, true);
        e.history = new Di(null);
        e.history.done = Bi(this.history.done, r);
        e.history.undone = Bi(this.history.undone, r);
      }
    },
    iterLinkedDocs: function (e) {
      Ni(this, e);
    },
    getMode: function () {
      return this.mode;
    },
    getEditor: function () {
      return this.cm;
    },
    splitLines: function (e) {
      return this.lineSep ? e.split(this.lineSep) : xt(e);
    },
    lineSeparator: function () {
      return this.lineSep || "\n";
    },
    setDirection: $n(function (e) {
      var t;
      if ("rtl" != e) {
        e = "ltr";
      }
      if (e != this.direction) {
        this.direction = e;
        this.iter(function (e) {
          return e.order = null;
        });
        if (this.cm) {
          Xn(t = this.cm, function () {
            Ai(t);
            qn(t);
          });
        }
      }
    })
  });
  ko.prototype.eachLine = ko.prototype.iter;
  var To = 0;
  function Mo(e) {
    var i = this;
    No(i);
    if (!ot(i, e) && !wr(i.display, e)) {
      ut(e);
      if (x) {
        To = +new Date();
      }
      var o = ln(i, e, true);
      var t = e.dataTransfer.files;
      if (o && !i.isReadOnly()) {
        if (t && t.length && window.FileReader && window.File) {
          var l = t.length;
          var s = Array(l);
          var a = 0;
          var r = function (e, r) {
            if (!i.options.allowDropFileTypes || -1 != B(i.options.allowDropFileTypes, e.type)) {
              var n = new FileReader();
              n.onload = Yn(i, function () {
                var e = n.result;
                if (/[\x00-\x08\x0e-\x1f]{2}/.test(e)) {
                  e = "";
                }
                s[r] = e;
                if (++a == l) {
                  var t = {
                    from: o = Se(i.doc, o),
                    to: o,
                    text: i.doc.splitLines(s.join(i.doc.lineSeparator())),
                    origin: "paste"
                  };
                  no(i.doc, t);
                  Xi(i.doc, new vi([new mi(o, (t.text ? ve(t.from.line + t.text.length - 1, t.text[t.text.length - 1].length + (1 == t.text.length ? t.from.ch : 0)) : t.to) || o)], 0));
                }
              });
              n.readAsText(e);
            }
          };
          for (var n = 0; n < l; ++n) {
            r(t[n], n);
          }
        } else {
          if (i.state.draggingText && -1 < i.doc.sel.contains(o)) {
            i.state.draggingText(e);
            return void setTimeout(function () {
              return i.display.input.focus();
            }, 20);
          }
          try {
            var u = e.dataTransfer.getData("Text");
            if (u) {
              var c;
              if (i.state.draggingText && !i.state.draggingText.copy) {
                c = i.listSelections();
              }
              _i(i.doc, new vi([new mi(o, o || o)], 0));
              if (c) {
                for (var h = 0; h < c.length; ++h) {
                  ao(i.doc, "", c[h].anchor, c[h].head, "drag");
                }
              }
              i.replaceSelection(u, "around", "paste");
              i.display.input.focus();
            }
          } catch (e) {}
        }
      }
    }
  }
  function No(e) {
    if (e.display.dragCursor) {
      e.display.lineSpace.removeChild(e.display.dragCursor);
      e.display.dragCursor = null;
    }
  }
  function Oo(t) {
    if (document.getElementsByClassName) {
      var e = document.getElementsByClassName("CodeMirror");
      var r = [];
      for (var n = 0; n < e.length; n++) {
        var i = e[n].CodeMirror;
        if (i) {
          r.push(i);
        }
      }
      if (r.length) {
        r[0].operation(function () {
          for (var e = 0; e < r.length; e++) {
            t(r[e]);
          }
        });
      }
    }
  }
  var Ao = false;
  function Do() {
    var e;
    if (!Ao) {
      tt(window, "resize", function () {
        if (null == e) {
          e = setTimeout(function () {
            e = null;
            Oo(Wo);
          }, 100);
        }
      });
      tt(window, "blur", function () {
        return Oo(mn);
      });
      Ao = true;
    }
  }
  function Wo(e) {
    var t = e.display;
    t.cachedCharWidth = t.cachedTextHeight = t.cachedPaddingH = null;
    t.scrollbarsClipped = false;
    e.setSize();
  }
  var Ho = {
    3: "Pause",
    8: "Backspace",
    9: "Tab",
    13: "Enter",
    16: "Shift",
    17: "Ctrl",
    18: "Alt",
    19: "Pause",
    20: "CapsLock",
    27: "Esc",
    32: "Space",
    33: "PageUp",
    34: "PageDown",
    35: "End",
    36: "Home",
    37: "Left",
    38: "Up",
    39: "Right",
    40: "Down",
    44: "PrintScrn",
    45: "Insert",
    46: "Delete",
    59: ";",
    61: "=",
    91: "Mod",
    92: "Mod",
    93: "Mod",
    106: "*",
    107: "=",
    109: "-",
    110: ".",
    111: "/",
    127: "Delete",
    145: "ScrollLock",
    173: "-",
    186: ";",
    187: "=",
    188: ",",
    189: "-",
    190: ".",
    191: "/",
    192: "`",
    219: "[",
    220: "\\",
    221: "]",
    222: "'",
    63232: "Up",
    63233: "Down",
    63234: "Left",
    63235: "Right",
    63272: "Delete",
    63273: "Home",
    63275: "End",
    63276: "PageUp",
    63277: "PageDown",
    63302: "Insert"
  };
  for (var Fo = 0; Fo < 10; Fo++) {
    Ho[Fo + 48] = Ho[Fo + 96] = String(Fo);
  }
  for (var Po = 65; Po <= 90; Po++) {
    Ho[Po] = String.fromCharCode(Po);
  }
  for (var Eo = 1; Eo <= 12; Eo++) {
    Ho[Eo + 111] = Ho[Eo + 63235] = "F" + Eo;
  }
  var Io = {};
  function zo(e) {
    var t;
    var r;
    var n;
    var i;
    var o = e.split(/-(?!$)/);
    e = o[o.length - 1];
    for (var l = 0; l < o.length - 1; l++) {
      var s = o[l];
      if (/^(cmd|meta|m)$/i.test(s)) {
        i = true;
      } else if (/^a(lt)?$/i.test(s)) {
        t = true;
      } else if (/^(c|ctrl|control)$/i.test(s)) {
        r = true;
      } else {
        if (!/^s(hift)?$/i.test(s)) {
          throw new Error("Unrecognized modifier name: " + s);
        }
        n = true;
      }
    }
    if (t) {
      e = "Alt-" + e;
    }
    if (r) {
      e = "Ctrl-" + e;
    }
    if (i) {
      e = "Cmd-" + e;
    }
    if (n) {
      e = "Shift-" + e;
    }
    return e;
  }
  function Ro(e) {
    var t = {};
    for (var r in e) if (e.hasOwnProperty(r)) {
      var n = e[r];
      if (/^(name|fallthrough|(de|at)tach)$/.test(r)) {
        continue;
      }
      if ("..." == n) {
        delete e[r];
        continue;
      }
      var i = q(r.split(" "), zo);
      for (var o = 0; o < i.length; o++) {
        var l = undefined;
        var s = undefined;
        l = o == i.length - 1 ? (s = i.join(" "), n) : (s = i.slice(0, o + 1).join(" "), "...");
        var a = t[s];
        if (a) {
          if (a != l) {
            throw new Error("Inconsistent bindings for " + s);
          }
        } else {
          t[s] = l;
        }
      }
      delete e[r];
    }
    for (var u in t) e[u] = t[u];
    return e;
  }
  function Bo(e, t, r, n) {
    var i = (t = "string" == typeof t ? Io[e] : t).call ? t.call(e, n) : t[e];
    if (false === i) {
      return "nothing";
    }
    if ("..." === i) {
      return "multi";
    }
    if (null != i && r(i)) {
      return "handled";
    }
    if (t.fallthrough) {
      if ("[object Array]" != Object.prototype.toString.call(t.fallthrough)) {
        return Bo(e, t.fallthrough, r, n);
      }
      for (var o = 0; o < t.fallthrough.length; o++) {
        var l = Bo(e, t.fallthrough[o], r, n);
        if (l) {
          return l;
        }
      }
    }
  }
  function Go(e) {
    var t = "string" == typeof e ? e : Ho[e.keyCode];
    return "Ctrl" == t || "Alt" == t || "Shift" == t || "Mod" == t;
  }
  function Uo(e, t, r) {
    var n = e;
    if (t.altKey && "Alt" != n) {
      e = "Alt-" + e;
    }
    if ((y ? t.metaKey : t.ctrlKey) && "Ctrl" != n) {
      e = "Ctrl-" + e;
    }
    if ((y ? t.ctrlKey : t.metaKey) && "Cmd" != n) {
      e = "Cmd-" + e;
    }
    if (!r && t.shiftKey && "Shift" != n) {
      e = "Shift-" + e;
    }
    return e;
  }
  function Vo(e, t) {
    if (v && 34 == e.keyCode && e.char) {
      return false;
    }
    var r = Ho[e.keyCode];
    return null != r && !e.altGraphKey && (3 == e.keyCode && e.code && (r = e.code), Uo(r, e, t));
  }
  function jo(t, e) {
    var r = t.doc.sel.ranges;
    var n = [];
    for (var i = 0; i < r.length; i++) {
      for (var o = e(r[i]); n.length && (o.from.line - n[n.length - 1].to.line || o.from.ch - n[n.length - 1].to.ch) <= 0;) {
        var l = n.pop();
        if ((l.from.line - o.from.line || l.from.ch - o.from.ch) < 0) {
          o.from = l.from;
          break;
        }
      }
      n.push(o);
    }
    Xn(t, function () {
      for (var e = n.length - 1; 0 <= e; e--) {
        ao(t.doc, "", n[e].from, n[e].to, "+delete");
      }
      kn(t);
    });
  }
  function Xo(e, t, r) {
    var n = oe(e.text, t + r, r);
    return n < 0 || n > e.text.length ? null : n;
  }
  function Yo(e, t, r) {
    var n = Xo(e, t.ch, r);
    return null == n ? null : new ve(t.line, n, r < 0 ? "after" : "before");
  }
  function _o(e, t, r, n, i) {
    if (e) {
      var o = Je(r, t.doc.direction);
      if (o) {
        var l;
        var s = i < 0 ? o[o.length - 1] : o[0];
        var a = i < 0 == (1 == s.level) ? "after" : "before";
        if (0 < s.level || "rtl" == t.doc.direction) {
          var u = Ar(t, r);
          l = i < 0 ? r.text.length - 1 : 0;
          var c = Dr(t, u, l).top;
          l = le(function (e) {
            return Dr(t, u, e).top == c;
          }, i < 0 == (1 == s.level) ? s.from : s.to - 1, l);
          if ("before" == a) {
            l = Xo(r, l, 1);
          }
        } else {
          l = i < 0 ? s.to : s.from;
        }
        return new ve(n, l, a);
      }
    }
    return new ve(n, i < 0 ? r.text.length : 0, i < 0 ? "before" : "after");
  }
  Io.basic = {
    Left: "goCharLeft",
    Right: "goCharRight",
    Up: "goLineUp",
    Down: "goLineDown",
    End: "goLineEnd",
    Home: "goLineStartSmart",
    PageUp: "goPageUp",
    PageDown: "goPageDown",
    Delete: "delCharAfter",
    Backspace: "delCharBefore",
    "Shift-Backspace": "delCharBefore",
    Tab: "defaultTab",
    "Shift-Tab": "indentAuto",
    Enter: "newlineAndIndent",
    Insert: "toggleOverwrite",
    Esc: "singleSelection"
  };
  Io.pcDefault = {
    "Ctrl-A": "selectAll",
    "Ctrl-D": "deleteLine",
    "Ctrl-Z": "undo",
    "Shift-Ctrl-Z": "redo",
    "Ctrl-Y": "redo",
    "Ctrl-Home": "goDocStart",
    "Ctrl-End": "goDocEnd",
    "Ctrl-Up": "goLineUp",
    "Ctrl-Down": "goLineDown",
    "Ctrl-Left": "goGroupLeft",
    "Ctrl-Right": "goGroupRight",
    "Alt-Left": "goLineStart",
    "Alt-Right": "goLineEnd",
    "Ctrl-Backspace": "delGroupBefore",
    "Ctrl-Delete": "delGroupAfter",
    "Ctrl-S": "save",
    "Ctrl-F": "find",
    "Ctrl-G": "findNext",
    "Shift-Ctrl-G": "findPrev",
    "Shift-Ctrl-F": "replace",
    "Shift-Ctrl-R": "replaceAll",
    "Ctrl-[": "indentLess",
    "Ctrl-]": "indentMore",
    "Ctrl-U": "undoSelection",
    "Shift-Ctrl-U": "redoSelection",
    "Alt-U": "redoSelection",
    fallthrough: "basic"
  };
  Io.emacsy = {
    "Ctrl-F": "goCharRight",
    "Ctrl-B": "goCharLeft",
    "Ctrl-P": "goLineUp",
    "Ctrl-N": "goLineDown",
    "Alt-F": "goWordRight",
    "Alt-B": "goWordLeft",
    "Ctrl-A": "goLineStart",
    "Ctrl-E": "goLineEnd",
    "Ctrl-V": "goPageDown",
    "Shift-Ctrl-V": "goPageUp",
    "Ctrl-D": "delCharAfter",
    "Ctrl-H": "delCharBefore",
    "Alt-D": "delWordAfter",
    "Alt-Backspace": "delWordBefore",
    "Ctrl-K": "killLine",
    "Ctrl-T": "transposeChars",
    "Ctrl-O": "openLine"
  };
  Io.macDefault = {
    "Cmd-A": "selectAll",
    "Cmd-D": "deleteLine",
    "Cmd-Z": "undo",
    "Shift-Cmd-Z": "redo",
    "Cmd-Y": "redo",
    "Cmd-Home": "goDocStart",
    "Cmd-Up": "goDocStart",
    "Cmd-End": "goDocEnd",
    "Cmd-Down": "goDocEnd",
    "Alt-Left": "goGroupLeft",
    "Alt-Right": "goGroupRight",
    "Cmd-Left": "goLineLeft",
    "Cmd-Right": "goLineRight",
    "Alt-Backspace": "delGroupBefore",
    "Ctrl-Alt-Backspace": "delGroupAfter",
    "Alt-Delete": "delGroupAfter",
    "Cmd-S": "save",
    "Cmd-F": "find",
    "Cmd-G": "findNext",
    "Shift-Cmd-G": "findPrev",
    "Cmd-Alt-F": "replace",
    "Shift-Cmd-Alt-F": "replaceAll",
    "Cmd-[": "indentLess",
    "Cmd-]": "indentMore",
    "Cmd-Backspace": "delWrappedLineLeft",
    "Cmd-Delete": "delWrappedLineRight",
    "Cmd-U": "undoSelection",
    "Shift-Cmd-U": "redoSelection",
    "Ctrl-Up": "goDocStart",
    "Ctrl-Down": "goDocEnd",
    fallthrough: ["basic", "emacsy"]
  };
  Io.default = w ? Io.macDefault : Io.pcDefault;
  var $o = {
    selectAll: to,
    singleSelection: function (e) {
      return e.setSelection(e.getCursor("anchor"), e.getCursor("head"), V);
    },
    killLine: function (r) {
      return jo(r, function (e) {
        if (e.empty()) {
          var t = ae(r.doc, e.head.line).text.length;
          return e.head.ch == t && e.head.line < r.lastLine() ? {
            from: e.head,
            to: ve(e.head.line + 1, 0)
          } : {
            from: e.head,
            to: ve(e.head.line, t)
          };
        }
        return {
          from: e.from(),
          to: e.to()
        };
      });
    },
    deleteLine: function (t) {
      return jo(t, function (e) {
        return {
          from: ve(e.from().line, 0),
          to: Se(t.doc, ve(e.to().line + 1, 0))
        };
      });
    },
    delLineLeft: function (e) {
      return jo(e, function (e) {
        return {
          from: ve(e.from().line, 0),
          to: e.from()
        };
      });
    },
    delWrappedLineLeft: function (r) {
      return jo(r, function (e) {
        var t = r.charCoords(e.head, "div").top + 5;
        return {
          from: r.coordsChar({
            left: 0,
            top: t
          }, "div"),
          to: e.from()
        };
      });
    },
    delWrappedLineRight: function (n) {
      return jo(n, function (e) {
        var t = n.charCoords(e.head, "div").top + 5;
        var r = n.coordsChar({
          left: n.display.lineDiv.offsetWidth + 100,
          top: t
        }, "div");
        return {
          from: e.from(),
          to: r
        };
      });
    },
    undo: function (e) {
      return e.undo();
    },
    redo: function (e) {
      return e.redo();
    },
    undoSelection: function (e) {
      return e.undoSelection();
    },
    redoSelection: function (e) {
      return e.redoSelection();
    },
    goDocStart: function (e) {
      return e.extendSelection(ve(e.firstLine(), 0));
    },
    goDocEnd: function (e) {
      return e.extendSelection(ve(e.lastLine()));
    },
    goLineStart: function (t) {
      return t.extendSelectionsBy(function (e) {
        return qo(t, e.head.line);
      }, {
        origin: "+move",
        bias: 1
      });
    },
    goLineStartSmart: function (t) {
      return t.extendSelectionsBy(function (e) {
        return Zo(t, e.head);
      }, {
        origin: "+move",
        bias: 1
      });
    },
    goLineEnd: function (t) {
      return t.extendSelectionsBy(function (e) {
        return function (e, t) {
          var r = ae(e.doc, t);
          var n = function (e) {
            for (var t; t = Ie(e, false);) {
              e = t.find(1, true).line;
            }
            return e;
          }(r);
          if (n != r) {
            t = fe(n);
          }
          return _o(true, e, r, t, -1);
        }(t, e.head.line);
      }, {
        origin: "+move",
        bias: -1
      });
    },
    goLineRight: function (r) {
      return r.extendSelectionsBy(function (e) {
        var t = r.cursorCoords(e.head, "div").top + 5;
        return r.coordsChar({
          left: r.display.lineDiv.offsetWidth + 100,
          top: t
        }, "div");
      }, j);
    },
    goLineLeft: function (r) {
      return r.extendSelectionsBy(function (e) {
        var t = r.cursorCoords(e.head, "div").top + 5;
        return r.coordsChar({
          left: 0,
          top: t
        }, "div");
      }, j);
    },
    goLineLeftSmart: function (n) {
      return n.extendSelectionsBy(function (e) {
        var t = n.cursorCoords(e.head, "div").top + 5;
        var r = n.coordsChar({
          left: 0,
          top: t
        }, "div");
        return r.ch < n.getLine(r.line).search(/\S/) ? Zo(n, e.head) : r;
      }, j);
    },
    goLineUp: function (e) {
      return e.moveV(-1, "line");
    },
    goLineDown: function (e) {
      return e.moveV(1, "line");
    },
    goPageUp: function (e) {
      return e.moveV(-1, "page");
    },
    goPageDown: function (e) {
      return e.moveV(1, "page");
    },
    goCharLeft: function (e) {
      return e.moveH(-1, "char");
    },
    goCharRight: function (e) {
      return e.moveH(1, "char");
    },
    goColumnLeft: function (e) {
      return e.moveH(-1, "column");
    },
    goColumnRight: function (e) {
      return e.moveH(1, "column");
    },
    goWordLeft: function (e) {
      return e.moveH(-1, "word");
    },
    goGroupRight: function (e) {
      return e.moveH(1, "group");
    },
    goGroupLeft: function (e) {
      return e.moveH(-1, "group");
    },
    goWordRight: function (e) {
      return e.moveH(1, "word");
    },
    delCharBefore: function (e) {
      return e.deleteH(-1, "char");
    },
    delCharAfter: function (e) {
      return e.deleteH(1, "char");
    },
    delWordBefore: function (e) {
      return e.deleteH(-1, "word");
    },
    delWordAfter: function (e) {
      return e.deleteH(1, "word");
    },
    delGroupBefore: function (e) {
      return e.deleteH(-1, "group");
    },
    delGroupAfter: function (e) {
      return e.deleteH(1, "group");
    },
    indentAuto: function (e) {
      return e.indentSelection("smart");
    },
    indentMore: function (e) {
      return e.indentSelection("add");
    },
    indentLess: function (e) {
      return e.indentSelection("subtract");
    },
    insertTab: function (e) {
      return e.replaceSelection("\t");
    },
    insertSoftTab: function (e) {
      var t = [];
      var r = e.listSelections();
      var n = e.options.tabSize;
      for (var i = 0; i < r.length; i++) {
        var o = r[i].from();
        var l = z(e.getLine(o.line), o.ch, n);
        t.push(_(n - l % n));
      }
      e.replaceSelections(t);
    },
    defaultTab: function (e) {
      if (e.somethingSelected()) {
        e.indentSelection("add");
      } else {
        e.execCommand("insertTab");
      }
    },
    transposeChars: function (l) {
      return Xn(l, function () {
        var e = l.listSelections();
        var t = [];
        for (var r = 0; r < e.length; r++) {
          if (e[r].empty()) {
            var n = e[r].head;
            var i = ae(l.doc, n.line).text;
            if (i) {
              if (n.ch == i.length) {
                n = new ve(n.line, n.ch - 1);
              }
              if (0 < n.ch) {
                n = new ve(n.line, n.ch + 1);
                l.replaceRange(i.charAt(n.ch - 1) + i.charAt(n.ch - 2), ve(n.line, n.ch - 2), n, "+transpose");
              } else if (n.line > l.doc.first) {
                var o = ae(l.doc, n.line - 1).text;
                if (o) {
                  n = new ve(n.line, 1);
                  l.replaceRange(i.charAt(0) + l.doc.lineSeparator() + o.charAt(o.length - 1), ve(n.line - 1, o.length - 1), n, "+transpose");
                }
              }
            }
            t.push(new mi(n, n));
          }
        }
        l.setSelections(t);
      });
    },
    newlineAndIndent: function (n) {
      return Xn(n, function () {
        var e = n.listSelections();
        for (var t = e.length - 1; 0 <= t; t--) {
          n.replaceRange(n.doc.lineSeparator(), e[t].anchor, e[t].head, "+input");
        }
        e = n.listSelections();
        for (var r = 0; r < e.length; r++) {
          n.indentLine(e[r].from().line, null, true);
        }
        kn(n);
      });
    },
    openLine: function (e) {
      return e.replaceSelection("\n", "start");
    },
    toggleOverwrite: function (e) {
      return e.toggleOverwrite();
    }
  };
  function qo(e, t) {
    var r = ae(e.doc, t);
    var n = Ue(r);
    if (n != r) {
      t = fe(n);
    }
    return _o(true, e, n, t, 1);
  }
  function Zo(e, t) {
    var r = qo(e, t.line);
    var n = ae(e.doc, r.line);
    var i = Je(n, e.doc.direction);
    if (i && 0 != i[0].level) {
      return r;
    }
    var o = Math.max(0, n.text.search(/\S/));
    var l = t.line == r.line && t.ch <= o && t.ch;
    return ve(r.line, l ? 0 : o, r.sticky);
  }
  function Qo(e, t, r) {
    if ("string" == typeof t && !(t = $o[t])) {
      return false;
    }
    e.display.input.ensurePolled();
    var n = e.display.shift;
    var i = false;
    try {
      if (e.isReadOnly()) {
        e.state.suppressEdits = true;
      }
      if (r) {
        e.display.shift = false;
      }
      i = t(e) != U;
    } finally {
      e.display.shift = n;
      e.state.suppressEdits = false;
    }
    return i;
  }
  var Jo = new R();
  function el(e, t, r, n) {
    var i = e.state.keySeq;
    if (i) {
      if (Go(t)) {
        return "handled";
      }
      if (/\'$/.test(t)) {
        e.state.keySeq = null;
      } else {
        Jo.set(50, function () {
          if (e.state.keySeq == i) {
            e.state.keySeq = null;
            e.display.input.reset();
          }
        });
      }
      if (tl(e, i + " " + t, r, n)) {
        return true;
      }
    }
    return tl(e, t, r, n);
  }
  function tl(e, t, r, n) {
    var i = function (e, t, r) {
      for (var n = 0; n < e.state.keyMaps.length; n++) {
        var i = Bo(t, e.state.keyMaps[n], r, e);
        if (i) {
          return i;
        }
      }
      return e.options.extraKeys && Bo(t, e.options.extraKeys, r, e) || Bo(t, e.options.keyMap, r, e);
    }(e, t, n);
    if ("multi" == i) {
      e.state.keySeq = t;
    }
    if ("handled" == i) {
      sr(e, "keyHandled", e, t, r);
    }
    if (!("handled" != i && "multi" != i)) {
      ut(r);
      dn(e);
    }
    return !!i;
  }
  function rl(t, e) {
    var r = Vo(e, true);
    return !!r && (e.shiftKey && !t.state.keySeq ? el(t, "Shift-" + r, e, function (e) {
      return Qo(t, e, true);
    }) || el(t, r, e, function (e) {
      if ("string" == typeof e ? /^go[A-Z]/.test(e) : e.motion) {
        return Qo(t, e);
      }
    }) : el(t, r, e, function (e) {
      return Qo(t, e);
    }));
  }
  var nl = null;
  function il(e) {
    var t = this;
    t.curOp.focus = W();
    if (!ot(t, e)) {
      if (x && C < 11 && 27 == e.keyCode) {
        e.returnValue = false;
      }
      var r = e.keyCode;
      t.display.shift = 16 == r || e.shiftKey;
      var n = rl(t, e);
      if (v) {
        nl = n ? r : null;
        if (!n && 88 == r && !St && (w ? e.metaKey : e.ctrlKey)) {
          t.replaceSelection("", null, "cut");
        }
      }
      if (!(18 != r || /\bCodeMirror-crosshair\b/.test(t.display.lineDiv.className))) {
        (function (e) {
          var t = e.display.lineDiv;
          function r(e) {
            if (!(18 != e.keyCode && e.altKey)) {
              T(t, "CodeMirror-crosshair");
              nt(document, "keyup", r);
              nt(document, "mouseover", r);
            }
          }
          H(t, "CodeMirror-crosshair");
          tt(document, "keyup", r);
          tt(document, "mouseover", r);
        })(t);
      }
    }
  }
  function ol(e) {
    if (16 == e.keyCode) {
      this.doc.sel.shift = false;
    }
    ot(this, e);
  }
  function ll(e) {
    var t = this;
    if (!(wr(t.display, e) || ot(t, e) || e.ctrlKey && !e.altKey || w && e.metaKey)) {
      var r = e.keyCode;
      var n = e.charCode;
      if (v && r == nl) {
        nl = null;
        return void ut(e);
      }
      if (!v || e.which && !(e.which < 10) || !rl(t, e)) {
        var i;
        var o = String.fromCharCode(null == n ? r : n);
        if ("\b" != o) {
          if (!el(i = t, "'" + o + "'", e, function (e) {
            return Qo(i, e, true);
          })) {
            t.display.input.onKeyPress(e);
          }
        }
      }
    }
  }
  var sl;
  var al;
  var ul = function (e, t, r) {
    this.time = e;
    this.pos = t;
    this.button = r;
  };
  function cl(e) {
    var t = this;
    var r = t.display;
    if (!(ot(t, e) || r.activeTouch && r.input.supportsTouch())) {
      r.input.ensurePolled();
      r.shift = e.shiftKey;
      if (wr(r, e)) {
        if (!b) {
          r.scroller.draggable = false;
          setTimeout(function () {
            return r.scroller.draggable = true;
          }, 100);
        }
      } else if (!fl(t, e, "gutterClick", true)) {
        var n;
        var i;
        var o;
        var l = ln(t, e);
        var s = pt(e);
        var a = l ? (n = l, i = s, o = +new Date(), al && al.compare(o, n, i) ? (sl = al = null, "triple") : sl && sl.compare(o, n, i) ? (al = new ul(o, n, i), sl = null, "double") : (sl = new ul(o, n, i), al = null, "single")) : "single";
        window.focus();
        if (1 == s && t.state.selectingText) {
          t.state.selectingText(e);
        }
        if (!(l && function (r, e, n, t, i) {
          var o = "Click";
          if ("double" == t) {
            o = "Double" + o;
          } else if ("triple" == t) {
            o = "Triple" + o;
          }
          return el(r, Uo(o = (1 == e ? "Left" : 2 == e ? "Middle" : "Right") + o, i), i, function (e) {
            if ("string" == typeof e) {
              e = $o[e];
            }
            if (!e) {
              return false;
            }
            var t = false;
            try {
              if (r.isReadOnly()) {
                r.state.suppressEdits = true;
              }
              t = e(r, n) != U;
            } finally {
              r.state.suppressEdits = false;
            }
            return t;
          });
        }(t, s, l, a, e))) {
          if (1 == s) {
            if (l) {
              (function (e, t, r, n) {
                if (x) {
                  setTimeout(E(pn, e), 0);
                } else {
                  e.curOp.focus = W();
                }
                var i;
                var o = function (e, t, r) {
                  var n = e.getOption("configureMouse");
                  var i = n ? n(e, t, r) : {};
                  if (null == i.unit) {
                    var o = d ? r.shiftKey && r.metaKey : r.altKey;
                    i.unit = o ? "rectangle" : "single" == t ? "char" : "double" == t ? "word" : "line";
                  }
                  if (null == i.extend || e.doc.extend) {
                    i.extend = e.doc.extend || r.shiftKey;
                  }
                  if (null == i.addNew) {
                    i.addNew = w ? r.metaKey : r.ctrlKey;
                  }
                  if (null == i.moveOnDrag) {
                    i.moveOnDrag = !(w ? r.altKey : r.ctrlKey);
                  }
                  return i;
                }(e, r, n);
                var l = e.doc.sel;
                if (e.options.dragDrop && mt && !e.isReadOnly() && "single" == r && -1 < (i = l.contains(t)) && (((i = l.ranges[i]).from().line - t.line || (i = l.ranges[i]).from().ch - t.ch) < 0 || 0 < t.xRel) && (0 < (i.to().line - t.line || i.to().ch - t.ch) || t.xRel < 0)) {
                  (function (t, r, n, i) {
                    var o = t.display;
                    var l = false;
                    var s = Yn(t, function (e) {
                      if (b) {
                        o.scroller.draggable = false;
                      }
                      t.state.draggingText = false;
                      nt(o.wrapper.ownerDocument, "mouseup", s);
                      nt(o.wrapper.ownerDocument, "mousemove", a);
                      nt(o.scroller, "dragstart", u);
                      nt(o.scroller, "drop", s);
                      if (!l) {
                        ut(e);
                        if (!i.addNew) {
                          Ui(t.doc, n, null, null, i.extend);
                        }
                        if (b || x && 9 == C) {
                          setTimeout(function () {
                            o.wrapper.ownerDocument.body.focus();
                            o.input.focus();
                          }, 20);
                        } else {
                          o.input.focus();
                        }
                      }
                    });
                    var a = function (e) {
                      l = l || 10 <= Math.abs(r.clientX - e.clientX) + Math.abs(r.clientY - e.clientY);
                    };
                    var u = function () {
                      return l = true;
                    };
                    if (b) {
                      o.scroller.draggable = true;
                    }
                    (t.state.draggingText = s).copy = !i.moveOnDrag;
                    if (o.scroller.dragDrop) {
                      o.scroller.dragDrop();
                    }
                    tt(o.wrapper.ownerDocument, "mouseup", s);
                    tt(o.wrapper.ownerDocument, "mousemove", a);
                    tt(o.scroller, "dragstart", u);
                    tt(o.scroller, "drop", s);
                    gn(t);
                    setTimeout(function () {
                      return o.input.focus();
                    }, 20);
                  })(e, n, t, o);
                } else {
                  (function (v, e, m, y) {
                    var l = v.display;
                    var b = v.doc;
                    ut(e);
                    var w;
                    var x;
                    var C = b.sel;
                    var t = C.ranges;
                    if (y.addNew && !y.extend) {
                      x = b.sel.contains(m);
                      w = -1 < x ? t[x] : new mi(m, m);
                    } else {
                      w = b.sel.primary();
                      x = b.sel.primIndex;
                    }
                    if ("rectangle" == y.unit) {
                      if (!y.addNew) {
                        w = new mi(m, m);
                      }
                      m = ln(v, e, true, true);
                      x = -1;
                    } else {
                      var r = hl(v, m, y.unit);
                      w = y.extend ? Gi(w, r.anchor, r.head, y.extend) : r;
                    }
                    if (y.addNew) {
                      if (-1 == x) {
                        x = t.length;
                        Yi(b, yi(v, t.concat([w]), x), {
                          scroll: false,
                          origin: "*mouse"
                        });
                      } else if (1 < t.length && t[x].empty() && "char" == y.unit && !y.extend) {
                        Yi(b, yi(v, t.slice(0, x).concat(t.slice(x + 1)), 0), {
                          scroll: false,
                          origin: "*mouse"
                        });
                        C = b.sel;
                      } else {
                        Ki(b, x, w, K);
                      }
                    } else {
                      Yi(b, new vi([w], x = 0), K);
                      C = b.sel;
                    }
                    var S = m;
                    function s(e) {
                      if (0 != (S.line - e.line || S.ch - e.ch)) {
                        S = e;
                        if ("rectangle" == y.unit) {
                          var t = [];
                          var r = v.options.tabSize;
                          var n = z(ae(b, m.line).text, m.ch, r);
                          var i = z(ae(b, e.line).text, e.ch, r);
                          var o = Math.min(n, i);
                          var l = Math.max(n, i);
                          var s = Math.min(m.line, e.line);
                          for (var a = Math.min(v.lastLine(), Math.max(m.line, e.line)); s <= a; s++) {
                            var u = ae(b, s).text;
                            var c = X(u, o, r);
                            if (o == l) {
                              t.push(new mi(ve(s, c), ve(s, c)));
                            } else if (u.length > c) {
                              t.push(new mi(ve(s, c), ve(s, X(u, l, r))));
                            }
                          }
                          if (!t.length) {
                            t.push(new mi(m, m));
                          }
                          Yi(b, yi(v, C.ranges.slice(0, x).concat(t), x), {
                            origin: "*mouse",
                            scroll: false
                          });
                          v.scrollIntoView(e);
                        } else {
                          var h;
                          var f = w;
                          var d = hl(v, e, y.unit);
                          var p = f.anchor;
                          p = 0 < (d.anchor.line - p.line || d.anchor.ch - p.ch) ? (h = d.head, (f.from().line - d.anchor.line || f.from().ch - d.anchor.ch) < 0 ? f.from() : d.anchor) : (h = d.anchor, (f.to().line - d.head.line || f.to().ch - d.head.ch) < 0 ? d.head : f.to());
                          var g = C.ranges.slice(0);
                          g[x] = function (e, t) {
                            var r = t.anchor;
                            var n = t.head;
                            var i = ae(e.doc, r.line);
                            if (0 == (r.line - n.line || r.ch - n.ch) && r.sticky == n.sticky) {
                              return t;
                            }
                            var o = Je(i);
                            if (!o) {
                              return t;
                            }
                            var l = Ze(o, r.ch, r.sticky);
                            var s = o[l];
                            if (s.from != r.ch && s.to != r.ch) {
                              return t;
                            }
                            var a;
                            var u = l + (s.from == r.ch == (1 != s.level) ? 0 : 1);
                            if (0 == u || u == o.length) {
                              return t;
                            }
                            if (n.line != r.line) {
                              a = 0 < (n.line - r.line) * ("ltr" == e.doc.direction ? 1 : -1);
                            } else {
                              var c = Ze(o, n.ch, n.sticky);
                              var h = c - l || (n.ch - r.ch) * (1 == s.level ? -1 : 1);
                              a = c == u - 1 || c == u ? h < 0 : 0 < h;
                            }
                            var f = o[u + (a ? -1 : 0)];
                            var d = a == (1 == f.level);
                            var p = d ? f.from : f.to;
                            var g = d ? "after" : "before";
                            return r.ch == p && r.sticky == g ? t : new mi(new ve(r.line, p, g), n);
                          }(v, new mi(Se(b, p), h));
                          Yi(b, yi(v, g, x), K);
                        }
                      }
                    }
                    var a = l.wrapper.getBoundingClientRect();
                    var u = 0;
                    function n(e) {
                      v.state.selectingText = false;
                      u = Infinity;
                      ut(e);
                      l.input.focus();
                      nt(l.wrapper.ownerDocument, "mousemove", i);
                      nt(l.wrapper.ownerDocument, "mouseup", o);
                      b.history.lastSelOrigin = null;
                    }
                    var i = Yn(v, function (e) {
                      if (0 !== e.buttons && pt(e)) {
                        (function e(t) {
                          var r = ++u;
                          var n = ln(v, t, true, "rectangle" == y.unit);
                          if (!n) {
                            return;
                          }
                          if (0 != (n.line - S.line || n.ch - S.ch)) {
                            v.curOp.focus = W();
                            s(n);
                            var i = wn(l, b);
                            if (n.line >= i.to || n.line < i.from) {
                              setTimeout(Yn(v, function () {
                                if (u == r) {
                                  e(t);
                                }
                              }), 150);
                            }
                          } else {
                            var o = t.clientY < a.top ? -20 : t.clientY > a.bottom ? 20 : 0;
                            if (o) {
                              setTimeout(Yn(v, function () {
                                if (u == r) {
                                  l.scroller.scrollTop += o;
                                  e(t);
                                }
                              }), 50);
                            }
                          }
                        })(e);
                      } else {
                        n(e);
                      }
                    });
                    var o = Yn(v, n);
                    v.state.selectingText = o;
                    tt(l.wrapper.ownerDocument, "mousemove", i);
                    tt(l.wrapper.ownerDocument, "mouseup", o);
                  })(e, n, t, o);
                }
              })(t, l, a, e);
            } else if ((e.target || e.srcElement) == r.scroller) {
              ut(e);
            }
          } else if (2 == s) {
            if (l) {
              Ui(t.doc, l);
            }
            setTimeout(function () {
              return r.input.focus();
            }, 20);
          } else if (3 == s) {
            if (S) {
              t.display.input.onContextMenu(e);
            } else {
              gn(t);
            }
          }
        }
      }
    }
  }
  function hl(e, t, r) {
    if ("char" == r) {
      return new mi(t, t);
    }
    if ("word" == r) {
      return e.findWordAt(t);
    }
    if ("line" == r) {
      return new mi(ve(t.line, 0), Se(e.doc, ve(t.line + 1, 0)));
    }
    var n = r(e, t);
    return new mi(n.from, n.to);
  }
  function fl(e, t, r, n) {
    var i;
    var o;
    if (t.touches) {
      i = t.touches[0].clientX;
      o = t.touches[0].clientY;
    } else {
      try {
        i = t.clientX;
        o = t.clientY;
      } catch (t) {
        return false;
      }
    }
    if (i >= Math.floor(e.display.gutters.getBoundingClientRect().right)) {
      return false;
    }
    if (n) {
      ut(t);
    }
    var l = e.display;
    var s = l.lineDiv.getBoundingClientRect();
    if (o > s.bottom || !(0 < (e._handlers && e._handlers[t] || et).length)) {
      return null != t.defaultPrevented ? t.defaultPrevented : 0 == t.returnValue;
    }
    o -= s.top - l.viewOffset;
    for (var a = 0; a < e.options.gutters.length; ++a) {
      var u = l.gutters.childNodes[a];
      if (u && u.getBoundingClientRect().right >= i) {
        it(e, r, e, de(e.doc, o), e.options.gutters[a], t);
        return null != t.defaultPrevented ? t.defaultPrevented : 0 == t.returnValue;
      }
    }
  }
  function pl(e, t) {
    var r;
    var n;
    if (!(wr(e.display, t) || (n = t, 0 < ((r = e)._handlers && (r = e)._handlers[t] || et).length && fl(r, n, "gutterContextMenu", false)))) {
      if (!(ot(e, t, "contextmenu") || S)) {
        e.display.input.onContextMenu(t);
      }
    }
  }
  function gl(e) {
    e.display.wrapper.className = e.display.wrapper.className.replace(/\s*cm-s-\S+/g, "") + e.options.theme.replace(/(^|\s)\s*/g, " cm-s-");
    zr(e);
  }
  ul.prototype.compare = function (e, t, r) {
    return this.time + 400 > e && 0 == (t.line - this.pos.line || t.ch - this.pos.ch) && r == this.button;
  };
  var vl = {
    toString: function () {
      return "CodeMirror.Init";
    }
  };
  var ml = {};
  var yl = {};
  function bl(e) {
    ui(e);
    qn(e);
    xn(e);
  }
  function wl(e, t, r) {
    if (!t != !(r && r != vl)) {
      var n = e.display.dragFunctions;
      var i = t ? tt : nt;
      i(e.display.scroller, "dragstart", n.start);
      i(e.display.scroller, "dragenter", n.enter);
      i(e.display.scroller, "dragover", n.over);
      i(e.display.scroller, "dragleave", n.leave);
      i(e.display.scroller, "drop", n.drop);
    }
  }
  function xl(e) {
    if (e.options.lineWrapping) {
      H(e.display.wrapper, "CodeMirror-wrap");
      e.display.sizer.style.minWidth = "";
      e.display.sizerWidth = null;
    } else {
      T(e.display.wrapper, "CodeMirror-wrap");
      $e(e);
    }
    on(e);
    qn(e);
    zr(e);
    setTimeout(function () {
      return Pn(e);
    }, 100);
  }
  function Cl(e, t) {
    var r = this;
    if (!(this instanceof Cl)) {
      return new Cl(e, t);
    }
    this.options = t = t ? I(t) : {};
    I(ml, t, false);
    ci(t);
    var n = t.value;
    if ("string" == typeof n) {
      n = new ko(n, t.mode, null, t.lineSeparator, t.direction);
    } else if (t.mode) {
      n.modeOption = t.mode;
    }
    this.doc = n;
    var i = new Cl.inputStyles[t.inputStyle](this);
    var o = this.display = new se(e, n, i);
    ui(o.wrapper.CodeMirror = this);
    gl(this);
    if (t.lineWrapping) {
      this.display.wrapper.className += " CodeMirror-wrap";
    }
    zn(this);
    this.state = {
      keyMaps: [],
      overlays: [],
      modeGen: 0,
      overwrite: false,
      delayingBlurEvent: false,
      focused: false,
      suppressEdits: false,
      pasteIncoming: -1,
      cutIncoming: -1,
      selectingText: false,
      draggingText: false,
      highlight: new R(),
      keySeq: null,
      specialChars: null
    };
    if (t.autofocus && !f) {
      o.input.focus();
    }
    if (x && C < 11) {
      setTimeout(function () {
        return r.display.input.reset(true);
      }, 20);
    }
    (function (i) {
      var o = i.display;
      tt(o.scroller, "mousedown", Yn(i, cl));
      tt(o.scroller, "dblclick", x && C < 11 ? Yn(i, function (e) {
        if (!ot(i, e)) {
          var t = ln(i, e);
          if (t && !fl(i, e, "gutterClick", true) && !wr(i.display, e)) {
            ut(e);
            var r = i.findWordAt(t);
            Ui(i.doc, r.anchor, r.head);
          }
        }
      }) : function (e) {
        return ot(i, e) || ut(e);
      });
      tt(o.scroller, "contextmenu", function (e) {
        return pl(i, e);
      });
      var r;
      var n = {
        end: 0
      };
      function l() {
        if (o.activeTouch) {
          r = setTimeout(function () {
            return o.activeTouch = null;
          }, 1e3);
          (n = o.activeTouch).end = +new Date();
        }
      }
      function s(e, t) {
        if (null == t.left) {
          return true;
        }
        var r = t.left - e.left;
        var n = t.top - e.top;
        return 400 < r * r + n * n;
      }
      tt(o.scroller, "touchstart", function (e) {
        if (!ot(i, e) && !function (e) {
          if (1 != e.touches.length) {
            return false;
          }
          var t = e.touches[0];
          return t.radiusX <= 1 && t.radiusY <= 1;
        }(e) && !fl(i, e, "gutterClick", true)) {
          o.input.ensurePolled();
          clearTimeout(r);
          var t = +new Date();
          o.activeTouch = {
            start: t,
            moved: false,
            prev: t - n.end <= 300 ? n : null
          };
          if (1 == e.touches.length) {
            o.activeTouch.left = e.touches[0].pageX;
            o.activeTouch.top = e.touches[0].pageY;
          }
        }
      });
      tt(o.scroller, "touchmove", function () {
        if (o.activeTouch) {
          o.activeTouch.moved = true;
        }
      });
      tt(o.scroller, "touchend", function (e) {
        var t = o.activeTouch;
        if (t && !wr(o, e) && null != t.left && !t.moved && new Date() - t.start < 300) {
          var r;
          var n = i.coordsChar(o.activeTouch, "page");
          r = !t.prev || s(t, t.prev) ? new mi(n, n) : !t.prev.prev || s(t, t.prev.prev) ? i.findWordAt(n) : new mi(ve(n.line, 0), Se(i.doc, ve(n.line + 1, 0)));
          i.setSelection(r.anchor, r.head);
          i.focus();
          ut(e);
        }
        l();
      });
      tt(o.scroller, "touchcancel", l);
      tt(o.scroller, "scroll", function () {
        if (o.scroller.clientHeight) {
          On(i, o.scroller.scrollTop);
          Dn(i, o.scroller.scrollLeft, true);
          it(i, "scroll", i);
        }
      });
      tt(o.scroller, "mousewheel", function (e) {
        return gi(i, e);
      });
      tt(o.scroller, "DOMMouseScroll", function (e) {
        return gi(i, e);
      });
      tt(o.wrapper, "scroll", function () {
        return o.wrapper.scrollTop = o.wrapper.scrollLeft = 0;
      });
      o.dragFunctions = {
        enter: function (e) {
          if (!ot(i, e)) {
            ft(e);
          }
        },
        over: function (e) {
          if (!ot(i, e)) {
            !function (e, t) {
              var r = ln(e, t);
              if (r) {
                var n = document.createDocumentFragment();
                cn(e, r, n);
                if (!e.display.dragCursor) {
                  e.display.dragCursor = A("div", null, "CodeMirror-cursors CodeMirror-dragcursors");
                  e.display.lineSpace.insertBefore(e.display.dragCursor, e.display.cursorDiv);
                }
                M(e.display.dragCursor).appendChild(n);
              }
            }(i, e);
            ft(e);
          }
        },
        start: function (e) {
          return function (e, t) {
            if (x && (!e.state.draggingText || +new Date() - To < 100)) {
              ft(t);
            } else if (!ot(e, t) && !wr(e.display, t) && (t.dataTransfer.setData("Text", e.getSelection()), t.dataTransfer.effectAllowed = "copyMove", t.dataTransfer.setDragImage && !a)) {
              var r = A("img", null, null, "position: fixed; left: 0; top: 0;");
              r.src = "data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==";
              if (v) {
                r.width = r.height = 1;
                e.display.wrapper.appendChild(r);
                r._top = r.offsetTop;
              }
              t.dataTransfer.setDragImage(r, 0, 0);
              if (v) {
                r.parentNode.removeChild(r);
              }
            }
          }(i, e);
        },
        drop: Yn(i, Mo),
        leave: function (e) {
          if (!ot(i, e)) {
            No(i);
          }
        }
      };
      var e = o.input.getField();
      tt(e, "keyup", function (e) {
        return ol.call(i, e);
      });
      tt(e, "keydown", Yn(i, il));
      tt(e, "keypress", Yn(i, ll));
      tt(e, "focus", function (e) {
        return vn(i, e);
      });
      tt(e, "blur", function (e) {
        return mn(i, e);
      });
    })(this);
    Do();
    Bn(this);
    this.curOp.forceUpdate = true;
    Oi(this, n);
    if (t.autofocus && !f || this.hasFocus()) {
      setTimeout(E(vn, this), 20);
    } else {
      mn(this);
    }
    for (var l in yl) if (yl.hasOwnProperty(l)) {
      yl[l](r, t[l], vl);
    }
    Cn(this);
    if (t.finishInit) {
      t.finishInit(this);
    }
    for (var s = 0; s < Sl.length; ++s) {
      Sl[s](r);
    }
    Gn(this);
    if (b && t.lineWrapping && "optimizelegibility" == getComputedStyle(o.lineDiv).textRendering) {
      o.lineDiv.style.textRendering = "auto";
    }
  }
  Cl.defaults = ml;
  Cl.optionHandlers = yl;
  var Sl = [];
  function Ll(e, t, r, n) {
    var i;
    var o = e.doc;
    if (null == r) {
      r = "add";
    }
    if ("smart" == r) {
      if (o.mode.indent) {
        i = Rt(e, t).state;
      } else {
        r = "prev";
      }
    }
    var l = e.options.tabSize;
    var s = ae(o, t);
    var a = z(s.text, null, l);
    if (s.stateAfter) {
      s.stateAfter = null;
    }
    var u;
    var c = s.text.match(/^\s*/)[0];
    if (n || /\S/.test(s.text)) {
      if ("smart" == r && ((u = o.mode.indent(i, s.text.slice(c.length), s.text)) == U || 150 < u)) {
        if (!n) {
          return;
        }
        r = "prev";
      }
    } else {
      u = 0;
      r = "not";
    }
    if ("prev" == r) {
      u = t > o.first ? z(ae(o, t - 1).text, null, l) : 0;
    } else if ("add" == r) {
      u = a + e.options.indentUnit;
    } else if ("subtract" == r) {
      u = a - e.options.indentUnit;
    } else if ("number" == typeof r) {
      u = a + r;
    }
    u = Math.max(0, u);
    var h = "";
    var f = 0;
    if (e.options.indentWithTabs) {
      for (var d = Math.floor(u / l); d; --d) {
        f += l;
        h += "\t";
      }
    }
    if (f < u) {
      h += _(u - f);
    }
    if (h != c) {
      ao(o, h, ve(t, 0), ve(t, c.length), "+input");
      return !(s.stateAfter = null);
    }
    for (var p = 0; p < o.sel.ranges.length; p++) {
      var g = o.sel.ranges[p];
      if (g.head.line == t && g.head.ch < c.length) {
        var v = ve(t, c.length);
        Ki(o, p, new mi(v, v));
        break;
      }
    }
  }
  Cl.defineInitHook = function (e) {
    return Sl.push(e);
  };
  var kl = null;
  function Tl(e) {
    kl = e;
  }
  function Ml(e, t, r, n, i) {
    var o = e.doc;
    e.display.shift = false;
    if (!n) {
      n = o.sel;
    }
    var l = +new Date() - 200;
    var s = "paste" == i || e.state.pasteIncoming > l;
    var a = xt(t);
    var u = null;
    if (s && 1 < n.ranges.length) {
      if (kl && kl.text.join("\n") == t) {
        if (n.ranges.length % kl.text.length == 0) {
          u = [];
          for (var c = 0; c < kl.text.length; c++) {
            u.push(o.splitLines(kl.text[c]));
          }
        }
      } else if (a.length == n.ranges.length && e.options.pasteLinesPerSelection) {
        u = q(a, function (e) {
          return [e];
        });
      }
    }
    var h = e.curOp.updateInput;
    for (var f = n.ranges.length - 1; 0 <= f; f--) {
      var d = n.ranges[f];
      var p = d.from();
      var g = d.to();
      if (d.empty()) {
        if (r && 0 < r) {
          p = ve(p.line, p.ch - r);
        } else if (e.state.overwrite && !s) {
          g = ve(g.line, Math.min(ae(o, g.line).text.length, g.ch + a[a.length - 1].length));
        } else if (s && kl && kl.lineWise && kl.text.join("\n") == t) {
          p = g = ve(p.line, 0);
        }
      }
      var v = {
        from: p,
        to: g,
        text: u ? u[f % u.length] : a,
        origin: i || (s ? "paste" : e.state.cutIncoming > l ? "cut" : "+input")
      };
      no(e.doc, v);
      sr(e, "inputRead", e, v);
    }
    if (t && !s) {
      Ol(e, t);
    }
    kn(e);
    if (e.curOp.updateInput < 2) {
      e.curOp.updateInput = h;
    }
    e.curOp.typing = true;
    e.state.pasteIncoming = e.state.cutIncoming = -1;
  }
  function Nl(e, t) {
    var r = e.clipboardData && e.clipboardData.getData("Text");
    if (r) {
      e.preventDefault();
      if (!(t.isReadOnly() || t.options.disableInput)) {
        Xn(t, function () {
          return Ml(t, r, 0, null, "paste");
        });
      }
      return true;
    }
  }
  function Ol(e, t) {
    if (e.options.electricChars && e.options.smartIndent) {
      var r = e.doc.sel;
      for (var n = r.ranges.length - 1; 0 <= n; n--) {
        var i = r.ranges[n];
        if (!(100 < i.head.ch || n && r.ranges[n - 1].head.line == i.head.line)) {
          var o = e.getModeAt(i.head);
          var l = false;
          if (o.electricChars) {
            for (var s = 0; s < o.electricChars.length; s++) {
              if (-1 < t.indexOf(o.electricChars.charAt(s))) {
                l = Ll(e, i.head.line, "smart");
                break;
              }
            }
          } else if (o.electricInput && o.electricInput.test(ae(e.doc, i.head.line).text.slice(0, i.head.ch))) {
            l = Ll(e, i.head.line, "smart");
          }
          if (l) {
            sr(e, "electricInput", e, i.head.line);
          }
        }
      }
    }
  }
  function Al(e) {
    var t = [];
    var r = [];
    for (var n = 0; n < e.doc.sel.ranges.length; n++) {
      var i = e.doc.sel.ranges[n].head.line;
      var o = {
        anchor: ve(i, 0),
        head: ve(i + 1, 0)
      };
      r.push(o);
      t.push(e.getRange(o.anchor, o.head));
    }
    return {
      text: t,
      ranges: r
    };
  }
  function Dl(e, t, r, n) {
    e.setAttribute("autocorrect", !!r);
    e.setAttribute("autocapitalize", !!n);
    e.setAttribute("spellcheck", !!t);
  }
  function Wl() {
    var e = A("textarea", null, null, "position: absolute; bottom: -1em; padding: 0; width: 1px; height: 1em; outline: none");
    var t = A("div", [e], null, "overflow: hidden; position: relative; width: 3px; height: 0px;");
    if (b) {
      e.style.width = "1000px";
    } else {
      e.setAttribute("wrap", "off");
    }
    if (c) {
      e.style.border = "1px solid black";
    }
    Dl(e);
    return t;
  }
  function Hl(n, i, o, e, l) {
    var t = i;
    var r = o;
    var s = ae(n, i.line);
    function a(e) {
      var t;
      var r;
      if (null == (t = l ? function (t, r, s, e) {
        var a = Je(r, t.doc.direction);
        if (!a) {
          return Yo(r, s, e);
        }
        if (s.ch >= r.text.length) {
          s.ch = r.text.length;
          s.sticky = "before";
        } else if (s.ch <= 0) {
          s.ch = 0;
          s.sticky = "after";
        }
        var n = Ze(a, s.ch, s.sticky);
        var i = a[n];
        if ("ltr" == t.doc.direction && i.level % 2 == 0 && (0 < e ? i.to > s.ch : i.from < s.ch)) {
          return Yo(r, s, e);
        }
        var o;
        var l = function (e) {
          return t.options.lineWrapping ? (o = o || Ar(t, r), qr(t, r, o, e)) : {
            begin: 0,
            end: r.text.length
          };
        };
        var c = l("before" == s.sticky ? Xo(r, s instanceof ve ? s.ch : s, -1) : s.ch);
        if ("rtl" == t.doc.direction || 1 == i.level) {
          var h = 1 == i.level == e < 0;
          var f = Xo(r, s instanceof ve ? s.ch : s, h ? 1 : -1);
          if (null != f && (h ? f <= i.to && f <= c.end : f >= i.from && f >= c.begin)) {
            var d = h ? "before" : "after";
            return new ve(s.line, f, d);
          }
        }
        var p = function (e, t, r) {
          for (; 0 <= e && e < a.length; e += t) {
            var i = a[e];
            var o = 0 < t == (1 != i.level);
            var l = o ? r.begin : Xo(r, r.end instanceof ve ? r.end.ch : r.end, -1);
            if (i.from <= l && l < i.to) {
              return o ? new ve(s.line, Xo(r, l instanceof ve ? l.ch : l, 1), "before") : new ve(s.line, l, "after");
            }
            l = o ? i.from : Xo(r, i.to instanceof ve ? i.to.ch : i.to, -1);
            if (r.begin <= l && l < r.end) {
              return o ? new ve(s.line, Xo(r, l instanceof ve ? l.ch : l, 1), "before") : new ve(s.line, l, "after");
            }
          }
        };
        var g = p(n + e, e, c);
        if (g) {
          return g;
        }
        var v = 0 < e ? c.end : Xo(r, c.begin instanceof ve ? c.begin.ch : c.begin, -1);
        return null == v || 0 < e && v == r.text.length || !(g = p(0 < e ? 0 : a.length - 1, e, l(v))) ? null : g;
      }(n.cm, s, i, o) : Yo(s, i, o))) {
        if (e || (r = i.line + o) < n.first || r >= n.first + n.size || (i = new ve(r, i.ch, i.sticky), !(s = ae(n, r)))) {
          return false;
        }
        i = _o(l, n.cm, s, i.line, o);
      } else {
        i = t;
      }
      return true;
    }
    if ("char" == e) {
      a();
    } else if ("column" == e) {
      a(true);
    } else if ("word" == e || "group" == e) {
      var u = null;
      var c = "group" == e;
      var h = n.cm && n.cm.getHelper(i, "wordChars");
      for (var f = true; !(o < 0) || a(!f); f = false) {
        var d = s.text.charAt(i.ch) || "\n";
        var p = (h ? !!(-1 < h.source.indexOf("\\w") && (/\w/.test(d) || "" < d && (d.toUpperCase() != d.toLowerCase() || J.test(d)))) || h.test(d) : /\w/.test(d) || "" < d && (d.toUpperCase() != d.toLowerCase() || J.test(d))) ? "w" : c && "\n" == d ? "n" : !c || /\s/.test(d) ? null : "p";
        if (!(!c || f || p)) {
          p = "s";
        }
        if (u && u != p) {
          if (o < 0) {
            o = 1;
            a();
            i.sticky = "after";
          }
          break;
        }
        if (p) {
          u = p;
        }
        if (0 < o && !a(!f)) {
          break;
        }
      }
    }
    var g = Ji(n, i, t, r, true);
    if (t.sticky == g.sticky && 0 == (t.line - g.line || t.ch - g.ch)) {
      g.hitSide = true;
    }
    return g;
  }
  function Fl(e, t, r, n) {
    var i;
    var o;
    var l = e.doc;
    var s = t.left;
    if ("page" == n) {
      var a = Math.min(e.display.wrapper.clientHeight, window.innerHeight || document.documentElement.clientHeight);
      var u = Math.max(a - .5 * Jr(e.display), 3);
      i = (0 < r ? t.bottom : t.top) + r * u;
    } else if ("line" == n) {
      i = 0 < r ? t.bottom + 3 : t.top - 3;
    }
    for (; (o = _r(e, s, i)).outside;) {
      if (r < 0 ? i <= 0 : i >= l.height) {
        o.hitSide = true;
        break;
      }
      i += 5 * r;
    }
    return o;
  }
  var Pl = function (e) {
    this.cm = e;
    this.lastAnchorNode = this.lastAnchorOffset = this.lastFocusNode = this.lastFocusOffset = null;
    this.polling = new R();
    this.composing = null;
    this.gracePeriod = false;
    this.readDOMTimeout = null;
  };
  function El(e, t) {
    var r = Or(e, t.line);
    if (!r || r.hidden) {
      return null;
    }
    var n = ae(e.doc, t.line);
    var i = Mr(r, n, t.line);
    var o = Je(n, e.doc.direction);
    var l = "left";
    if (o) {
      l = Ze(o, t.ch) % 2 ? "right" : "left";
    }
    var s = Fr(i.map, t.ch, l);
    s.offset = "right" == s.collapse ? s.end : s.start;
    return s;
  }
  function Il(e, t) {
    if (t) {
      e.bad = true;
    }
    return e;
  }
  function zl(e, t, r) {
    var n;
    if (t == e.display.lineDiv) {
      if (!(n = e.display.lineDiv.childNodes[r])) {
        return Il(e.clipPos(ve(e.display.viewTo - 1)), true);
      }
      t = null;
      r = 0;
    } else {
      for (n = t;; n = n.parentNode) {
        if (!n || n == e.display.lineDiv) {
          return null;
        }
        if (n.parentNode && n.parentNode == e.display.lineDiv) {
          break;
        }
      }
    }
    for (var i = 0; i < e.display.view.length; i++) {
      var o = e.display.view[i];
      if (o.node == n) {
        return Rl(o, t, r);
      }
    }
  }
  function Rl(u, e, t) {
    var r = u.text.firstChild;
    var n = false;
    if (!e || !D(r, e)) {
      return Il(ve(fe(u.line), 0), true);
    }
    if (e == r && (n = true, e = r.childNodes[t], t = 0, !e)) {
      var i = u.rest ? u.rest[u.rest.length - 1] : u.line;
      return Il(ve(fe(i), i.text.length), n);
    }
    var o = 3 == e.nodeType ? e : null;
    var l = e;
    for (o || 1 != e.childNodes.length || 3 != e.firstChild.nodeType || (o = e.firstChild, t && (t = o.nodeValue.length)); l.parentNode != r;) {
      l = l.parentNode;
    }
    var c = u.measure;
    var h = c.maps;
    function s(e, t, r) {
      for (var n = -1; n < (h ? h.length : 0); n++) {
        var i = n < 0 ? c.map : h[n];
        for (var o = 0; o < i.length; o += 3) {
          var l = i[o + 2];
          if (l == e || l == t) {
            var s = fe(n < 0 ? u.line : u.rest[n]);
            var a = i[o] + r;
            if (r < 0 || l != e) {
              a = i[o + (r ? 1 : 0)];
            }
            return ve(s, a);
          }
        }
      }
    }
    var a = s(o, l, t);
    if (a) {
      return Il(a, n);
    }
    var f = l.nextSibling;
    for (var d = o ? o.nodeValue.length - t : 0; f; f = f.nextSibling) {
      if (a = s(f, f.firstChild, 0)) {
        return Il(ve(a.line, a.ch - d), n);
      }
      d += f.textContent.length;
    }
    var p = l.previousSibling;
    for (var g = t; p; p = p.previousSibling) {
      if (a = s(p, p.firstChild, -1)) {
        return Il(ve(a.line, a.ch + g), n);
      }
      g += p.textContent.length;
    }
  }
  Pl.prototype.init = function (e) {
    var t = this;
    var l = this;
    var s = l.cm;
    var a = l.div = e.lineDiv;
    function r(e) {
      if (!ot(s, e)) {
        if (s.somethingSelected()) {
          Tl({
            lineWise: false,
            text: s.getSelections()
          });
          if ("cut" == e.type) {
            s.replaceSelection("", null, "cut");
          }
        } else {
          if (!s.options.lineWiseCopyCut) {
            return;
          }
          var t = Al(s);
          Tl({
            lineWise: true,
            text: t.text
          });
          if ("cut" == e.type) {
            s.operation(function () {
              s.setSelections(t.ranges, 0, V);
              s.replaceSelection("", null, "cut");
            });
          }
        }
        if (e.clipboardData) {
          e.clipboardData.clearData();
          var r = kl.text.join("\n");
          e.clipboardData.setData("Text", r);
          if (e.clipboardData.getData("Text") == r) {
            return void e.preventDefault();
          }
        }
        var n = Wl();
        var i = n.firstChild;
        s.display.lineSpace.insertBefore(n, s.display.lineSpace.firstChild);
        i.value = kl.text.join("\n");
        var o = document.activeElement;
        P(i);
        setTimeout(function () {
          s.display.lineSpace.removeChild(n);
          o.focus();
          if (o == a) {
            l.showPrimarySelection();
          }
        }, 50);
      }
    }
    Dl(a, s.options.spellcheck, s.options.autocorrect, s.options.autocapitalize);
    tt(a, "paste", function (e) {
      if (!(ot(s, e) || Nl(e, s))) {
        if (C <= 11) {
          setTimeout(Yn(s, function () {
            return t.updateFromDOM();
          }), 20);
        }
      }
    });
    tt(a, "compositionstart", function (e) {
      t.composing = {
        data: e.data,
        done: false
      };
    });
    tt(a, "compositionupdate", function (e) {
      if (!t.composing) {
        t.composing = {
          data: e.data,
          done: false
        };
      }
    });
    tt(a, "compositionend", function (e) {
      if (t.composing) {
        if (e.data != t.composing.data) {
          t.readFromDOMSoon();
        }
        t.composing.done = true;
      }
    });
    tt(a, "touchstart", function () {
      return l.forceCompositionEnd();
    });
    tt(a, "input", function () {
      if (!t.composing) {
        t.readFromDOMSoon();
      }
    });
    tt(a, "copy", r);
    tt(a, "cut", r);
  };
  Pl.prototype.prepareSelection = function () {
    var e = un(this.cm, false);
    e.focus = this.cm.state.focused;
    return e;
  };
  Pl.prototype.showSelection = function (e, t) {
    if (e && this.cm.display.view.length) {
      if (e.focus || t) {
        this.showPrimarySelection();
      }
      this.showMultipleSelections(e);
    }
  };
  Pl.prototype.getSelection = function () {
    return this.cm.display.wrapper.ownerDocument.getSelection();
  };
  Pl.prototype.showPrimarySelection = function () {
    var e = this.getSelection();
    var t = this.cm;
    var r = t.doc.sel.primary();
    var n = r.from();
    var i = r.to();
    if (t.display.viewTo == t.display.viewFrom || n.line >= t.display.viewTo || i.line < t.display.viewFrom) {
      e.removeAllRanges();
    } else {
      var o = zl(t, e.anchorNode, e.anchorOffset);
      var l = zl(t, e.focusNode, e.focusOffset);
      if (!o || o.bad || !l || l.bad || 0 != (((o.line - l.line || o.ch - l.ch) < 0 ? o : l).line - n.line || ((o.line - l.line || o.ch - l.ch) < 0 ? o : l).ch - n.ch) || 0 != (((o.line - l.line || o.ch - l.ch) < 0 ? l : o).line - i.line || ((o.line - l.line || o.ch - l.ch) < 0 ? l : o).ch - i.ch)) {
        var s = t.display.view;
        var a = n.line >= t.display.viewFrom && El(t, n) || {
          node: s[0].measure.map[2],
          offset: 0
        };
        var u = i.line < t.display.viewTo && El(t, i);
        if (!u) {
          var c = s[s.length - 1].measure;
          var h = c.maps ? c.maps[c.maps.length - 1] : c.map;
          u = {
            node: h[h.length - 1],
            offset: h[h.length - 2] - h[h.length - 3]
          };
        }
        if (a && u) {
          var f;
          var d = e.rangeCount && e.getRangeAt(0);
          try {
            f = k(a.node, a.offset, u.offset, u.node);
          } catch (e) {}
          if (f) {
            if (!g && t.state.focused) {
              e.collapse(a.node, a.offset);
              if (!f.collapsed) {
                e.removeAllRanges();
                e.addRange(f);
              }
            } else {
              e.removeAllRanges();
              e.addRange(f);
            }
            if (d && null == e.anchorNode) {
              e.addRange(d);
            } else if (g) {
              this.startGracePeriod();
            }
          }
          this.rememberSelection();
        } else {
          e.removeAllRanges();
        }
      }
    }
  };
  Pl.prototype.startGracePeriod = function () {
    var e = this;
    clearTimeout(this.gracePeriod);
    this.gracePeriod = setTimeout(function () {
      e.gracePeriod = false;
      if (e.selectionChanged()) {
        e.cm.operation(function () {
          return e.cm.curOp.selectionChanged = true;
        });
      }
    }, 20);
  };
  Pl.prototype.showMultipleSelections = function (e) {
    M(this.cm.display.cursorDiv).appendChild(e.cursors);
    M(this.cm.display.selectionDiv).appendChild(e.selection);
  };
  Pl.prototype.rememberSelection = function () {
    var e = this.getSelection();
    this.lastAnchorNode = e.anchorNode;
    this.lastAnchorOffset = e.anchorOffset;
    this.lastFocusNode = e.focusNode;
    this.lastFocusOffset = e.focusOffset;
  };
  Pl.prototype.selectionInEditor = function () {
    var e = this.getSelection();
    if (!e.rangeCount) {
      return false;
    }
    var t = e.getRangeAt(0).commonAncestorContainer;
    return D(this.div, t);
  };
  Pl.prototype.focus = function () {
    if ("nocursor" != this.cm.options.readOnly) {
      if (!this.selectionInEditor()) {
        this.showSelection(this.prepareSelection(), true);
      }
      this.div.focus();
    }
  };
  Pl.prototype.blur = function () {
    this.div.blur();
  };
  Pl.prototype.getField = function () {
    return this.div;
  };
  Pl.prototype.supportsTouch = function () {
    return true;
  };
  Pl.prototype.receivedFocus = function () {
    var t = this;
    if (this.selectionInEditor()) {
      this.pollSelection();
    } else {
      Xn(this.cm, function () {
        return t.cm.curOp.selectionChanged = true;
      });
    }
    this.polling.set(this.cm.options.pollInterval, function e() {
      if (t.cm.state.focused) {
        t.pollSelection();
        t.polling.set(t.cm.options.pollInterval, e);
      }
    });
  };
  Pl.prototype.selectionChanged = function () {
    var e = this.getSelection();
    return e.anchorNode != this.lastAnchorNode || e.anchorOffset != this.lastAnchorOffset || e.focusNode != this.lastFocusNode || e.focusOffset != this.lastFocusOffset;
  };
  Pl.prototype.pollSelection = function () {
    if (null == this.readDOMTimeout && !this.gracePeriod && this.selectionChanged()) {
      var e = this.getSelection();
      var t = this.cm;
      if (h && l && this.cm.options.gutters.length && function (e) {
        for (var t = e; t; t = t.parentNode) {
          if (/CodeMirror-gutter-wrapper/.test(t.className)) {
            return true;
          }
        }
        return false;
      }(e.anchorNode)) {
        this.cm.triggerOnKeyDown({
          type: "keydown",
          keyCode: 8,
          preventDefault: Math.abs
        });
        this.blur();
        return void this.focus();
      }
      if (!this.composing) {
        this.rememberSelection();
        var r = zl(t, e.anchorNode, e.anchorOffset);
        var n = zl(t, e.focusNode, e.focusOffset);
        if (r && n) {
          Xn(t, function () {
            Yi(t.doc, new vi([new mi(r, n || r)], 0), V);
            if (r.bad || n.bad) {
              t.curOp.selectionChanged = true;
            }
          });
        }
      }
    }
  };
  Pl.prototype.pollContent = function () {
    if (null != this.readDOMTimeout) {
      clearTimeout(this.readDOMTimeout);
      this.readDOMTimeout = null;
    }
    var e;
    var t;
    var r;
    var n = this.cm;
    var i = n.display;
    var o = n.doc.sel.primary();
    var l = o.from();
    var s = o.to();
    if (0 == l.ch && l.line > n.firstLine()) {
      l = ve(l.line - 1, ae(n.doc, l.line - 1).length);
    }
    if (s.ch == ae(n.doc, s.line).text.length && s.line < n.lastLine()) {
      s = ve(s.line + 1, 0);
    }
    if (l.line < i.viewFrom || s.line > i.viewTo - 1) {
      return false;
    }
    r = l.line == i.viewFrom || 0 == (e = sn(n, l.line)) ? (t = fe(i.view[0].line), i.view[0].node) : (t = fe(i.view[e].line), i.view[e - 1].node.nextSibling);
    var a;
    var u;
    var c = sn(n, s.line);
    u = c == i.view.length - 1 ? (a = i.viewTo - 1, i.lineDiv.lastChild) : (a = fe(i.view[c + 1].line) - 1, i.view[c + 1].node.previousSibling);
    if (!r) {
      return false;
    }
    var h = n.doc.splitLines(function (a, e, t, u, c) {
      var r = "";
      var h = false;
      var f = a.doc.lineSeparator();
      var d = false;
      function p() {
        if (h) {
          r += f;
          if (d) {
            r += f;
          }
          h = d = false;
        }
      }
      function g(e) {
        if (e) {
          p();
          r += e;
        }
      }
      function v(e) {
        if (1 == e.nodeType) {
          var t = e.getAttribute("cm-text");
          if (t) {
            return void g(t);
          }
          var r;
          var n = e.getAttribute("cm-marker");
          if (n) {
            s = +n;
            var i = a.findMarks(ve(u, 0), ve(c + 1, 0), function (e) {
              return e.id == s;
            });
            return void (i.length && (r = i[0].find(0)) && g(ue(a.doc, r.from, r.to).join(f)));
          }
          if ("false" == e.getAttribute("contenteditable")) {
            return;
          }
          var o = /^(pre|div|p|li|table|br)$/i.test(e.nodeName);
          if (!/^br$/i.test(e.nodeName) && 0 == e.textContent.length) {
            return;
          }
          if (o) {
            p();
          }
          for (var l = 0; l < e.childNodes.length; l++) {
            v(e.childNodes[l]);
          }
          if (/^(pre|p)$/i.test(e.nodeName)) {
            d = true;
          }
          if (o) {
            h = true;
          }
        } else if (3 == e.nodeType) {
          g(e.nodeValue.replace(/\u200b/g, "").replace(/\u00a0/g, " "));
        }
        var s;
      }
      for (; v(e), e != t;) {
        e = e.nextSibling;
        d = false;
      }
      return r;
    }(n, r, u, t, a));
    for (var f = ue(n.doc, ve(t, 0), ve(a, ae(n.doc, a).text.length)); 1 < h.length && 1 < f.length;) {
      if (h[h.length - 1] == f[f.length - 1]) {
        h.pop();
        f.pop();
        a--;
      } else {
        if (h[0] != f[0]) {
          break;
        }
        h.shift();
        f.shift();
        t++;
      }
    }
    var d = 0;
    var p = 0;
    var g = h[0];
    var v = f[0];
    for (var m = Math.min(g.length, v.length); d < m && g.charCodeAt(d) == v.charCodeAt(d);) {
      ++d;
    }
    var y = h[h.length - 1];
    var b = f[f.length - 1];
    for (var w = Math.min(y.length - (1 == h.length ? d : 0), b.length - (1 == f.length ? d : 0)); p < w && y.charCodeAt(y.length - p - 1) == b.charCodeAt(b.length - p - 1);) {
      ++p;
    }
    if (1 == h.length && 1 == f.length && t == l.line) {
      for (; d && d > l.ch && y.charCodeAt(y.length - p - 1) == b.charCodeAt(b.length - p - 1);) {
        d--;
        p++;
      }
    }
    h[h.length - 1] = y.slice(0, y.length - p).replace(/^\u200b+/, "");
    h[0] = h[0].slice(d).replace(/\u200b+$/, "");
    var x = ve(t, d);
    var C = ve(a, f.length ? f[f.length - 1].length - p : 0);
    return 1 < h.length || h[0] || x.line - C.line || x.ch - C.ch ? (ao(n.doc, h, x, C, "+input"), true) : undefined;
  };
  Pl.prototype.ensurePolled = function () {
    this.forceCompositionEnd();
  };
  Pl.prototype.reset = function () {
    this.forceCompositionEnd();
  };
  Pl.prototype.forceCompositionEnd = function () {
    if (this.composing) {
      clearTimeout(this.readDOMTimeout);
      this.composing = null;
      this.updateFromDOM();
      this.div.blur();
      this.div.focus();
    }
  };
  Pl.prototype.readFromDOMSoon = function () {
    var e = this;
    if (null == this.readDOMTimeout) {
      this.readDOMTimeout = setTimeout(function () {
        e.readDOMTimeout = null;
        if (e.composing) {
          if (!e.composing.done) {
            return;
          }
          e.composing = null;
        }
        e.updateFromDOM();
      }, 80);
    }
  };
  Pl.prototype.updateFromDOM = function () {
    var e = this;
    if (!(!this.cm.isReadOnly() && this.pollContent())) {
      Xn(this.cm, function () {
        return qn(e.cm);
      });
    }
  };
  Pl.prototype.setUneditable = function (e) {
    e.contentEditable = "false";
  };
  Pl.prototype.onKeyPress = function (e) {
    if (!(0 == e.charCode || this.composing)) {
      e.preventDefault();
      if (!this.cm.isReadOnly()) {
        Yn(this.cm, Ml)(this.cm, String.fromCharCode(null == e.charCode ? e.keyCode : e.charCode), 0);
      }
    }
  };
  Pl.prototype.readOnlyChanged = function (e) {
    this.div.contentEditable = String("nocursor" != e);
  };
  Pl.prototype.onContextMenu = function () {};
  Pl.prototype.resetPosition = function () {};
  Pl.prototype.needsContentAttribute = true;
  var Gl;
  var Ul;
  var Vl = function (e) {
    this.cm = e;
    this.prevInput = "";
    this.pollingFast = false;
    this.polling = new R();
    this.hasSelection = false;
    this.composing = null;
  };
  Vl.prototype.init = function (r) {
    var e = this;
    var n = this;
    var i = this.cm;
    this.createField(r);
    var o = this.textarea;
    function t(e) {
      if (!ot(i, e)) {
        if (i.somethingSelected()) {
          Tl({
            lineWise: false,
            text: i.getSelections()
          });
        } else {
          if (!i.options.lineWiseCopyCut) {
            return;
          }
          var t = Al(i);
          Tl({
            lineWise: true,
            text: t.text
          });
          if ("cut" == e.type) {
            i.setSelections(t.ranges, null, V);
          } else {
            n.prevInput = "";
            o.value = t.text.join("\n");
            P(o);
          }
        }
        if ("cut" == e.type) {
          i.state.cutIncoming = +new Date();
        }
      }
    }
    r.wrapper.insertBefore(this.wrapper, r.wrapper.firstChild);
    if (c) {
      o.style.width = "0px";
    }
    tt(o, "input", function () {
      if (x && 9 <= C && e.hasSelection) {
        e.hasSelection = null;
      }
      n.poll();
    });
    tt(o, "paste", function (e) {
      if (!(ot(i, e) || Nl(e, i))) {
        i.state.pasteIncoming = +new Date();
        n.fastPoll();
      }
    });
    tt(o, "cut", t);
    tt(o, "copy", t);
    tt(r.scroller, "paste", function (e) {
      if (!wr(r, e) && !ot(i, e)) {
        if (!o.dispatchEvent) {
          i.state.pasteIncoming = +new Date();
          return void n.focus();
        }
        var t = new Event("paste");
        t.clipboardData = e.clipboardData;
        o.dispatchEvent(t);
      }
    });
    tt(r.lineSpace, "selectstart", function (e) {
      if (!wr(r, e)) {
        ut(e);
      }
    });
    tt(o, "compositionstart", function () {
      var e = i.getCursor("from");
      if (n.composing) {
        n.composing.range.clear();
      }
      n.composing = {
        start: e,
        range: i.markText(e, i.getCursor("to"), {
          className: "CodeMirror-composing"
        })
      };
    });
    tt(o, "compositionend", function () {
      if (n.composing) {
        n.poll();
        n.composing.range.clear();
        n.composing = null;
      }
    });
  };
  Vl.prototype.createField = function (e) {
    this.wrapper = Wl();
    this.textarea = this.wrapper.firstChild;
  };
  Vl.prototype.prepareSelection = function () {
    var e = this.cm;
    var t = e.display;
    var r = e.doc;
    var n = un(e);
    if (e.options.moveInputWithCursor) {
      var i = jr(e, r.sel.primary().head, "div");
      var o = t.wrapper.getBoundingClientRect();
      var l = t.lineDiv.getBoundingClientRect();
      n.teTop = Math.max(0, Math.min(t.wrapper.clientHeight - 10, i.top + l.top - o.top));
      n.teLeft = Math.max(0, Math.min(t.wrapper.clientWidth - 10, i.left + l.left - o.left));
    }
    return n;
  };
  Vl.prototype.showSelection = function (e) {
    var t = this.cm.display;
    M(t.cursorDiv).appendChild(e.cursors);
    M(t.selectionDiv).appendChild(e.selection);
    if (null != e.teTop) {
      this.wrapper.style.top = e.teTop + "px";
      this.wrapper.style.left = e.teLeft + "px";
    }
  };
  Vl.prototype.reset = function (e) {
    if (!this.contextMenuPending && !this.composing) {
      var t = this.cm;
      if (t.somethingSelected()) {
        this.prevInput = "";
        var r = t.getSelection();
        this.textarea.value = r;
        if (t.state.focused) {
          P(this.textarea);
        }
        if (x && 9 <= C) {
          this.hasSelection = r;
        }
      } else if (!e) {
        this.prevInput = this.textarea.value = "";
        if (x && 9 <= C) {
          this.hasSelection = null;
        }
      }
    }
  };
  Vl.prototype.getField = function () {
    return this.textarea;
  };
  Vl.prototype.supportsTouch = function () {
    return false;
  };
  Vl.prototype.focus = function () {
    if ("nocursor" != this.cm.options.readOnly && (!f || W() != this.textarea)) {
      try {
        this.textarea.focus();
      } catch (e) {}
    }
  };
  Vl.prototype.blur = function () {
    this.textarea.blur();
  };
  Vl.prototype.resetPosition = function () {
    this.wrapper.style.top = this.wrapper.style.left = 0;
  };
  Vl.prototype.receivedFocus = function () {
    this.slowPoll();
  };
  Vl.prototype.slowPoll = function () {
    var e = this;
    if (!this.pollingFast) {
      this.polling.set(this.cm.options.pollInterval, function () {
        e.poll();
        if (e.cm.state.focused) {
          e.slowPoll();
        }
      });
    }
  };
  Vl.prototype.fastPoll = function () {
    var t = false;
    var r = this;
    r.pollingFast = true;
    r.polling.set(20, function e() {
      if (r.poll() || t) {
        r.pollingFast = false;
        r.slowPoll();
      } else {
        t = true;
        r.polling.set(60, e);
      }
    });
  };
  Vl.prototype.poll = function () {
    var e = this;
    var t = this.cm;
    var r = this.textarea;
    var n = this.prevInput;
    if (this.contextMenuPending || !t.state.focused || Ct(r) && !n && !this.composing || t.isReadOnly() || t.options.disableInput || t.state.keySeq) {
      return false;
    }
    var i = r.value;
    if (i == n && !t.somethingSelected()) {
      return false;
    }
    if (x && 9 <= C && this.hasSelection === i || w && /[\uf700-\uf7ff]/.test(i)) {
      t.display.input.reset();
      return false;
    }
    if (t.doc.sel == t.display.selForContextMenu) {
      var o = i.charCodeAt(0);
      if (!(8203 != o || n)) {
        n = "​";
      }
      if (8666 == o) {
        this.reset();
        return this.cm.execCommand("undo");
      }
    }
    var l = 0;
    for (var s = Math.min(n.length, i.length); l < s && n.charCodeAt(l) == i.charCodeAt(l);) {
      ++l;
    }
    Xn(t, function () {
      Ml(t, i.slice(l), n.length - l, null, e.composing ? "*compose" : null);
      if (1e3 < i.length || -1 < i.indexOf("\n")) {
        r.value = e.prevInput = "";
      } else {
        e.prevInput = i;
      }
      if (e.composing) {
        e.composing.range.clear();
        e.composing.range = t.markText(e.composing.start, t.getCursor("to"), {
          className: "CodeMirror-composing"
        });
      }
    });
    return true;
  };
  Vl.prototype.ensurePolled = function () {
    if (this.pollingFast && this.poll()) {
      this.pollingFast = false;
    }
  };
  Vl.prototype.onKeyPress = function () {
    if (x && 9 <= C) {
      this.hasSelection = null;
    }
    this.fastPoll();
  };
  Vl.prototype.onContextMenu = function (e) {
    var r = this;
    var n = r.cm;
    var i = n.display;
    var o = r.textarea;
    if (r.contextMenuPending) {
      r.contextMenuPending();
    }
    var t = ln(n, e);
    var l = i.scroller.scrollTop;
    if (t && !v) {
      if (n.options.resetSelectionOnContextMenu && -1 == n.doc.sel.contains(t)) {
        Yn(n, Yi)(n.doc, new vi([new mi(t, undefined || t)], 0), V);
      }
      var s;
      var a = o.style.cssText;
      var u = r.wrapper.style.cssText;
      var c = r.wrapper.offsetParent.getBoundingClientRect();
      r.wrapper.style.cssText = "position: static";
      o.style.cssText = "position: absolute; width: 30px; height: 30px;\n      top: " + (e.clientY - c.top - 5) + "px; left: " + (e.clientX - c.left - 5) + "px;\n      z-index: 1000; background: " + (x ? "rgba(255, 255, 255, .05)" : "transparent") + ";\n      outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);";
      if (b) {
        s = window.scrollY;
      }
      i.input.focus();
      if (b) {
        window.scrollTo(null, s);
      }
      i.input.reset();
      if (!n.somethingSelected()) {
        o.value = r.prevInput = " ";
      }
      r.contextMenuPending = d;
      i.selForContextMenu = n.doc.sel;
      clearTimeout(i.detectingSelectAll);
      if (x && 9 <= C) {
        f();
      }
      if (S) {
        ft(e);
        var h = function () {
          nt(window, "mouseup", h);
          setTimeout(d, 20);
        };
        tt(window, "mouseup", h);
      } else {
        setTimeout(d, 50);
      }
    }
    function f() {
      if (null != o.selectionStart) {
        var e = n.somethingSelected();
        var t = "​" + (e ? o.value : "");
        o.value = "⇚";
        o.value = t;
        r.prevInput = e ? "" : "​";
        o.selectionStart = 1;
        o.selectionEnd = t.length;
        i.selForContextMenu = n.doc.sel;
      }
    }
    function d() {
      if (r.contextMenuPending == d && (r.contextMenuPending = false, r.wrapper.style.cssText = u, o.style.cssText = a, x && C < 9 && i.scrollbars.setScrollTop(i.scroller.scrollTop = l), null != o.selectionStart)) {
        if (!x || x && C < 9) {
          f();
        }
        var e = 0;
        var t = function () {
          if (i.selForContextMenu == n.doc.sel && 0 == o.selectionStart && 0 < o.selectionEnd && "​" == r.prevInput) {
            Yn(n, to)(n);
          } else if (e++ < 10) {
            i.detectingSelectAll = setTimeout(t, 500);
          } else {
            i.selForContextMenu = null;
            i.input.reset();
          }
        };
        i.detectingSelectAll = setTimeout(t, 200);
      }
    }
  };
  Vl.prototype.readOnlyChanged = function (e) {
    if (!e) {
      this.reset();
    }
    this.textarea.disabled = "nocursor" == e;
  };
  Vl.prototype.setUneditable = function () {};
  Vl.prototype.needsContentAttribute = false;
  (function (i) {
    var o = i.optionHandlers;
    function e(e, t, n, r) {
      i.defaults[e] = t;
      if (n) {
        o[e] = r ? function (e, t, r) {
          if (r != vl) {
            n(e, t, r);
          }
        } : n;
      }
    }
    i.defineOption = e;
    i.Init = vl;
    e("value", "", function (e, t) {
      return e.setValue(t);
    }, true);
    e("mode", null, function (e, t) {
      e.doc.modeOption = t;
      Li(e);
    }, true);
    e("indentUnit", 2, Li, true);
    e("indentWithTabs", false);
    e("smartIndent", true);
    e("tabSize", 4, function (e) {
      ki(e);
      zr(e);
      qn(e);
    }, true);
    e("lineSeparator", null, function (e, n) {
      if (e.doc.lineSep = n) {
        var i = [];
        var o = e.doc.first;
        e.doc.iter(function (e) {
          for (var t = 0;;) {
            var r = e.text.indexOf(n, t);
            if (-1 == r) {
              break;
            }
            t = r + n.length;
            i.push(ve(o, r));
          }
          o++;
        });
        for (var t = i.length - 1; 0 <= t; t--) {
          ao(e.doc, n, i[t], ve(i[t].line, i[t].ch + n.length));
        }
      }
    });
    e("specialChars", /[\u0000-\u001f\u007f-\u009f\u00ad\u061c\u200b-\u200f\u2028\u2029\ufeff]/g, function (e, t, r) {
      e.state.specialChars = new RegExp(t.source + (t.test("\t") ? "" : "|\t"), "g");
      if (r != vl) {
        e.refresh();
      }
    });
    e("specialCharPlaceholder", Qt, function (e) {
      return e.refresh();
    }, true);
    e("electricChars", true);
    e("inputStyle", f ? "contenteditable" : "textarea", function () {
      throw new Error("inputStyle can not (yet) be changed in a running editor");
    }, true);
    e("spellcheck", false, function (e, t) {
      return e.getInputField().spellcheck = t;
    }, true);
    e("autocorrect", false, function (e, t) {
      return e.getInputField().autocorrect = t;
    }, true);
    e("autocapitalize", false, function (e, t) {
      return e.getInputField().autocapitalize = t;
    }, true);
    e("rtlMoveVisually", !p);
    e("wholeLineUpdateBefore", true);
    e("theme", "default", function (e) {
      gl(e);
      bl(e);
    }, true);
    e("keyMap", "default", function (e, t, r) {
      var n = "string" == typeof t ? Io[e] : t;
      var i = r != vl && ("string" == typeof r ? Io[e] : r);
      if (i && i.detach) {
        i.detach(e, n);
      }
      if (n.attach) {
        n.attach(e, i || null);
      }
    });
    e("extraKeys", null);
    e("configureMouse", null);
    e("lineWrapping", false, xl, true);
    e("gutters", [], function (e) {
      ci(e.options);
      bl(e);
    }, true);
    e("fixedGutter", true, function (e, t) {
      e.display.gutters.style.left = t ? e.display.scroller.getBoundingClientRect().left - e.display.sizer.getBoundingClientRect().left + "px" : "0";
      e.refresh();
    }, true);
    e("coverGutterNextToScrollbar", false, function (e) {
      return Pn(e);
    }, true);
    e("scrollbarStyle", "native", function (e) {
      zn(e);
      Pn(e);
      e.display.scrollbars.setScrollTop(e.doc.scrollTop);
      e.display.scrollbars.setScrollLeft(e.doc.scrollLeft);
    }, true);
    e("lineNumbers", false, function (e) {
      ci(e.options);
      bl(e);
    }, true);
    e("firstLineNumber", 1, bl, true);
    e("lineNumberFormatter", function (e) {
      return e;
    }, bl, true);
    e("showCursorWhenSelecting", false, an, true);
    e("resetSelectionOnContextMenu", true);
    e("lineWiseCopyCut", true);
    e("pasteLinesPerSelection", true);
    e("selectionsMayTouch", false);
    e("readOnly", false, function (e, t) {
      if ("nocursor" == t) {
        mn(e);
        e.display.input.blur();
      }
      e.display.input.readOnlyChanged(t);
    });
    e("disableInput", false, function (e, t) {
      if (!t) {
        e.display.input.reset();
      }
    }, true);
    e("dragDrop", true, wl);
    e("allowDropFileTypes", null);
    e("cursorBlinkRate", 530);
    e("cursorScrollMargin", 0);
    e("cursorHeight", 1, an, true);
    e("singleCursorHeightPerLine", true, an, true);
    e("workTime", 100);
    e("workDelay", 100);
    e("flattenSpans", true, ki, true);
    e("addModeClass", false, ki, true);
    e("pollInterval", 100);
    e("undoDepth", 200, function (e, t) {
      return e.doc.history.undoDepth = t;
    });
    e("historyEventDelay", 1250);
    e("viewportMargin", 10, function (e) {
      return e.refresh();
    }, true);
    e("maxHighlightLength", 1e4, ki, true);
    e("moveInputWithCursor", true, function (e, t) {
      if (!t) {
        e.display.input.resetPosition();
      }
    });
    e("tabindex", null, function (e, t) {
      return e.display.input.getField().tabIndex = t || "";
    });
    e("autofocus", null);
    e("direction", "ltr", function (e, t) {
      return e.doc.setDirection(t);
    }, true);
    e("phrases", null);
  })(Cl);
  Gl = Cl.optionHandlers;
  Ul = Cl.helpers = {};
  Cl.prototype = {
    constructor: Cl,
    focus: function () {
      window.focus();
      this.display.input.focus();
    },
    setOption: function (e, t) {
      var r = this.options;
      var n = r[e];
      if (!(r[e] == t && "mode" != e)) {
        r[e] = t;
        if (Gl.hasOwnProperty(e)) {
          Yn(this, Gl[e])(this, t, n);
        }
        it(this, "optionChange", this, e);
      }
    },
    getOption: function (e) {
      return this.options[e];
    },
    getDoc: function () {
      return this.doc;
    },
    addKeyMap: function (e, t) {
      this.state.keyMaps[t ? "push" : "unshift"]("string" == typeof e ? Io[e] : e);
    },
    removeKeyMap: function (e) {
      var t = this.state.keyMaps;
      for (var r = 0; r < t.length; ++r) {
        if (t[r] == e || t[r].name == e) {
          t.splice(r, 1);
          return true;
        }
      }
    },
    addOverlay: _n(function (e, t) {
      var r = e.token ? e : Cl.getMode(this.options, e);
      if (r.startState) {
        throw new Error("Overlays may not be stateful.");
      }
      !function (e, t, r) {
        var n = 0;
        for (var i = r(t); n < e.length && r(e[n]) <= i;) {
          n++;
        }
        e.splice(n, 0, t);
      }(this.state.overlays, {
        mode: r,
        modeSpec: e,
        opaque: t && t.opaque,
        priority: t && t.priority || 0
      }, function (e) {
        return e.priority;
      });
      this.state.modeGen++;
      qn(this);
    }),
    removeOverlay: _n(function (e) {
      var t = this.state.overlays;
      for (var r = 0; r < t.length; ++r) {
        var n = t[r].modeSpec;
        if (n == e || "string" == typeof e && n.name == e) {
          t.splice(r, 1);
          this.state.modeGen++;
          return void qn(this);
        }
      }
    }),
    indentLine: _n(function (e, t, r) {
      if ("string" != typeof t && "number" != typeof t) {
        t = null == t ? this.options.smartIndent ? "smart" : "prev" : t ? "add" : "subtract";
      }
      if (e >= this.doc.first && e < this.doc.first + this.doc.size) {
        Ll(this, e, t, r);
      }
    }),
    indentSelection: _n(function (e) {
      var t = this;
      var r = this.doc.sel.ranges;
      var n = -1;
      for (var i = 0; i < r.length; i++) {
        var o = r[i];
        if (o.empty()) {
          if (o.head.line > n) {
            Ll(t, o.head.line, e, true);
            n = o.head.line;
            if (i == t.doc.sel.primIndex) {
              kn(t);
            }
          }
        } else {
          var l = o.from();
          var s = o.to();
          var a = Math.max(n, l.line);
          n = Math.min(t.lastLine(), s.line - (s.ch ? 0 : 1)) + 1;
          for (var u = a; u < n; ++u) {
            Ll(t, u, e);
          }
          var c = t.doc.sel.ranges;
          if (0 == l.ch && r.length == c.length && 0 < c[i].from().ch) {
            Ki(t.doc, i, new mi(l, c[i].to()), V);
          }
        }
      }
    }),
    getTokenAt: function (e, t) {
      return Kt(this, e, t);
    },
    getLineTokens: function (e, t) {
      return Kt(this, ve(e), t, true);
    },
    getTokenTypeAt: function (e) {
      e = Se(this.doc, e);
      var t;
      var r = zt(this, ae(this.doc, e.line));
      var n = 0;
      var i = (r.length - 1) / 2;
      var o = e.ch;
      if (0 == o) {
        t = r[2];
      } else {
        for (;;) {
          var l = n + i >> 1;
          if ((l ? r[2 * l - 1] : 0) >= o) {
            i = l;
          } else {
            if (!(r[2 * l + 1] < o)) {
              t = r[2 * l + 2];
              break;
            }
            n = l + 1;
          }
        }
      }
      var s = t ? t.indexOf("overlay ") : -1;
      return s < 0 ? t : 0 == s ? null : t.slice(0, s - 1);
    },
    getModeAt: function (e) {
      var t = this.doc.mode;
      return t.innerMode ? Cl.innerMode(t, this.getTokenAt(e).state).mode : t;
    },
    getHelper: function (e, t) {
      return this.getHelpers(e, t)[0];
    },
    getHelpers: function (e, t) {
      var r = [];
      if (!Ul.hasOwnProperty(t)) {
        return r;
      }
      var n = Ul[t];
      var i = this.getModeAt(e);
      if ("string" == typeof i[t]) {
        if (n[i[t]]) {
          r.push(n[i[t]]);
        }
      } else if (i[t]) {
        for (var o = 0; o < i[t].length; o++) {
          var l = n[i[t][o]];
          if (l) {
            r.push(l);
          }
        }
      } else if (i.helperType && n[i.helperType]) {
        r.push(n[i.helperType]);
      } else if (n[i.name]) {
        r.push(n[i.name]);
      }
      for (var s = 0; s < n._global.length; s++) {
        var a = n._global[s];
        if (a.pred(i, this) && -1 == B(r, a.val)) {
          r.push(a.val);
        }
      }
      return r;
    },
    getStateAfter: function (e, t) {
      var r = this.doc;
      return Rt(this, (e = Math.max(r.first, Math.min(null == e ? r.first + r.size - 1 : e, r.first + r.size - 1))) + 1, t).state;
    },
    cursorCoords: function (e, t) {
      var r = this.doc.sel.primary();
      return jr(this, null == e ? r.head : "object" == typeof e ? Se(this.doc, e) : e ? r.from() : r.to(), t || "page");
    },
    charCoords: function (e, t) {
      return Kr(this, Se(this.doc, e), t || "page");
    },
    coordsChar: function (e, t) {
      return _r(this, (e = Vr(this, e, t || "page")).left, e.top);
    },
    lineAtHeight: function (e, t) {
      e = Vr(this, {
        top: e,
        left: 0
      }, t || "page").top;
      return de(this.doc, e + this.display.viewOffset);
    },
    heightAtLine: function (e, t, r) {
      var n;
      var i = false;
      if ("number" == typeof e) {
        var o = this.doc.first + this.doc.size - 1;
        if (e < this.doc.first) {
          e = this.doc.first;
        } else if (o < e) {
          e = o;
          i = true;
        }
        n = ae(this.doc, e);
      } else {
        n = e;
      }
      return Ur(this, n, {
        top: 0,
        left: 0
      }, t || "page", r || i).top + (i ? this.doc.height - Ye(n) : 0);
    },
    defaultTextHeight: function () {
      return Jr(this.display);
    },
    defaultCharWidth: function () {
      return en(this.display);
    },
    getViewport: function () {
      return {
        from: this.display.viewFrom,
        to: this.display.viewTo
      };
    },
    addWidget: function (e, t, r, n, i) {
      var o;
      var l;
      var s;
      var a = this.display;
      var u = (e = jr(this, Se(this.doc, e))).bottom;
      var c = e.left;
      t.style.position = "absolute";
      t.setAttribute("cm-ignore-events", "true");
      this.display.input.setUneditable(t);
      a.sizer.appendChild(t);
      if ("over" == n) {
        u = e.top;
      } else if ("above" == n || "near" == n) {
        var h = Math.max(a.wrapper.clientHeight, this.doc.height);
        var f = Math.max(a.sizer.clientWidth, a.lineSpace.clientWidth);
        if (("above" == n || e.bottom + t.offsetHeight > h) && e.top > t.offsetHeight) {
          u = e.top - t.offsetHeight;
        } else if (e.bottom + t.offsetHeight <= h) {
          u = e.bottom;
        }
        if (c + t.offsetWidth > f) {
          c = f - t.offsetWidth;
        }
      }
      t.style.top = u + "px";
      t.style.left = t.style.right = "";
      if ("right" == i) {
        c = a.sizer.clientWidth - t.offsetWidth;
        t.style.right = "0px";
      } else {
        if ("left" == i) {
          c = 0;
        } else if ("middle" == i) {
          c = (a.sizer.clientWidth - t.offsetWidth) / 2;
        }
        t.style.left = c + "px";
      }
      if (r) {
        o = this;
        l = {
          left: c,
          top: u,
          right: c + t.offsetWidth,
          bottom: u + t.offsetHeight
        };
        if (null != (s = Sn(o, l)).scrollTop) {
          On(o, s.scrollTop);
        }
        if (null != s.scrollLeft) {
          Dn(o, s.scrollLeft);
        }
      }
    },
    triggerOnKeyDown: _n(il),
    triggerOnKeyPress: _n(ll),
    triggerOnKeyUp: ol,
    triggerOnMouseDown: _n(cl),
    execCommand: function (e) {
      if ($o.hasOwnProperty(e)) {
        return $o[e].call(null, this);
      }
    },
    triggerElectric: _n(function (e) {
      Ol(this, e);
    }),
    findPosH: function (e, t, r, n) {
      var i = 1;
      if (t < 0) {
        i = -1;
        t = -t;
      }
      var o = Se(this.doc, e);
      for (var l = 0; l < t && !(o = Hl(this.doc, o, i, r, n)).hitSide; ++l) {
        ;
      }
      return o;
    },
    moveH: _n(function (t, r) {
      var n = this;
      this.extendSelectionsBy(function (e) {
        return n.display.shift || n.doc.extend || e.empty() ? Hl(n.doc, e.head, t, r, n.options.rtlMoveVisually) : t < 0 ? e.from() : e.to();
      }, j);
    }),
    deleteH: _n(function (r, n) {
      var e = this.doc.sel;
      var i = this.doc;
      if (e.somethingSelected()) {
        i.replaceSelection("", null, "+delete");
      } else {
        jo(this, function (e) {
          var t = Hl(i, e.head, r, n, false);
          return r < 0 ? {
            from: t,
            to: e.head
          } : {
            from: e.head,
            to: t
          };
        });
      }
    }),
    findPosV: function (e, t, r, n) {
      var i = 1;
      var o = n;
      if (t < 0) {
        i = -1;
        t = -t;
      }
      var l = Se(this.doc, e);
      for (var s = 0; s < t; ++s) {
        var a = jr(this, l, "div");
        if (null == o) {
          o = a.left;
        } else {
          a.left = o;
        }
        if ((l = Fl(this, a, i, r)).hitSide) {
          break;
        }
      }
      return l;
    },
    moveV: _n(function (n, i) {
      var o = this;
      var l = this.doc;
      var s = [];
      var a = !this.display.shift && !l.extend && l.sel.somethingSelected();
      l.extendSelectionsBy(function (e) {
        if (a) {
          return n < 0 ? e.from() : e.to();
        }
        var t = jr(o, e.head, "div");
        if (null != e.goalColumn) {
          t.left = e.goalColumn;
        }
        s.push(t.left);
        var r = Fl(o, t, n, i);
        if ("page" == i && e == l.sel.primary()) {
          Ln(o, Kr(o, r, "div").top - t.top);
        }
        return r;
      }, j);
      if (s.length) {
        for (var e = 0; e < l.sel.ranges.length; e++) {
          l.sel.ranges[e].goalColumn = s[e];
        }
      }
    }),
    findWordAt: function (e) {
      var t = ae(this.doc, e.line).text;
      var r = e.ch;
      var n = e.ch;
      if (t) {
        var i = this.getHelper(e, "wordChars");
        if ("before" != e.sticky && n != t.length || !r) {
          ++n;
        } else {
          --r;
        }
        var o = t.charAt(r);
        for (var l = (i ? !!(-1 < i.source.indexOf("\\w") && (/\w/.test(o) || "" < o && (o.toUpperCase() != o.toLowerCase() || J.test(o)))) || i.test(o) : /\w/.test(o) || "" < o && (o.toUpperCase() != o.toLowerCase() || J.test(o))) ? function (e) {
          return i ? !!(-1 < i.source.indexOf("\\w") && (/\w/.test(e) || "" < e && (e.toUpperCase() != e.toLowerCase() || J.test(e)))) || i.test(e) : /\w/.test(e) || "" < e && (e.toUpperCase() != e.toLowerCase() || J.test(e));
        } : /\s/.test(o) ? function (e) {
          return /\s/.test(e);
        } : function (e) {
          return !/\s/.test(e) && !(undefined ? !!(-1 < undefined.source.indexOf("\\w") && (/\w/.test(e) || "" < e && (e.toUpperCase() != e.toLowerCase() || J.test(e)))) || undefined.test(e) : /\w/.test(e) || "" < e && (e.toUpperCase() != e.toLowerCase() || J.test(e)));
        }; 0 < r && l(t.charAt(r - 1));) {
          --r;
        }
        for (; n < t.length && l(t.charAt(n));) {
          ++n;
        }
      }
      return new mi(ve(e.line, r), ve(e.line, n));
    },
    toggleOverwrite: function (e) {
      if (!(null != e && e == this.state.overwrite)) {
        if (this.state.overwrite = !this.state.overwrite) {
          H(this.display.cursorDiv, "CodeMirror-overwrite");
        } else {
          T(this.display.cursorDiv, "CodeMirror-overwrite");
        }
        it(this, "overwriteToggle", this, this.state.overwrite);
      }
    },
    hasFocus: function () {
      return this.display.input.getField() == W();
    },
    isReadOnly: function () {
      return !(!this.options.readOnly && !this.doc.cantEdit);
    },
    scrollTo: _n(function (e, t) {
      Tn(this, e, t);
    }),
    getScrollInfo: function () {
      var e = this.display.scroller;
      return {
        left: e.scrollLeft,
        top: e.scrollTop,
        height: e.scrollHeight - (30 - this.display.nativeBarWidth) - this.display.barHeight,
        width: e.scrollWidth - (30 - this.display.nativeBarWidth) - this.display.barWidth,
        clientHeight: this.display.scroller.clientHeight - (30 - this.display.nativeBarWidth) - this.display.barHeight,
        clientWidth: this.display.scroller.clientWidth - (30 - this.display.nativeBarWidth) - this.display.barWidth
      };
    },
    scrollIntoView: _n(function (e, t) {
      var r;
      var n;
      if (null == e) {
        e = {
          from: this.doc.sel.primary().head,
          to: null
        };
        if (null == t) {
          t = this.options.cursorScrollMargin;
        }
      } else if ("number" == typeof e) {
        e = {
          from: ve(e, 0),
          to: null
        };
      } else if (null == e.from) {
        e = {
          from: e,
          to: null
        };
      }
      if (!e.to) {
        e.to = e.from;
      }
      e.margin = t || 0;
      if (null != e.from.line) {
        n = e;
        Mn(r = this);
        r.curOp.scrollToPos = n;
      } else {
        Nn(this, e.from, e.to, e.margin);
      }
    }),
    setSize: _n(function (e, t) {
      var r = this;
      if (null != e) {
        this.display.wrapper.style.width = "number" == typeof e || /^\d+$/.test(String(e)) ? e + "px" : e;
      }
      if (null != t) {
        this.display.wrapper.style.height = "number" == typeof t || /^\d+$/.test(String(t)) ? t + "px" : t;
      }
      if (this.options.lineWrapping) {
        Ir(this);
      }
      var i = this.display.viewFrom;
      this.doc.iter(i, this.display.viewTo, function (e) {
        if (e.widgets) {
          for (var t = 0; t < e.widgets.length; t++) {
            if (e.widgets[t].noHScroll) {
              Zn(r, i, "widget");
              break;
            }
          }
        }
        ++i;
      });
      this.curOp.forceUpdate = true;
      it(this, "refresh", this);
    }),
    operation: function (e) {
      return Xn(this, e);
    },
    startOperation: function () {
      return Bn(this);
    },
    endOperation: function () {
      return Gn(this);
    },
    refresh: _n(function () {
      var e = this.display.cachedTextHeight;
      qn(this);
      this.curOp.forceUpdate = true;
      zr(this);
      Tn(this, this.doc.scrollLeft, this.doc.scrollTop);
      si(this);
      if (null == e || .5 < Math.abs(e - Jr(this.display))) {
        on(this);
      }
      it(this, "refresh", this);
    }),
    swapDoc: _n(function (e) {
      var t = this.doc;
      t.cm = null;
      Oi(this, e);
      zr(this);
      this.display.input.reset();
      Tn(this, e.scrollLeft, e.scrollTop);
      this.curOp.forceScroll = true;
      sr(this, "swapDoc", this, t);
      return t;
    }),
    phrase: function (e) {
      var t = this.options.phrases;
      return t && Object.prototype.hasOwnProperty.call(t, e) ? t[e] : e;
    },
    getInputField: function () {
      return this.display.input.getField();
    },
    getWrapperElement: function () {
      return this.display.wrapper;
    },
    getScrollerElement: function () {
      return this.display.scroller;
    },
    getGutterElement: function () {
      return this.display.gutters;
    }
  };
  at(Cl);
  Cl.registerHelper = function (e, t, r) {
    if (!Ul.hasOwnProperty(e)) {
      Ul[e] = Cl[e] = {
        _global: []
      };
    }
    Ul[e][t] = r;
  };
  Cl.registerGlobalHelper = function (e, t, r, n) {
    Cl.registerHelper(e, t, n);
    Ul[e]._global.push({
      pred: r,
      val: n
    });
  };
  var jl = "iter insert remove copy getEditor constructor".split(" ");
  for (var Xl in ko.prototype) if (ko.prototype.hasOwnProperty(Xl) && B(jl, Xl) < 0) {
    Cl.prototype[Xl] = function (e) {
      return function () {
        return e.apply(this.doc, arguments);
      };
    }(ko.prototype[Xl]);
  }
  at(ko);
  Cl.inputStyles = {
    textarea: Vl,
    contenteditable: Pl
  };
  Cl.defineMode = function (e) {
    if (!(Cl.defaults.mode || "null" == e)) {
      Cl.defaults.mode = e;
    }
    (function (e, t) {
      if (2 < arguments.length) {
        t.dependencies = Array.prototype.slice.call(arguments, 2);
      }
      kt[e] = t;
    }).apply(this, arguments);
  };
  Cl.defineMIME = function (e, t) {
    Tt[e] = t;
  };
  Cl.defineMode("null", function () {
    return {
      token: function (e) {
        return e.skipToEnd();
      }
    };
  });
  Cl.defineMIME("text/plain", "null");
  Cl.defineExtension = function (e, t) {
    Cl.prototype[e] = t;
  };
  Cl.defineDocExtension = function (e, t) {
    ko.prototype[e] = t;
  };
  Cl.fromTextArea = function (t, e) {
    (e = e ? I(e) : {}).value = t.value;
    if (!e.tabindex && t.tabIndex) {
      e.tabindex = t.tabIndex;
    }
    if (!e.placeholder && t.placeholder) {
      e.placeholder = t.placeholder;
    }
    if (null == e.autofocus) {
      var r = W();
      e.autofocus = r == t || null != t.getAttribute("autofocus") && r == document.body;
    }
    function n() {
      t.value = s.getValue();
    }
    var i;
    if (t.form && (tt(t.form, "submit", n), !e.leaveSubmitMethodAlone)) {
      var o = t.form;
      i = o.submit;
      try {
        var l = o.submit = function () {
          n();
          o.submit = i;
          o.submit();
          o.submit = l;
        };
      } catch (e) {}
    }
    e.finishInit = function (e) {
      e.save = n;
      e.getTextArea = function () {
        return t;
      };
      e.toTextArea = function () {
        e.toTextArea = isNaN;
        n();
        t.parentNode.removeChild(e.getWrapperElement());
        t.style.display = "";
        if (t.form) {
          nt(t.form, "submit", n);
          if ("function" == typeof t.form.submit) {
            t.form.submit = i;
          }
        }
      };
    };
    t.style.display = "none";
    var s = Cl(function (e) {
      return t.parentNode.insertBefore(e, t.nextSibling);
    }, e);
    return s;
  };
  Cl.off = nt;
  Cl.on = tt;
  Cl.wheelEventPixels = pi;
  Cl.Doc = ko;
  Cl.splitLines = xt;
  Cl.countColumn = z;
  Cl.findColumn = X;
  Cl.isWordChar = ee;
  Cl.Pass = U;
  Cl.signal = it;
  Cl.Line = Yt;
  Cl.changeEnd = wi;
  Cl.scrollbarModel = In;
  Cl.Pos = ve;
  Cl.cmpPos = me;
  Cl.modes = kt;
  Cl.mimeModes = Tt;
  Cl.resolveMode = Mt;
  Cl.getMode = Nt;
  Cl.modeExtensions = Ot;
  Cl.extendMode = At;
  Cl.copyState = Dt;
  Cl.startState = Ht;
  Cl.innerMode = Wt;
  Cl.commands = $o;
  Cl.keyMap = Io;
  Cl.keyName = Vo;
  Cl.isModifierKey = Go;
  Cl.lookupKey = Bo;
  Cl.normalizeKeyMap = Ro;
  Cl.StringStream = Ft;
  Cl.SharedTextMarker = xo;
  Cl.TextMarker = bo;
  Cl.LineWidget = vo;
  Cl.e_preventDefault = ut;
  Cl.e_stopPropagation = ct;
  Cl.e_stop = ft;
  Cl.addClass = H;
  Cl.contains = D;
  Cl.rmClass = T;
  Cl.keyNames = Ho;
  Cl.version = "5.45.0";
  return Cl;
});